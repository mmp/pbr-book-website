
<!doctype html>
<html lang="en">
<head>

<!-- all praise to https://realfavicongenerator.net -->
<link rel="icon" href="/favicon.ico?v=2" /> <!-- force refresh -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="/fonts.css">
  <link rel="stylesheet" href="../pbrstyle.css">
  <link rel="stylesheet" href="/fontawesome-free-5.15.3-web/css/all.css">

<script async src="https://cse.google.com/cse.js?cx=22a43cef261a245ea"></script>  <script src="/react.min.js"></script>
  <script src="/react-dom.min.js"></script>
  <script src="/jeri.min.js"></script>
  <link rel="preload" href="/exr.worker.js" as="script" crossorigin="anonymous">
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/bootstrap.min.css">

  <title>Material Interface and Implementations</title>
</head>
        
<body>

<nav class="fixed-top-lg-navbar navbar navbar-expand bg-light navbar-light">
  <ul class="nav navbar-nav">
    <a class="navbar-brand" href="../contents.html"><img src="../pbr.jpg" width=25 height=25></a>
    <li class="nav-item"><a class="nav-link" href="../Textures_and_Materials.html">Textures and Materials</a></li>
    <span class="navbar-text">/</span>
    <li class="nav-item"><a class="nav-link" href="#">Material Interface and Implementations</a></li>
    <span class="navbar-text">&nbsp;&nbsp;</span>
    <li class="nav-item"><a class="nav-link" href="../Textures_and_Materials/Image_Texture.html">(Previous: Image Texture)</a></li>
  </ul>

  <ul class="nav navbar-nav ml-auto d-none d-md-block">
        <li class="nav-item"><div class="gcse-search"></div></li>
    </ul>
  <ul class="nav navbar-nav d-block d-md-none">
        <li class="nav-item"><div class="gcse-search"></div></li>
    </ul>
</nav>

<div class="maincontainer">
<div class="container-fluid">

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#"><i class="fas fa-link "></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:material-interface"></span><h2>10.5 Material Interface and Implementations</h2><p>




</p>
<p>With a variety of textures available, we will turn to materials, first
introducing the material interface and then a few material
implementations.  <tt>pbrt</tt>&rsquo;s materials all follow a similar form, evaluating
textures to get parameter values that are used to initialize their particular
BSDF model.  Therefore, we will only include a few of
their implementations in the text here.

</p>
<p>The <tt>Material</tt> interface is defined by the
<tt>Material</tt> class, which can be found in the file
<a href="https://github.com/mmp/pbrt-v4/tree/master/src/pbrt/base/material.h"><tt>base/material.h</tt></a>.  <tt>pbrt</tt> includes the implementations of 11
materials; these are enough that we have collected all of their type names
in a fragment that is not included in the text.

</p>
<p></p>
<span class="anchor" id="fragment-MaterialDefinition-0"></span><div class="fragmentname">&lt;&lt;Material Definition&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">class <span class="anchor" id="Material"></span>Material : public <a href="../Utilities/Containers_and_Memory_Management.html#TaggedPointer" class="code">TaggedPointer</a>&lt;&lt;&lt;<span class="fragmentname">Material Types</span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1517" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1517"><i></i></a><div id="fragbit-1517" class="collapse"><div class="fragmentcode">        CoatedDiffuseMaterial, CoatedConductorMaterial,
        ConductorMaterial, DielectricMaterial,
        DiffuseMaterial, DiffuseTransmissionMaterial, HairMaterial,
        MeasuredMaterial, SubsurfaceMaterial,
        ThinDielectricMaterial, MixMaterial</div></div>&gt; {
  public:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-MaterialInterface-0">Material Interface</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1518" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1518"><i></i></a><div id="fragbit-1518" class="collapse"><div class="fragmentcode">       using <a href="../Utilities/Containers_and_Memory_Management.html#TaggedPointer" class="code">TaggedPointer</a>::<a href="../Utilities/Containers_and_Memory_Management.html#TaggedPointer" class="code">TaggedPointer</a>;
       
       static <a href="#Material" class="code">Material</a> Create(
           const std::string &amp;name, const TextureParameterDictionary &amp;parameters, <a href="../Utilities/Images.html#Image" class="code">Image</a> *normalMap, 
           /*const */ std::map&lt;std::string, <a href="#Material" class="code">Material</a>&gt; &amp;namedMaterials,
           const FileLoc *loc, Allocator alloc);
       
       std::string ToString() const;
       template &lt;typename <a href="#TextureEvaluator" class="code">TextureEvaluator</a>&gt;
       inline
       <a href="../Reflection_Models/BSDF_Representation.html#BSDF" class="code">BSDF</a> GetBSDF(<a href="#TextureEvaluator" class="code">TextureEvaluator</a> texEval, <a href="#MaterialEvalContext" class="code">MaterialEvalContext</a> ctx,
                    <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledWavelengths" class="code">SampledWavelengths</a> &amp;lambda, <a href="../Utilities/Containers_and_Memory_Management.html#ScratchBuffer" class="code">ScratchBuffer</a> &amp;buf) const;
       template &lt;typename <a href="#TextureEvaluator" class="code">TextureEvaluator</a>&gt;
       BSSRDF GetBSSRDF(<a href="#TextureEvaluator" class="code">TextureEvaluator</a> texEval, <a href="#MaterialEvalContext" class="code">MaterialEvalContext</a> ctx,
                        <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledWavelengths" class="code">SampledWavelengths</a> &amp;lambda, <a href="../Utilities/Containers_and_Memory_Management.html#ScratchBuffer" class="code">ScratchBuffer</a> &amp;buf) const;
       template &lt;typename <a href="#TextureEvaluator" class="code">TextureEvaluator</a>&gt;
       bool CanEvaluateTextures(<a href="#TextureEvaluator" class="code">TextureEvaluator</a> texEval) const;
       const <a href="../Utilities/Images.html#Image" class="code">Image</a> *GetNormalMap() const;
       <a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture" class="code">FloatTexture</a> GetDisplacement() const;
       bool HasSubsurfaceScattering() const;</div></div>
};</div><p>


</p>
<p>

</p>
<p>

</p>
<p>One of the most important methods that <a href="#Material"><tt>Material</tt></a> implementations must
provide is <tt>GetBxDF()</tt><span class="anchor" id="Material::GetBxDF"></span>.  It has the following signature:

</p>
<p></p>
<div class="fragmentcode">template &lt;typename TextureEvaluator&gt;
ConcreteBxDF GetBxDF(TextureEvaluator texEval, MaterialEvalContext ctx,
                     SampledWavelengths &amp;lambda) const;</div><p>


</p>
<p>There are a few things to notice in its declaration.  First, it is
templated based on a type <tt>TextureEvaluator</tt>.  This class is used by
materials to, unsurprisingly, evaluate their textures.  We will discuss it
further in a page or two, as well as <a href="#MaterialEvalContext"><tt>MaterialEvalContext</tt></a>, which
serves a similar role to <a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureEvalContext"><tt>TextureEvalContext</tt></a>.

</p>
<p>Most importantly, note the return type, <tt>ConcreteBxDF</tt>.  This type is
specific to each <tt>Material</tt> and should be replaced with the actual
<a href="../Reflection_Models/BSDF_Representation.html#BxDF"><tt>BxDF</tt></a> type that the material uses.  (For example, the
<a href="#DiffuseMaterial"><tt>DiffuseMaterial</tt></a> returns a <a href="../Reflection_Models/Diffuse_Reflection.html#DiffuseBxDF"><tt>DiffuseBxDF</tt></a>.)  Different materials
thus have different signatures for their <tt>GetBxDF()</tt> methods.  This is
unusual for an interface method in C++ and is not usually allowed with
regular C++ virtual functions, though we will see shortly how <tt>pbrt</tt> handles the variety of them.

</p>
<p>Each <tt>Material</tt> is also responsible for defining the type of
<tt>BxDF</tt> that it returns from its <tt>GetBxDF()</tt> method with a local
type definition for the type <tt>BxDF</tt>.  For example,
<a href="#DiffuseMaterial"><tt>DiffuseMaterial</tt></a> has

</p>
<p>
</p>
<div class="fragmentcode">using BxDF = DiffuseBxDF;</div><p>

in the body of its definition.

</p>
<p>The value of defining the interface in this way is that doing so makes it
possible to write generic BSDF evaluation code that is templated on the
type of material.  Such code can then allocate storage for the <tt>BxDF</tt>
on the stack, for whatever type of <tt>BxDF</tt> the material uses.  <tt>pbrt</tt>&rsquo;s
wavefront renderer, which is described in Chapter&nbsp;<a href="../Wavefront_Rendering_on_GPUs.html#chap:gpu">15</a>, takes
advantage of this opportunity.  (Further details and discussion of its use
there are in Section&nbsp;<a href="../Wavefront_Rendering_on_GPUs/Path_Tracer_Implementation.html#sec:gpu-surface-scatter">15.3.9</a>.)  A disadvantage of
this design is that materials cannot return different <tt>BxDF</tt> types
depending on their parameter values; they are limited to the one that they
declare.

</p>
<p>

</p>
<p>The <a href="#Material"><tt>Material</tt></a> class provides a <tt>GetBSDF()</tt> method that handles
the variety of material <tt>BxDF</tt> return types.  It requires some C++
arcana, though it centralizes the complexity of handling the diversity of
types returned from the <tt>GetBxDF()</tt> methods.

</p>
<p><tt>Material::GetBSDF()</tt> has the same general form of most of the dynamic
dispatch method implementations in <tt>pbrt</tt>.  (We have elided almost all of
them from the text since most of them are boilerplate code.)  Here we
define a lambda function, <tt>getBSDF</tt>, and call the <tt>Dispatch()</tt>
method that <a href="#Material"><tt>Material</tt></a> inherits from <a href="../Utilities/Containers_and_Memory_Management.html#TaggedPointer"><tt>TaggedPointer</tt></a>.  Recall that
<tt>Dispatch()</tt> uses type information encoded in a 64-bit pointer to
determine which concrete material type the <a href="#Material"><tt>Material</tt></a> points to before
casting the pointer to that type and passing it to the lambda.

</p>
<p></p>
<span class="anchor" id="fragment-MaterialInlineMethodDefinitions-0"></span><div class="fragmentname">&lt;&lt;Material Inline Method Definitions&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">template &lt;typename <a href="#TextureEvaluator" class="code">TextureEvaluator</a>&gt;
<a href="../Reflection_Models/BSDF_Representation.html#BSDF" class="code">BSDF</a> <span class="anchor" id="Material::GetBSDF"></span><a href="#Material" class="code">Material</a>::GetBSDF(
        <a href="#TextureEvaluator" class="code">TextureEvaluator</a> texEval, <a href="#MaterialEvalContext" class="code">MaterialEvalContext</a> ctx,
        <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledWavelengths" class="code">SampledWavelengths</a> &amp;lambda, <a href="../Utilities/Containers_and_Memory_Management.html#ScratchBuffer" class="code">ScratchBuffer</a> &amp;scratchBuffer) const {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-DefinemonogetBSDFlambdafunctionformonoMaterial::GetBSDF-0">Define <tt>getBSDF</tt> lambda function for <tt>Material::GetBSDF()</tt></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1519" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1519"><i></i></a><div id="fragbit-1519" class="collapse"><div class="fragmentcode">       auto getBSDF = [&amp;](auto mtl) -&gt; <a href="../Reflection_Models/BSDF_Representation.html#BSDF" class="code">BSDF</a> {
           using ConcreteMtl = typename std::remove_reference_t&lt;decltype(*mtl)&gt;;
           using ConcreteBxDF = typename ConcreteMtl::<a href="../Reflection_Models/BSDF_Representation.html#BxDF" class="code">BxDF</a>;
           if constexpr (std::is_same_v&lt;ConcreteBxDF, void&gt;)
               return <a href="../Reflection_Models/BSDF_Representation.html#BSDF" class="code">BSDF</a>();
           else {
               &lt;&lt;<span class="fragmentname"><a href="#fragment-AllocatememoryformonoConcreteBxDFandreturnmonoBSDFformaterial-0">Allocate memory for <tt>ConcreteBxDF</tt> and return <tt>BSDF</tt> for material</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1520" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1520"><i></i></a><div id="fragbit-1520" class="collapse"><div class="fragmentcode">                  ConcreteBxDF *bxdf = scratchBuffer.<a href="../Utilities/Containers_and_Memory_Management.html#ScratchBuffer::Alloc" class="code">Alloc</a>&lt;ConcreteBxDF&gt;();
                  *bxdf = mtl-&gt;GetBxDF(texEval, ctx, lambda);
                  return <a href="../Reflection_Models/BSDF_Representation.html#BSDF" class="code">BSDF</a>(ctx.<a href="#MaterialEvalContext::ns" class="code">ns</a>, ctx.<a href="#MaterialEvalContext::dpdus" class="code">dpdus</a>, bxdf);</div></div>
           }
       };</div></div>
    return <a href="../Utilities/Containers_and_Memory_Management.html#TaggedPointer::Dispatch" class="code">Dispatch</a>(getBSDF);
}</div><p>


</p>
<p><tt>getBSDF</tt> is a C++ <em>generic lambda</em>: when it is called, the
<tt>auto mtl</tt> parameter will have a concrete type, that of a reference to
a pointer to one of the materials enumerated in the &lt;&lt;<span class="fragmentname">Material
Types</span>&gt;&gt; fragment.  Given <tt>mtl</tt>, then, we can find the concrete type of
its material and thence the type of its <tt>BxDF</tt>.  If a material does
not return a <tt>BxDF</tt>, it should use <tt>void</tt> for its <tt>BxDF</tt>
type definition.  In that case, an unset <tt>BSDF</tt> is returned.
(The <a href="#MixMaterial"><tt>MixMaterial</tt></a> is the only such <tt>Material</tt> in <tt>pbrt</tt>.)

</p>
<p></p>
<span class="anchor" id="fragment-DefinemonogetBSDFlambdafunctionformonoMaterial::GetBSDF-0"></span><div class="fragmentname">&lt;&lt;Define <tt>getBSDF</tt> lambda function for <tt>Material::GetBSDF()</tt>&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">auto getBSDF = [&amp;](auto mtl) -&gt; <a href="../Reflection_Models/BSDF_Representation.html#BSDF" class="code">BSDF</a> {
    using ConcreteMtl = typename std::remove_reference_t&lt;decltype(*mtl)&gt;;
    using ConcreteBxDF = typename ConcreteMtl::<a href="../Reflection_Models/BSDF_Representation.html#BxDF" class="code">BxDF</a>;
    if constexpr (std::is_same_v&lt;ConcreteBxDF, void&gt;)
        return <a href="../Reflection_Models/BSDF_Representation.html#BSDF" class="code">BSDF</a>();
    else {
        &lt;&lt;<span class="fragmentname"><a href="#fragment-AllocatememoryformonoConcreteBxDFandreturnmonoBSDFformaterial-0">Allocate memory for <tt>ConcreteBxDF</tt> and return <tt>BSDF</tt> for material</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1521" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1521"><i></i></a><div id="fragbit-1521" class="collapse"><div class="fragmentcode">           ConcreteBxDF *bxdf = scratchBuffer.<a href="../Utilities/Containers_and_Memory_Management.html#ScratchBuffer::Alloc" class="code">Alloc</a>&lt;ConcreteBxDF&gt;();
           *bxdf = mtl-&gt;GetBxDF(texEval, ctx, lambda);
           return <a href="../Reflection_Models/BSDF_Representation.html#BSDF" class="code">BSDF</a>(ctx.<a href="#MaterialEvalContext::ns" class="code">ns</a>, ctx.<a href="#MaterialEvalContext::dpdus" class="code">dpdus</a>, bxdf);</div></div>
    }
};</div><p>


</p>
<p>The provided
<a href="../Utilities/Containers_and_Memory_Management.html#ScratchBuffer"><tt>ScratchBuffer</tt></a> is used to allocate enough memory to store the
material&rsquo;s <tt>BxDF</tt>; using it is much more efficient than using C++&rsquo;s
<tt>new</tt> and <tt>delete</tt> operators here.  That memory is then
initialized with the value returned by the material&rsquo;s <tt>GetBxDF()</tt>
method before the complete <tt>BSDF</tt> is returned to the caller.

</p>
<p></p>
<span class="anchor" id="fragment-AllocatememoryformonoConcreteBxDFandreturnmonoBSDFformaterial-0"></span><div class="fragmentname">&lt;&lt;Allocate memory for <tt>ConcreteBxDF</tt> and return <tt>BSDF</tt> for material&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">ConcreteBxDF *bxdf = scratchBuffer.<a href="../Utilities/Containers_and_Memory_Management.html#ScratchBuffer::Alloc" class="code">Alloc</a>&lt;ConcreteBxDF&gt;();
*bxdf = mtl-&gt;GetBxDF(texEval, ctx, lambda);
return <a href="../Reflection_Models/BSDF_Representation.html#BSDF" class="code">BSDF</a>(ctx.<a href="#MaterialEvalContext::ns" class="code">ns</a>, ctx.<a href="#MaterialEvalContext::dpdus" class="code">dpdus</a>, bxdf);</div><p>


</p>
<p>Materials that incorporate subsurface scattering must define a
<tt>GetBSSRDF()</tt> method that follows a similar form.  They must also
include a <tt>using</tt> declaration in their class definition that defines a
concrete <tt>BSSRDF</tt> type. (The code for rendering BSSRDFs is included
only in the online edition.)

</p>
<p></p>
<div class="fragmentcode">template &lt;typename TextureEvaluator&gt;
ConcreteBSSRDF GetBSSRDF(TextureEvaluator texEval, MaterialEvalContext ctx,
                         SampledWavelengths &amp;lambda) const;</div><p>


</p>
<p>The <a href="#Material"><tt>Material</tt></a> class provides a corresponding <tt>GetBSSRDF()</tt>
method that uses the provided <tt>ScratchBuffer</tt> to allocate storage 
for the material-specific <tt>BSSRDF</tt>.

</p>
<p></p>
<span class="anchor" id="fragment-MaterialInterface-0"></span><div class="fragmentname">&lt;&lt;Material Interface&gt;&gt;=&nbsp;<a href="#fragment-MaterialInterface-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename <a href="#TextureEvaluator" class="code">TextureEvaluator</a>&gt;
BSSRDF <span class="anchor" id="Material::GetBSSRDF"></span>GetBSSRDF(<a href="#TextureEvaluator" class="code">TextureEvaluator</a> texEval, <a href="#MaterialEvalContext" class="code">MaterialEvalContext</a> ctx,
                 <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledWavelengths" class="code">SampledWavelengths</a> &amp;lambda, <a href="../Utilities/Containers_and_Memory_Management.html#ScratchBuffer" class="code">ScratchBuffer</a> &amp;buf) const;</div><p>


</p>
<p>The <a href="#MaterialEvalContext"><tt>MaterialEvalContext</tt></a> that <tt>GetBxDF()</tt> and <tt>GetBSSRDF()</tt>
take plays a similar role to other <tt>*EvalContext</tt> classes: it
encapsulates only the values that are necessary for material evaluation.
They are a superset of those that are used for texture evaluation,
so it inherits from <a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureEvalContext"><tt>TextureEvalContext</tt></a>.  Doing so has the added
advantage that <tt>MaterialEvalContext</tt>s can be passed directly to the
texture evaluation methods.

</p>
<p> 

</p>
<p></p>
<span class="anchor" id="fragment-MaterialEvalContextDefinition-0"></span><div class="fragmentname">&lt;&lt;MaterialEvalContext Definition&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">struct <span class="anchor" id="MaterialEvalContext"></span>MaterialEvalContext : public <a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureEvalContext" class="code">TextureEvalContext</a> {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-MaterialEvalContextPublicMethods-0">MaterialEvalContext Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1522" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1522"><i></i></a><div id="fragbit-1522" class="collapse"><div class="fragmentcode">       <a href="#MaterialEvalContext" class="code">MaterialEvalContext</a>() = default;
       <a href="#MaterialEvalContext" class="code">MaterialEvalContext</a>(const <a href="../Geometry_and_Transformations/Interactions.html#SurfaceInteraction" class="code">SurfaceInteraction</a> &amp;si)
           : <a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureEvalContext" class="code">TextureEvalContext</a>(si), <a href="../Geometry_and_Transformations/Interactions.html#Interaction::wo" class="code">wo</a>(si.<a href="../Geometry_and_Transformations/Interactions.html#Interaction::wo" class="code">wo</a>), <a href="#MaterialEvalContext::ns" class="code">ns</a>(si.shading.<a href="../Geometry_and_Transformations/Interactions.html#SurfaceInteraction::shading::n" class="code">n</a>),
             <a href="#MaterialEvalContext::dpdus" class="code">dpdus</a>(si.shading.<a href="../Geometry_and_Transformations/Interactions.html#SurfaceInteraction::shading::dpdu" class="code">dpdu</a>) {}
       </div></div>
    <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> <span class="anchor" id="MaterialEvalContext::wo"></span>wo;
    <a href="../Geometry_and_Transformations/Normals.html#Normal3f" class="code">Normal3f</a> <span class="anchor" id="MaterialEvalContext::ns"></span>ns;
    <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> <span class="anchor" id="MaterialEvalContext::dpdus"></span>dpdus;
};</div><p>


</p>
<p>As before, there is not only a constructor that initializes a
<tt>MaterialEvalContext</tt> from a <a href="../Geometry_and_Transformations/Interactions.html#SurfaceInteraction"><tt>SurfaceInteraction</tt></a> but also a
constructor that takes the values for the members individually (not
included here).

</p>
<p></p>
<span class="anchor" id="fragment-MaterialEvalContextPublicMethods-0"></span><div class="fragmentname">&lt;&lt;MaterialEvalContext Public Methods&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="#MaterialEvalContext" class="code">MaterialEvalContext</a>() = default;
<a href="#MaterialEvalContext" class="code">MaterialEvalContext</a>(const <a href="../Geometry_and_Transformations/Interactions.html#SurfaceInteraction" class="code">SurfaceInteraction</a> &amp;si)
    : <a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureEvalContext" class="code">TextureEvalContext</a>(si), <a href="../Geometry_and_Transformations/Interactions.html#Interaction::wo" class="code">wo</a>(si.<a href="../Geometry_and_Transformations/Interactions.html#Interaction::wo" class="code">wo</a>), <a href="#MaterialEvalContext::ns" class="code">ns</a>(si.shading.<a href="../Geometry_and_Transformations/Interactions.html#SurfaceInteraction::shading::n" class="code">n</a>),
      <a href="#MaterialEvalContext::dpdus" class="code">dpdus</a>(si.shading.<a href="../Geometry_and_Transformations/Interactions.html#SurfaceInteraction::shading::dpdu" class="code">dpdu</a>) {}
</div><p>


</p>
<p>A <tt>TextureEvaluator</tt><span class="anchor" id="TextureEvaluator"></span> is a class that is
able to evaluate some or all of <tt>pbrt</tt>&rsquo;s texture types.  One of its methods
takes a set of textures and reports whether it is capable of evaluating
them, while others actually evaluate textures.  On the face of it, there is no
obvious need for such a class: why not allow <a href="#Material"><tt>Material</tt></a>s to call the
<a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#Texture"><tt>Texture</tt></a> <tt>Evaluate()</tt> methods directly?  This additional layer of
abstraction aids performance with the wavefront integrator; it makes it
possible to separate materials into those that have lightweight textures
and those with heavyweight textures and to process them separately.  Doing
so is beneficial to performance on the GPU; see
Section&nbsp;<a href="../Wavefront_Rendering_on_GPUs/Path_Tracer_Implementation.html#sec:gpu-surface-scatter">15.3.9</a> for further discussion.

</p>
<p>For now we will only define the <a href="#UniversalTextureEvaluator"><tt>UniversalTextureEvaluator</tt></a>, which can
evaluate all textures.  In practice, the indirection it adds is optimized
away by the compiler such that it introduces no runtime overhead.  It is
used with all of <tt>pbrt</tt>&rsquo;s integrators other than the one defined in
Chapter&nbsp;<a href="../Wavefront_Rendering_on_GPUs.html#chap:gpu">15</a>.

</p>
<p></p>
<span class="anchor" id="fragment-UniversalTextureEvaluatorDefinition-0"></span><div class="fragmentname">&lt;&lt;UniversalTextureEvaluator Definition&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">class <span class="anchor" id="UniversalTextureEvaluator"></span>UniversalTextureEvaluator {
  public:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-UniversalTextureEvaluatorPublicMethods-0">UniversalTextureEvaluator Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1523" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1523"><i></i></a><div id="fragbit-1523" class="collapse"><div class="fragmentcode">       bool CanEvaluate(std::initializer_list&lt;<a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture" class="code">FloatTexture</a>&gt;,
                        std::initializer_list&lt;<a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#SpectrumTexture" class="code">SpectrumTexture</a>&gt;) const {
           return true;
       }
       PBRT_CPU_GPU
       Float operator()(<a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture" class="code">FloatTexture</a> tex, <a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureEvalContext" class="code">TextureEvalContext</a> ctx);
       
       PBRT_CPU_GPU
       <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a> operator()(<a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#SpectrumTexture" class="code">SpectrumTexture</a> tex, <a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureEvalContext" class="code">TextureEvalContext</a> ctx,
                                  <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledWavelengths" class="code">SampledWavelengths</a> lambda);</div></div>
};</div><p>


</p>
<p><tt>TextureEvaluator</tt>s must provide a
<tt>CanEvaluate()</tt><span class="anchor" id="TextureEvaluator::CanEvaluate"></span>
method that
takes lists of <a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture"><tt>FloatTexture</tt></a>s and <a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#SpectrumTexture"><tt>SpectrumTexture</tt></a>s.  They can
then examine the types of the provided
textures to determine if they are able to evaluate them.  For the universal
texture evaluator, the answer is always the same.

</p>
<p></p>
<span class="anchor" id="fragment-UniversalTextureEvaluatorPublicMethods-0"></span><div class="fragmentname">&lt;&lt;UniversalTextureEvaluator Public Methods&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">bool <span class="anchor" id="UniversalTextureEvaluator::CanEvaluate"></span>CanEvaluate(std::initializer_list&lt;<a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture" class="code">FloatTexture</a>&gt;,
                 std::initializer_list&lt;<a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#SpectrumTexture" class="code">SpectrumTexture</a>&gt;) const {
    return true;
}</div><p>


</p>
<p>

</p>
<p><tt>TextureEvaluator</tt>s must also provide
<tt>operator()</tt><span class="anchor" id="TextureEvaluator::operator"></span>
method implementations that
evaluate a given texture.  Thus, given a texture evaluator <tt>texEval</tt>,
material code should use the expression <tt>texEval(tex, ctx)</tt> rather than
<tt>tex.Evaluate(ctx)</tt>.  The implementation of this method
is again trivial for the universal evaluator.  (A corresponding method for
spectrum textures is effectively the same and not included here.)

</p>
<p></p>
<span class="anchor" id="fragment-UniversalTextureEvaluatorMethodDefinitions-0"></span><div class="fragmentname">&lt;&lt;UniversalTextureEvaluator Method Definitions&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float <span class="anchor" id="UniversalTextureEvaluator::operator"></span>UniversalTextureEvaluator::operator()(<a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture" class="code">FloatTexture</a> tex,
                                            <a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureEvalContext" class="code">TextureEvalContext</a> ctx) {
    return tex.<a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture::Evaluate" class="code">Evaluate</a>(ctx);
}</div><p>


</p>
<p>Returning to the <a href="#Material"><tt>Material</tt></a> interface, all materials must provide a
<tt>CanEvaluateTextures()</tt> method that takes a texture evaluator.  They
should return the result of calling its <tt>CanEvaluate()</tt> method
with all of their textures provided.  Code that uses <a href="#Material"><tt>Material</tt></a>s
is then responsible for ensuring that a <a href="#Material"><tt>Material</tt></a>&rsquo;s <tt>GetBxDF()</tt> or
<tt>GetBSSRDF()</tt> method is only called with a texture evaluator that is
able to evaluate its textures.

</p>
<p></p>
<span class="anchor" id="fragment-MaterialInterface-1"></span><div class="fragmentname">&lt;&lt;Material Interface&gt;&gt;+=&nbsp;<a href="#fragment-MaterialInterface-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MaterialInterface-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename <a href="#TextureEvaluator" class="code">TextureEvaluator</a>&gt;
bool <span class="anchor" id="Material::CanEvaluateTextures"></span>CanEvaluateTextures(<a href="#TextureEvaluator" class="code">TextureEvaluator</a> texEval) const;</div><p>


</p>
<p>Materials also may modify the shading normals of objects they are bound to,
usually in order to introduce the appearance of greater geometric detail
than is actually present.  The <a href="#Material"><tt>Material</tt></a> interface has two ways that they may
do so, normal mapping and bump mapping.

</p>
<p><tt>pbrt</tt>&rsquo;s normal mapping code, which will be described in
Section&nbsp;<a href="#sec:normal-mapping">10.5.3</a>, takes an image that specifies the shading
normals.  A <tt>nullptr</tt> value should be returned by this interface method if no
normal map is included with a material.

</p>
<p></p>
<span class="anchor" id="fragment-MaterialInterface-2"></span><div class="fragmentname">&lt;&lt;Material Interface&gt;&gt;+=&nbsp;<a href="#fragment-MaterialInterface-1"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MaterialInterface-3"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">const <a href="../Utilities/Images.html#Image" class="code">Image</a> *<span class="anchor" id="Material::GetNormalMap"></span>GetNormalMap() const;</div><p>


</p>
<p>Alternatively, shading normals may be specified via bump mapping, which
takes a displacement function that specifies surface detail with a
<a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture"><tt>FloatTexture</tt></a>.  A <tt>nullptr</tt> value should be returned if no such
displacement function has been specified.

</p>
<p></p>
<span class="anchor" id="fragment-MaterialInterface-3"></span><div class="fragmentname">&lt;&lt;Material Interface&gt;&gt;+=&nbsp;<a href="#fragment-MaterialInterface-2"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MaterialInterface-4"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode"><a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture" class="code">FloatTexture</a> <span class="anchor" id="Material::GetDisplacement"></span>GetDisplacement() const;</div><p>


</p>
<p>What should be returned by <tt>HasSubsurfaceScattering()</tt> method
implementations should be obvious; this method is used to determine for
which materials in a scene it is necessary to do the additional processing
to model that effect.

</p>
<p></p>
<span class="anchor" id="fragment-MaterialInterface-4"></span><div class="fragmentname">&lt;&lt;Material Interface&gt;&gt;+=&nbsp;<a href="#fragment-MaterialInterface-3"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">bool <span class="anchor" id="Material::HasSubsurfaceScattering"></span>HasSubsurfaceScattering() const;</div><p>


</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#MaterialImplementations"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:mix-material"></span><span id="MaterialImplementations"></span><h3>10.5.1  Material Implementations</h3><p>



</p>
<p>With the preliminaries covered, we will now present a few material
implementations.  All the <a href="#Material"><tt>Material</tt></a>s in <tt>pbrt</tt> are fairly basic
bridges between <a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#Texture"><tt>Texture</tt></a>s and <tt>BxDF</tt>s, so we will focus here on
their basic form and some of the unique details of one of them.

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#x1-DiffuseMaterial"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span id="x1-DiffuseMaterial"></span><h4>Diffuse Material</h4><p>


</p>
<p><a href="#DiffuseMaterial"><tt>DiffuseMaterial</tt></a> is the simplest material implementation and
is a good starting point for understanding the material requirements.

</p>
<p></p>
<span class="anchor" id="fragment-DiffuseMaterialDefinition-0"></span><div class="fragmentname">&lt;&lt;DiffuseMaterial Definition&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">class <span class="anchor" id="DiffuseMaterial"></span>DiffuseMaterial {
  public:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-DiffuseMaterialTypeDefinitions-0">DiffuseMaterial Type Definitions</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1524" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1524"><i></i></a><div id="fragbit-1524" class="collapse"><div class="fragmentcode">       using <a href="../Reflection_Models/BSDF_Representation.html#BxDF" class="code">BxDF</a> = <a href="../Reflection_Models/Diffuse_Reflection.html#DiffuseBxDF" class="code">DiffuseBxDF</a>;
       using BSSRDF = void;</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-DiffuseMaterialPublicMethods-0">DiffuseMaterial Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1525" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1525"><i></i></a><div id="fragbit-1525" class="collapse"><div class="fragmentcode">       static const char *Name() { return "<a href="#TextureEvaluator::operator" class="code">DiffuseMaterial</a>"; }
       
       PBRT_CPU_GPU
       <a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture" class="code">FloatTexture</a> GetDisplacement() const { return displacement; }
       PBRT_CPU_GPU
       const <a href="../Utilities/Images.html#Image" class="code">Image</a> *GetNormalMap() const { return normalMap; }
       
       static <a href="#TextureEvaluator::operator" class="code">DiffuseMaterial</a> *Create(const TextureParameterDictionary &amp;parameters,
                                      <a href="../Utilities/Images.html#Image" class="code">Image</a> *normalMap, const FileLoc *loc, Allocator alloc);
       
       template &lt;typename <a href="#TextureEvaluator" class="code">TextureEvaluator</a>&gt;
       PBRT_CPU_GPU void GetBSSRDF(<a href="#TextureEvaluator" class="code">TextureEvaluator</a> texEval, <a href="#MaterialEvalContext" class="code">MaterialEvalContext</a> ctx,
                                           <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledWavelengths" class="code">SampledWavelengths</a> &amp;lambda,
                                           void *) const {
       }
       
       PBRT_CPU_GPU static constexpr bool HasSubsurfaceScattering() { return false; }
       
       std::string ToString() const;
       <a href="#TextureEvaluator::operator" class="code">DiffuseMaterial</a>(<a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#SpectrumTexture" class="code">SpectrumTexture</a> reflectance,
                       <a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture" class="code">FloatTexture</a> displacement, <a href="../Utilities/Images.html#Image" class="code">Image</a> *normalMap)
           : normalMap(normalMap), displacement(displacement), reflectance(reflectance) {}
       template &lt;typename <a href="#TextureEvaluator" class="code">TextureEvaluator</a>&gt;
       bool CanEvaluateTextures(<a href="#TextureEvaluator" class="code">TextureEvaluator</a> texEval) const {
           return texEval.<a href="#TextureEvaluator::CanEvaluate" class="code">CanEvaluate</a>({}, {reflectance});
       }
       template &lt;typename <a href="#TextureEvaluator" class="code">TextureEvaluator</a>&gt;
       <a href="../Reflection_Models/Diffuse_Reflection.html#DiffuseBxDF" class="code">DiffuseBxDF</a> GetBxDF(<a href="#TextureEvaluator" class="code">TextureEvaluator</a> texEval, <a href="#MaterialEvalContext" class="code">MaterialEvalContext</a> ctx,
                           <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledWavelengths" class="code">SampledWavelengths</a> &amp;lambda) const {
           <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a> r = <a href="../Utilities/Mathematical_Infrastructure.html#Clamp" class="code">Clamp</a>(texEval(reflectance, ctx, lambda), 0, 1);
           return <a href="../Reflection_Models/Diffuse_Reflection.html#DiffuseBxDF" class="code">DiffuseBxDF</a>(r);
       }</div></div>
  private:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-DiffuseMaterialPrivateMembers-0">DiffuseMaterial Private Members</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1526" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1526"><i></i></a><div id="fragbit-1526" class="collapse"><div class="fragmentcode">       <a href="../Utilities/Images.html#Image" class="code">Image</a> *normalMap;
       <a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture" class="code">FloatTexture</a> displacement;
       <a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#SpectrumTexture" class="code">SpectrumTexture</a> reflectance;</div></div>
};</div><p>


</p>
<p>These are the <tt>BxDF</tt> and <tt>BSSRDF</tt> type definitions for
<a href="#DiffuseMaterial"><tt>DiffuseMaterial</tt></a>.  Because this material does not include subsurface
scattering, <tt>BSSRDF</tt> can be set to be <tt>void</tt>.

</p>
<p></p>
<span class="anchor" id="fragment-DiffuseMaterialTypeDefinitions-0"></span><div class="fragmentname">&lt;&lt;DiffuseMaterial Type Definitions&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">using <a href="../Reflection_Models/BSDF_Representation.html#BxDF" class="code">BxDF</a> = <a href="../Reflection_Models/Diffuse_Reflection.html#DiffuseBxDF" class="code">DiffuseBxDF</a>;
using BSSRDF = void;</div><p>


</p>
<p>

</p>
<p>

</p>
<p>The constructor initializes the following member variables with
provided values, so it is not included here.

</p>
<p></p>
<span class="anchor" id="fragment-DiffuseMaterialPrivateMembers-0"></span><div class="fragmentname">&lt;&lt;DiffuseMaterial Private Members&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Utilities/Images.html#Image" class="code">Image</a> *<span class="anchor" id="DiffuseMaterial::normalMap"></span>normalMap;
<a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture" class="code">FloatTexture</a> <span class="anchor" id="DiffuseMaterial::displacement"></span>displacement;
<a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#SpectrumTexture" class="code">SpectrumTexture</a> <span class="anchor" id="DiffuseMaterial::reflectance"></span>reflectance;</div><p>


</p>
<p>The <tt>CanEvaluateTextures()</tt> method is easy to implement; the various
textures used for BSDF evaluation are passed to the given
<a href="#TextureEvaluator"><tt>TextureEvaluator</tt></a>.  Note that the displacement texture is not included
here; if present, it is handled separately by the bump mapping code.

</p>
<p></p>
<span class="anchor" id="fragment-DiffuseMaterialPublicMethods-0"></span><div class="fragmentname">&lt;&lt;DiffuseMaterial Public Methods&gt;&gt;=&nbsp;<a href="#fragment-DiffuseMaterialPublicMethods-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename <a href="#TextureEvaluator" class="code">TextureEvaluator</a>&gt;
bool <span class="anchor" id="DiffuseMaterial::CanEvaluateTextures"></span>CanEvaluateTextures(<a href="#TextureEvaluator" class="code">TextureEvaluator</a> texEval) const {
    return texEval.<a href="#TextureEvaluator::CanEvaluate" class="code">CanEvaluate</a>({}, {reflectance});
}</div><p>


</p>
<p>There is also not very much to <tt>GetBxDF()</tt>; it evaluates the
reflectance texture, clamping the result to the range of valid reflectances
before passing it along to the <a href="../Reflection_Models/Diffuse_Reflection.html#DiffuseBxDF"><tt>DiffuseBxDF</tt></a> constructor and returning
a <a href="../Reflection_Models/Diffuse_Reflection.html#DiffuseBxDF"><tt>DiffuseBxDF</tt></a>.

</p>
<p></p>
<span class="anchor" id="fragment-DiffuseMaterialPublicMethods-1"></span><div class="fragmentname">&lt;&lt;DiffuseMaterial Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-DiffuseMaterialPublicMethods-0"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">template &lt;typename <a href="#TextureEvaluator" class="code">TextureEvaluator</a>&gt;
<a href="../Reflection_Models/Diffuse_Reflection.html#DiffuseBxDF" class="code">DiffuseBxDF</a> <span class="anchor" id="DiffuseMaterial::GetBxDF"></span>GetBxDF(<a href="#TextureEvaluator" class="code">TextureEvaluator</a> texEval, <a href="#MaterialEvalContext" class="code">MaterialEvalContext</a> ctx,
                    <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledWavelengths" class="code">SampledWavelengths</a> &amp;lambda) const {
    <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a> r = <a href="../Utilities/Mathematical_Infrastructure.html#Clamp" class="code">Clamp</a>(texEval(reflectance, ctx, lambda), 0, 1);
    return <a href="../Reflection_Models/Diffuse_Reflection.html#DiffuseBxDF" class="code">DiffuseBxDF</a>(r);
}</div><p>


</p>
<p><tt>GetNormalMap()</tt><span class="anchor" id="DiffuseMaterial::GetNormalMap"></span> and
<tt>GetDisplacement()</tt><span class="anchor" id="DiffuseMaterial::GetDisplacement"></span>
return the corresponding member variables and the remaining methods are
trivial; see the source code for details.

</p>
<p>

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#x1-DielectricMaterial"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span id="x1-DielectricMaterial"></span><h4>Dielectric Material</h4><p>



</p>
<p><tt>DielectricMaterial</tt> represents a dielectric interface.

</p>
<p></p>
<span class="anchor" id="fragment-DielectricMaterialDefinition-0"></span><div class="fragmentname">&lt;&lt;DielectricMaterial Definition&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">class <span class="anchor" id="DielectricMaterial"></span>DielectricMaterial {
  public:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-DielectricMaterialTypeDefinitions-0">DielectricMaterial Type Definitions</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1527" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1527"><i></i></a><div id="fragbit-1527" class="collapse"><div class="fragmentcode">       using <a href="../Reflection_Models/BSDF_Representation.html#BxDF" class="code">BxDF</a> = <a href="../Reflection_Models/Dielectric_BSDF.html#DielectricBxDF" class="code">DielectricBxDF</a>;
       using BSSRDF = void;</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-DielectricMaterialPublicMethods-0">DielectricMaterial Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1528" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1528"><i></i></a><div id="fragbit-1528" class="collapse"><div class="fragmentcode">       DielectricMaterial(<a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture" class="code">FloatTexture</a> uRoughness, <a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture" class="code">FloatTexture</a> vRoughness,
                          <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#Spectrum" class="code">Spectrum</a> eta,
                          <a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture" class="code">FloatTexture</a> displacement, <a href="../Utilities/Images.html#Image" class="code">Image</a> *normalMap,
                          bool remapRoughness)
           : normalMap(normalMap), displacement(displacement), 
             uRoughness(uRoughness),
             vRoughness(vRoughness),
             eta(eta),
             remapRoughness(remapRoughness) {}
       
       static const char *Name() { return "DielectricMaterial"; }
       
       template &lt;typename <a href="#TextureEvaluator" class="code">TextureEvaluator</a>&gt;
       PBRT_CPU_GPU
       bool CanEvaluateTextures(<a href="#TextureEvaluator" class="code">TextureEvaluator</a> texEval) const {
           return texEval.CanEvaluate({uRoughness, vRoughness}, {});
       }
       
       PBRT_CPU_GPU
       <a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture" class="code">FloatTexture</a> GetDisplacement() const { return displacement; }
       PBRT_CPU_GPU
       const <a href="../Utilities/Images.html#Image" class="code">Image</a> *GetNormalMap() const { return normalMap; }
       
       static DielectricMaterial *Create(const TextureParameterDictionary &amp;parameters,
                                         <a href="../Utilities/Images.html#Image" class="code">Image</a> *normalMap, const FileLoc *loc, Allocator alloc);
       
       std::string ToString() const;
       
       template &lt;typename <a href="#TextureEvaluator" class="code">TextureEvaluator</a>&gt;
       PBRT_CPU_GPU void GetBSSRDF(<a href="#TextureEvaluator" class="code">TextureEvaluator</a> texEval, <a href="#MaterialEvalContext" class="code">MaterialEvalContext</a> ctx,
                                           <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledWavelengths" class="code">SampledWavelengths</a> &amp;lambda) const {
       }
       
       PBRT_CPU_GPU static constexpr bool HasSubsurfaceScattering() { return false; }
       template &lt;typename <a href="#TextureEvaluator" class="code">TextureEvaluator</a>&gt;
       <a href="../Reflection_Models/Dielectric_BSDF.html#DielectricBxDF" class="code">DielectricBxDF</a> GetBxDF(<a href="#TextureEvaluator" class="code">TextureEvaluator</a> texEval, <a href="#MaterialEvalContext" class="code">MaterialEvalContext</a> ctx,
                              <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledWavelengths" class="code">SampledWavelengths</a> &amp;lambda) const {
           &lt;&lt;<span class="fragmentname"><a href="#fragment-Computeindexofrefractionfordielectricmaterial-0">Compute index of refraction for dielectric material</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1529" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1529"><i></i></a><div id="fragbit-1529" class="collapse"><div class="fragmentcode">              Float sampledEta = <a href="#DielectricMaterial::eta" class="code">eta</a>(lambda[0]);
              if (!<a href="#DielectricMaterial::eta" class="code">eta</a>.template <a href="../Utilities/Containers_and_Memory_Management.html#TaggedPointer::Is" class="code">Is</a>&lt;<a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#ConstantSpectrum" class="code">ConstantSpectrum</a>&gt;())
                  lambda.<a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledWavelengths::TerminateSecondary" class="code">TerminateSecondary</a>();
              </div></div>
           &lt;&lt;<span class="fragmentname"><a href="#fragment-Createmicrofacetdistributionfordielectricmaterial-0">Create microfacet distribution for dielectric material</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1530" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1530"><i></i></a><div id="fragbit-1530" class="collapse"><div class="fragmentcode">              Float urough = texEval(<a href="#DielectricMaterial::uRoughness" class="code">uRoughness</a>, ctx), vrough = texEval(<a href="#DielectricMaterial::vRoughness" class="code">vRoughness</a>, ctx);
              if (<a href="#DielectricMaterial::remapRoughness" class="code">remapRoughness</a>) {
                  urough = <a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution" class="code">TrowbridgeReitzDistribution</a>::<a href="#TrowbridgeReitzDistribution::RoughnessToAlpha" class="code">RoughnessToAlpha</a>(urough);
                  vrough = <a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution" class="code">TrowbridgeReitzDistribution</a>::<a href="#TrowbridgeReitzDistribution::RoughnessToAlpha" class="code">RoughnessToAlpha</a>(vrough);
              }
              <a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution" class="code">TrowbridgeReitzDistribution</a> distrib(urough, vrough);</div></div>
           &lt;&lt;<span class="fragmentname"><a href="#fragment-ReturnBSDFfordielectricmaterial-0">Return BSDF for dielectric material</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1531" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1531"><i></i></a><div id="fragbit-1531" class="collapse"><div class="fragmentcode">              return <a href="../Reflection_Models/Dielectric_BSDF.html#DielectricBxDF" class="code">DielectricBxDF</a>(sampledEta, distrib);</div></div>
       }</div></div>
  private:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-DielectricMaterialPrivateMembers-0">DielectricMaterial Private Members</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1532" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1532"><i></i></a><div id="fragbit-1532" class="collapse"><div class="fragmentcode">       <a href="../Utilities/Images.html#Image" class="code">Image</a> *normalMap;
       <a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture" class="code">FloatTexture</a> displacement;
       <a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture" class="code">FloatTexture</a> uRoughness, vRoughness;
       bool remapRoughness;
       <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#Spectrum" class="code">Spectrum</a> eta;</div></div>
};</div><p>


</p>
<p>It returns a <a href="../Reflection_Models/Dielectric_BSDF.html#DielectricBxDF"><tt>DielectricBxDF</tt></a> and does not include subsurface
scattering.

</p>
<p></p>
<span class="anchor" id="fragment-DielectricMaterialTypeDefinitions-0"></span><div class="fragmentname">&lt;&lt;DielectricMaterial Type Definitions&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">using <a href="../Reflection_Models/BSDF_Representation.html#BxDF" class="code">BxDF</a> = <a href="../Reflection_Models/Dielectric_BSDF.html#DielectricBxDF" class="code">DielectricBxDF</a>;
using BSSRDF = void;</div><p>


</p>
<p>

</p>
<p><tt>DielectricMaterial</tt> has a few more parameters than <tt>DiffuseMaterial</tt>.  The index of
refraction is specified with a <a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#SpectrumTexture"><tt>SpectrumTexture</tt></a> so that it may
vary with wavelength.  Note also that two roughness values are stored,
which allows the specification of an anisotropic microfacet distribution.  If
the distribution is isotropic, this leads to a minor inefficiency
in storage and, shortly, texture evaluation, since both are always
evaluated.

</p>
<p></p>
<span class="anchor" id="fragment-DielectricMaterialPrivateMembers-0"></span><div class="fragmentname">&lt;&lt;DielectricMaterial Private Members&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Utilities/Images.html#Image" class="code">Image</a> *<span class="anchor" id="DielectricMaterial::normalMap"></span>normalMap;
<a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture" class="code">FloatTexture</a> <span class="anchor" id="DielectricMaterial::displacement"></span>displacement;
<a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture" class="code">FloatTexture</a> <span class="anchor" id="DielectricMaterial::uRoughness"></span>uRoughness, <span class="anchor" id="DielectricMaterial::vRoughness"></span>vRoughness;
bool <span class="anchor" id="DielectricMaterial::remapRoughness"></span>remapRoughness;
<a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#Spectrum" class="code">Spectrum</a> <span class="anchor" id="DielectricMaterial::eta"></span>eta;</div><p>


</p>
<p><tt>GetBxDF()</tt> follows a similar form to <tt>DiffuseMaterial</tt>,
evaluating various textures and using their results to initialize the
returned <a href="../Reflection_Models/Dielectric_BSDF.html#DielectricBxDF"><tt>DielectricBxDF</tt></a>.

</p>
<p></p>
<span class="anchor" id="fragment-DielectricMaterialPublicMethods-0"></span><div class="fragmentname">&lt;&lt;DielectricMaterial Public Methods&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">template &lt;typename <a href="#TextureEvaluator" class="code">TextureEvaluator</a>&gt;
<a href="../Reflection_Models/Dielectric_BSDF.html#DielectricBxDF" class="code">DielectricBxDF</a> <span class="anchor" id="DielectricMaterial::GetBxDF"></span>GetBxDF(<a href="#TextureEvaluator" class="code">TextureEvaluator</a> texEval, <a href="#MaterialEvalContext" class="code">MaterialEvalContext</a> ctx,
                       <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledWavelengths" class="code">SampledWavelengths</a> &amp;lambda) const {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Computeindexofrefractionfordielectricmaterial-0">Compute index of refraction for dielectric material</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1533" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1533"><i></i></a><div id="fragbit-1533" class="collapse"><div class="fragmentcode">       Float sampledEta = <a href="#DielectricMaterial::eta" class="code">eta</a>(lambda[0]);
       if (!<a href="#DielectricMaterial::eta" class="code">eta</a>.template <a href="../Utilities/Containers_and_Memory_Management.html#TaggedPointer::Is" class="code">Is</a>&lt;<a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#ConstantSpectrum" class="code">ConstantSpectrum</a>&gt;())
           lambda.<a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledWavelengths::TerminateSecondary" class="code">TerminateSecondary</a>();
       </div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Createmicrofacetdistributionfordielectricmaterial-0">Create microfacet distribution for dielectric material</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1534" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1534"><i></i></a><div id="fragbit-1534" class="collapse"><div class="fragmentcode">       Float urough = texEval(<a href="#DielectricMaterial::uRoughness" class="code">uRoughness</a>, ctx), vrough = texEval(<a href="#DielectricMaterial::vRoughness" class="code">vRoughness</a>, ctx);
       if (<a href="#DielectricMaterial::remapRoughness" class="code">remapRoughness</a>) {
           urough = <a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution" class="code">TrowbridgeReitzDistribution</a>::<a href="#TrowbridgeReitzDistribution::RoughnessToAlpha" class="code">RoughnessToAlpha</a>(urough);
           vrough = <a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution" class="code">TrowbridgeReitzDistribution</a>::<a href="#TrowbridgeReitzDistribution::RoughnessToAlpha" class="code">RoughnessToAlpha</a>(vrough);
       }
       <a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution" class="code">TrowbridgeReitzDistribution</a> distrib(urough, vrough);</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ReturnBSDFfordielectricmaterial-0">Return BSDF for dielectric material</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1535" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1535"><i></i></a><div id="fragbit-1535" class="collapse"><div class="fragmentcode">       return <a href="../Reflection_Models/Dielectric_BSDF.html#DielectricBxDF" class="code">DielectricBxDF</a>(sampledEta, distrib);</div></div>
}</div><p>


</p>
<p>If the index of refraction is the same for all wavelengths, then all
wavelengths will follow the same path if a ray is refracted.  Otherwise,
they will go in different directions&mdash;this is dispersion.  In that case,
<tt>pbrt</tt> only follows a single ray path according to the first wavelength in
<a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledWavelengths"><tt>SampledWavelengths</tt></a> rather than tracing multiple rays to track each of
them, and a call to <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledWavelengths::TerminateSecondary"><tt>SampledWavelengths::TerminateSecondary()</tt></a> is
necessary.  (See Section&nbsp;<a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#sec:sampled-spectral-distributions">4.5.4</a> for more
information.)

</p>
<p><a href="#DielectricMaterial"><tt>DielectricMaterial</tt></a> therefore calls <tt>TerminateSecondary()</tt> unless
the index of refraction is known to be constant, as determined by checking
if <tt>eta</tt>&rsquo;s <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#Spectrum"><tt>Spectrum</tt></a> type is a <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#ConstantSpectrum"><tt>ConstantSpectrum</tt></a>.  This
check does not detect all cases where the sampled spectrum values are all
the same, but it catches most of them in practice, and unnecessarily
terminating the secondary wavelengths affects performance but not
correctness.  A bigger shortcoming of the implementation here is that there is
no dispersion if light is reflected at a
surface and not refracted.  In that case, all wavelengths
could still be followed.  However, how light paths will be sampled at the
surface is not known at this point in program execution.  

</p>
<p></p>
<span class="anchor" id="fragment-Computeindexofrefractionfordielectricmaterial-0"></span><div class="fragmentname">&lt;&lt;Compute index of refraction for dielectric material&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float sampledEta = <a href="#DielectricMaterial::eta" class="code">eta</a>(lambda[0]);
if (!<a href="#DielectricMaterial::eta" class="code">eta</a>.template <a href="../Utilities/Containers_and_Memory_Management.html#TaggedPointer::Is" class="code">Is</a>&lt;<a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#ConstantSpectrum" class="code">ConstantSpectrum</a>&gt;())
    lambda.<a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledWavelengths::TerminateSecondary" class="code">TerminateSecondary</a>();
</div><p>


</p>
<p>It can be convenient to specify a microfacet distribution&rsquo;s roughness with
a scalar parameter in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.653ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2003.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket 0 comma 1 right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1224" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="1724" y="0"></use>
</g>
</svg>, where values close to zero correspond to
near-perfect specular reflection, rather than by specifying <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.488ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 640.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">alpha</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D6FC" d="M602 383c0 0 -21 -117 -115 -235c-10 -12 -10 -14 -10 -35c0 -24 0 -102 31 -102c0 0 38 0 56 49c3 7 6 10 13 10c6 0 12 -3 12 -10c0 -16 -31 -71 -84 -71c-45 0 -78 31 -91 84c-76 -61 -148 -84 -211 -84c-102 0 -162 76 -162 169c0 141 132 284 269 284 c74 0 167 -49 167 -206v-62c47 59 80 135 98 198c5 18 5 21 15 21c11 0 12 -10 12 -10zM410 99c-2 17 -2 75 -2 112c0 78 0 209 -99 209c-35 0 -89 -19 -136 -92c-32 -51 -58 -159 -58 -208c0 -64 30 -109 90 -109c40 0 117 11 205 88Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D6FC" x="0" y="0"></use>
</g>
</svg> values
directly.  The <tt>RoughnessToAlpha()</tt> method performs a mapping that
gives a reasonably intuitive control for surface appearance.

</p>
<p></p>
<span class="anchor" id="fragment-TrowbridgeReitzDistributionPublicMethods-9"></span><div class="fragmentname">&lt;&lt;TrowbridgeReitzDistribution Public Methods&gt;&gt;+=&nbsp;<a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#fragment-TrowbridgeReitzDistributionPublicMethods-8"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="../Light_Transport_I_Surface_Reflection/A_Better_Path_Tracer.html#fragment-TrowbridgeReitzDistributionPublicMethods-10"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">static Float <span class="anchor" id="TrowbridgeReitzDistribution::RoughnessToAlpha"></span>RoughnessToAlpha(Float roughness) {
    return std::sqrt(roughness);
}</div><p>


</p>
<p>The <tt>GetBxDF()</tt> method then evaluates the roughness textures and
remaps the returned values if required.

</p>
<p></p>
<span class="anchor" id="fragment-Createmicrofacetdistributionfordielectricmaterial-0"></span><div class="fragmentname">&lt;&lt;Create microfacet distribution for dielectric material&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float urough = texEval(<a href="#DielectricMaterial::uRoughness" class="code">uRoughness</a>, ctx), vrough = texEval(<a href="#DielectricMaterial::vRoughness" class="code">vRoughness</a>, ctx);
if (<a href="#DielectricMaterial::remapRoughness" class="code">remapRoughness</a>) {
    urough = <a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution" class="code">TrowbridgeReitzDistribution</a>::<a href="#TrowbridgeReitzDistribution::RoughnessToAlpha" class="code">RoughnessToAlpha</a>(urough);
    vrough = <a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution" class="code">TrowbridgeReitzDistribution</a>::<a href="#TrowbridgeReitzDistribution::RoughnessToAlpha" class="code">RoughnessToAlpha</a>(vrough);
}
<a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution" class="code">TrowbridgeReitzDistribution</a> distrib(urough, vrough);</div><p>


</p>
<p>Given the index of refraction and microfacet distribution, it is easy to
pull the pieces together to return the final <tt>BxDF</tt>.

</p>
<p></p>
<span class="anchor" id="fragment-ReturnBSDFfordielectricmaterial-0"></span><div class="fragmentname">&lt;&lt;Return BSDF for dielectric material&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">return <a href="../Reflection_Models/Dielectric_BSDF.html#DielectricBxDF" class="code">DielectricBxDF</a>(sampledEta, distrib);</div><p>


</p>
<p>

</p>
<p>

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#x1-MixMaterial"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span id="x1-MixMaterial"></span><h4>Mix Material</h4><p>



</p>
<p>The final material implementation that we will describe in the text is
<tt>MixMaterial</tt>, which stores two other materials and uses a
<tt>Float</tt>-valued texture to blend between them.

</p>
<p></p>
<span class="anchor" id="fragment-MixMaterialDefinition-0"></span><div class="fragmentname">&lt;&lt;MixMaterial Definition&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">class <span class="anchor" id="MixMaterial"></span>MixMaterial {
public:
  &lt;&lt;<span class="fragmentname">MixMaterial Type Definitions</span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1536" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1536"><i></i></a><div id="fragbit-1536" class="collapse"><div class="fragmentcode">     using <a href="../Reflection_Models/BSDF_Representation.html#BxDF" class="code">BxDF</a> = void;
     using BSSRDF = void;</div></div>
  &lt;&lt;<span class="fragmentname"><a href="#fragment-MixMaterialPublicMethods-0">MixMaterial Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1537" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1537"><i></i></a><div id="fragbit-1537" class="collapse"><div class="fragmentcode">     MixMaterial(<a href="#Material" class="code">Material</a> m[2], <a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture" class="code">FloatTexture</a> <a href="#MixMaterial::amount" class="code">amount</a>)
         : <a href="#MixMaterial::amount" class="code">amount</a>(<a href="#MixMaterial::amount" class="code">amount</a>) {
         <a href="#MixMaterial::materials" class="code">materials</a>[0] = m[0];
         <a href="#MixMaterial::materials" class="code">materials</a>[1] = m[1];
     }
     template &lt;typename <a href="#TextureEvaluator" class="code">TextureEvaluator</a>&gt;
     <a href="#Material" class="code">Material</a> ChooseMaterial(<a href="#TextureEvaluator" class="code">TextureEvaluator</a> texEval,
                             <a href="#MaterialEvalContext" class="code">MaterialEvalContext</a> ctx) const {
         Float amt = texEval(<a href="#MixMaterial::amount" class="code">amount</a>, ctx);
         if (amt &lt;= 0) return <a href="#MixMaterial::materials" class="code">materials</a>[0];
         if (amt &gt;= 1) return <a href="#MixMaterial::materials" class="code">materials</a>[1];
         Float u = <a href="../Utilities/Mathematical_Infrastructure.html#HashFloat" class="code">HashFloat</a>(ctx.<a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureEvalContext::p" class="code">p</a>, ctx.<a href="#MaterialEvalContext::wo" class="code">wo</a>, <a href="#MixMaterial::materials" class="code">materials</a>[0], <a href="#MixMaterial::materials" class="code">materials</a>[1]);
         return (amt &lt; u) ? <a href="#MixMaterial::materials" class="code">materials</a>[0] : <a href="#MixMaterial::materials" class="code">materials</a>[1];
     }
     <a href="#Material" class="code">Material</a> GetMaterial(int i) const { return <a href="#MixMaterial::materials" class="code">materials</a>[i]; }
     static const char *Name() { return "MixMaterial"; }
     
     PBRT_CPU_GPU
     <a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture" class="code">FloatTexture</a> GetDisplacement() const {
     #ifndef PBRT_IS_GPU_CODE
         <a href="../Utilities/User_Interaction.html#LOG_FATAL" class="code">LOG_FATAL</a>("Shouldn't be called");
     #endif
         return nullptr;
     }
     
     PBRT_CPU_GPU
     const <a href="../Utilities/Images.html#Image" class="code">Image</a> *GetNormalMap() const {
     #ifndef PBRT_IS_GPU_CODE
         <a href="../Utilities/User_Interaction.html#LOG_FATAL" class="code">LOG_FATAL</a>("Shouldn't be called");
     #endif
         return nullptr;
     }
     
     static MixMaterial *Create(<a href="#Material" class="code">Material</a> <a href="#MixMaterial::materials" class="code">materials</a>[2],
                                const TextureParameterDictionary &amp;parameters,
                                const FileLoc *loc, Allocator alloc);
     
     template &lt;typename <a href="#TextureEvaluator" class="code">TextureEvaluator</a>&gt;
     PBRT_CPU_GPU void GetBSSRDF(<a href="#TextureEvaluator" class="code">TextureEvaluator</a> texEval, <a href="#MaterialEvalContext" class="code">MaterialEvalContext</a> ctx,
                                         <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledWavelengths" class="code">SampledWavelengths</a> &amp;lambda) const {
     #ifndef PBRT_IS_GPU_CODE
         <a href="../Utilities/User_Interaction.html#LOG_FATAL" class="code">LOG_FATAL</a>("Shouldn't be called");
     #endif
     }
     
     PBRT_CPU_GPU static constexpr bool HasSubsurfaceScattering() { return false; }
     
     std::string ToString() const;
     template &lt;typename <a href="#TextureEvaluator" class="code">TextureEvaluator</a>&gt;
     bool CanEvaluateTextures(<a href="#TextureEvaluator" class="code">TextureEvaluator</a> texEval) const {
         return texEval.CanEvaluate({<a href="#MixMaterial::amount" class="code">amount</a>}, {});
     }
     template &lt;typename <a href="#TextureEvaluator" class="code">TextureEvaluator</a>&gt;
     void GetBxDF(<a href="#TextureEvaluator" class="code">TextureEvaluator</a> texEval, <a href="#MaterialEvalContext" class="code">MaterialEvalContext</a> ctx,
                  <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledWavelengths" class="code">SampledWavelengths</a> &amp;lambda) const {
         <a href="../Utilities/User_Interaction.html#LOG_FATAL" class="code">LOG_FATAL</a>("MixMaterial::GetBxDF() shouldn't be called");
     }</div></div>
private:
  &lt;&lt;<span class="fragmentname"><a href="#fragment-MixMaterialPrivateMembers-0">MixMaterial Private Members</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1538" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1538"><i></i></a><div id="fragbit-1538" class="collapse"><div class="fragmentcode">     <a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture" class="code">FloatTexture</a> amount;
     <a href="#Material" class="code">Material</a> materials[2];</div></div>
};</div><p>


</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-MixMaterialPrivateMembers-0"></span><div class="fragmentname">&lt;&lt;MixMaterial Private Members&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture" class="code">FloatTexture</a> <span class="anchor" id="MixMaterial::amount"></span>amount;
<a href="#Material" class="code">Material</a> <span class="anchor" id="MixMaterial::materials"></span>materials[2];</div><p>


</p>
<p>

</p>
<p><tt>MixMaterial</tt> does not cleanly fit into <tt>pbrt</tt>&rsquo;s <tt>Material</tt>
abstraction.  For example, it is unable to define a single <tt>BxDF</tt>
type that it will return, since its two constituent materials may have different <tt>BxDF</tt>s,
and may themselves be <tt>MixMaterial</tt>s, for that matter.  Thus, <tt>MixMaterial</tt>
requires special handling by the code that uses materials.  (For example,
there is a special case for <tt>MixMaterial</tt>s in the
<a href="#SurfaceInteraction::GetBSDF"><tt>SurfaceInteraction::GetBSDF()</tt></a> method described in Section&nbsp;<a href="#sec:finding-bsdf-surface">10.5.2</a>.)

</p>
<p>This is not ideal: as a general point of software design, it would be
better to have abstractions that make it possible to provide this
functionality without requiring special-case handling in calling code.
However, we were unable to find a clean way to do this while still being able
to statically reason about the type of <tt>BxDF</tt> a material will return;
that aspect of the <tt>Material</tt> interface offers enough of a performance
benefit that we did not want to change it.

</p>
<p>Therefore, when a <tt>MixMaterial</tt> is encountered, one of its constituent materials
is randomly chosen, with probability given by the floating-point
<tt>amount</tt> texture.  Thus, a 50/50 mix of two materials is not
represented by the average of their respective BSDFs and so forth, but
instead by each of them being evaluated half the time.  This is effectively
the material analog of the stochastic alpha test that was described in
Section&nbsp;<a href="../Primitives_and_Intersection_Acceleration/Primitive_Interface_and_Geometric_Primitives.html#sec:gprim">7.1.1</a>.  The <tt>ChooseMaterial()</tt> method implements
the logic.

</p>
<p></p>
<span class="anchor" id="fragment-MixMaterialPublicMethods-0"></span><div class="fragmentname">&lt;&lt;MixMaterial Public Methods&gt;&gt;=&nbsp;<a href="#fragment-MixMaterialPublicMethods-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename <a href="#TextureEvaluator" class="code">TextureEvaluator</a>&gt;
<a href="#Material" class="code">Material</a> <span class="anchor" id="MixMaterial::ChooseMaterial"></span>ChooseMaterial(<a href="#TextureEvaluator" class="code">TextureEvaluator</a> texEval,
                        <a href="#MaterialEvalContext" class="code">MaterialEvalContext</a> ctx) const {
    Float amt = texEval(<a href="#MixMaterial::amount" class="code">amount</a>, ctx);
    if (amt &lt;= 0) return <a href="#MixMaterial::materials" class="code">materials</a>[0];
    if (amt &gt;= 1) return <a href="#MixMaterial::materials" class="code">materials</a>[1];
    Float u = <a href="../Utilities/Mathematical_Infrastructure.html#HashFloat" class="code">HashFloat</a>(ctx.<a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureEvalContext::p" class="code">p</a>, ctx.<a href="#MaterialEvalContext::wo" class="code">wo</a>, <a href="#MixMaterial::materials" class="code">materials</a>[0], <a href="#MixMaterial::materials" class="code">materials</a>[1]);
    return (amt &lt; u) ? <a href="#MixMaterial::materials" class="code">materials</a>[0] : <a href="#MixMaterial::materials" class="code">materials</a>[1];
}</div><p>


</p>
<p></p>
<span class="anchor" id="fig:mix-material-stochastic"></span><div class="card outerfigure"><div class="card-body figure"><p>


</p>

<div class="card-img-top" style="display:block; width: 100%; padding-top: 48.000%;  position:relative;">
<div id="xa_1_sample_per_pixel37" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0;"></div></div>
<script>
Jeri.renderViewer(document.getElementById('xa_1_sample_per_pixel37'), {
  title: '(a)_1_sample_per_pixel37', children: [
 { title: '(a) 1 sample per pixel', image: 'dragon-mix-1spp.png' },  { title: '(b) 128 samples per pixel', image: 'dragon-mix-128spp.png' }]});
</script>
<button data-toggle="tooltip" data-placement="left" class="btn yojeri" title="This image is interactive. Click and drag to pan and use the mouse-wheel to zoom. After clicking on the image to select it, type '?' to see a summary of keyboard controls."><i class="fa fa-snowflake fa-border"></i></button><p>

</p>
<figcaption class="caption">Figure 10.20: Effect of Sampling Rate with the <a href="#MixMaterial"><tt>MixMaterial</tt></a>. <span class="legend"> 
In this scene, the <a href="#MixMaterial"><tt>MixMaterial</tt></a> is used to blend between blue and red
diffuse materials for the dragon, using an equal weighting for each.
(a)&nbsp;With one sample per pixel, there is visible noise in the corresponding
pixels since each pixel only includes one of the two constituent materials.
(b)&nbsp;With a sufficient number of samples (here, 128), stochastic selection
of materials causes no visual harm.  In practice, the pixel sampling rates
necessary to reduce other forms of error from simulating light transport
are almost always enough to resolve stochastic material sampling.
</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>Stochastic selection of materials can introduce noise in images at low
sampling rates; see Figure&nbsp;<a href="#fig:mix-material-stochastic">10.20</a>.  However, a
few tens of samples are generally plenty to resolve any visual error. 
Furthermore, this approach does bring benefits: sampling and evaluation of the
resulting <a href="../Reflection_Models/BSDF_Representation.html#BSDF"><tt>BSDF</tt></a> is more efficient than if it was a weighted sum of the
<a href="../Reflection_Models/BSDF_Representation.html#BSDF"><tt>BSDF</tt></a>s from the constituent materials.

</p>
<p><tt>MixMaterial</tt> provides an accessor that makes it possible to traverse
all the materials in the scene, including those nested inside a
<tt>MixMaterial</tt>, so that it is possible to perform operations such as
determining which types of materials are and are not present in a scene.

</p>
<p></p>
<span class="anchor" id="fragment-MixMaterialPublicMethods-1"></span><div class="fragmentname">&lt;&lt;MixMaterial Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-MixMaterialPublicMethods-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MixMaterialPublicMethods-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode"><a href="#Material" class="code">Material</a> <span class="anchor" id="MixMaterial::GetMaterial"></span>GetMaterial(int i) const { return <a href="#MixMaterial::materials" class="code">materials</a>[i]; }</div><p>


</p>
<p>

</p>
<p>

</p>
<p>A fatal error is issued if the <tt>GetBxDF()</tt> method is called.  A call
to <tt>GetBSSRDF()</tt><span class="anchor" id="MixMaterial::GetBSSRDF"></span> is handled
similarly, in code not included here.

</p>
<p></p>
<span class="anchor" id="fragment-MixMaterialPublicMethods-2"></span><div class="fragmentname">&lt;&lt;MixMaterial Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-MixMaterialPublicMethods-1"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">template &lt;typename <a href="#TextureEvaluator" class="code">TextureEvaluator</a>&gt;
void <span class="anchor" id="MixMaterial::GetBxDF"></span>GetBxDF(<a href="#TextureEvaluator" class="code">TextureEvaluator</a> texEval, <a href="#MaterialEvalContext" class="code">MaterialEvalContext</a> ctx,
             <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledWavelengths" class="code">SampledWavelengths</a> &amp;lambda) const {
    <a href="../Utilities/User_Interaction.html#LOG_FATAL" class="code">LOG_FATAL</a>("MixMaterial::GetBxDF() shouldn't be called");
}</div><p>


</p>
<p>

</p>
<p>

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#FindingtheBSDFataSurface"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:finding-bsdf-surface"></span><span id="FindingtheBSDFataSurface"></span><h3>10.5.2  Finding the BSDF at a Surface</h3><p>



</p>
<p>Because <tt>pbrt</tt>&rsquo;s <a href="../Introduction/pbrt_System_Overview.html#Integrator"><tt>Integrator</tt></a>s use the
<a href="../Geometry_and_Transformations/Interactions.html#SurfaceInteraction"><tt>SurfaceInteraction</tt></a> class to collect the necessary information
associated with each intersection point, we will add a <tt>GetBSDF()</tt>
method to this class that handles all the details related to computing
the BSDF at its point.

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-SurfaceInteractionMethodDefinitions-3"></span><div class="fragmentname">&lt;&lt;SurfaceInteraction Method Definitions&gt;&gt;+=&nbsp;<a href="Texture_Sampling_and_Antialiasing.html#fragment-SurfaceInteractionMethodDefinitions-2"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="../Light_Sources/Area_Lights.html#fragment-SurfaceInteractionMethodDefinitions-4"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode"><a href="../Reflection_Models/BSDF_Representation.html#BSDF" class="code">BSDF</a> <span class="anchor" id="SurfaceInteraction::GetBSDF"></span><a href="../Geometry_and_Transformations/Interactions.html#SurfaceInteraction" class="code">SurfaceInteraction</a>::GetBSDF(
        const <a href="../Geometry_and_Transformations/Rays.html#RayDifferential" class="code">RayDifferential</a> &amp;ray, <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledWavelengths" class="code">SampledWavelengths</a> &amp;lambda,
        <a href="../Cameras_and_Film/Camera_Interface.html#Camera" class="code">Camera</a> camera, <a href="../Utilities/Containers_and_Memory_Management.html#ScratchBuffer" class="code">ScratchBuffer</a> &amp;scratchBuffer, <a href="../Sampling_and_Reconstruction/Sampling_Interface.html#Sampler" class="code">Sampler</a> sampler) {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Estimateuvandpositiondifferentialsatintersectionpoint-0">Estimate <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.301ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2282.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis u comma v right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="962" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="1407" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1892" y="0"></use>
</g>
</svg> and position differentials at intersection point</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1539" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1539"><i></i></a><div id="fragbit-1539" class="collapse"><div class="fragmentcode">       <a href="../Textures_and_Materials/Texture_Sampling_and_Antialiasing.html#SurfaceInteraction::ComputeDifferentials" class="code">ComputeDifferentials</a>(ray, camera, sampler.<a href="../Sampling_and_Reconstruction/Sampling_Interface.html#Sampler::SamplesPerPixel" class="code">SamplesPerPixel</a>());</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ResolvemonoMixMaterialifnecessary-0">Resolve <tt>MixMaterial</tt> if necessary</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1540" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1540"><i></i></a><div id="fragbit-1540" class="collapse"><div class="fragmentcode">       while (<a href="../Primitives_and_Intersection_Acceleration/Primitive_Interface_and_Geometric_Primitives.html#SurfaceInteraction::material" class="code">material</a>.<a href="../Utilities/Containers_and_Memory_Management.html#TaggedPointer::Is" class="code">Is</a>&lt;<a href="#MixMaterial" class="code">MixMaterial</a>&gt;()) {
           <a href="#MixMaterial" class="code">MixMaterial</a> *mix = <a href="../Primitives_and_Intersection_Acceleration/Primitive_Interface_and_Geometric_Primitives.html#SurfaceInteraction::material" class="code">material</a>.<a href="../Utilities/Containers_and_Memory_Management.html#TaggedPointer::Cast" class="code">Cast</a>&lt;<a href="#MixMaterial" class="code">MixMaterial</a>&gt;();
           <a href="../Primitives_and_Intersection_Acceleration/Primitive_Interface_and_Geometric_Primitives.html#SurfaceInteraction::material" class="code">material</a> = mix-&gt;<a href="#MixMaterial::ChooseMaterial" class="code">ChooseMaterial</a>(UniversalTextureEvaluator(), *this);
       }</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ReturnunsetmonoBSDFifsurfacehasanullmaterial-0">Return unset <tt>BSDF</tt> if surface has a null material</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1541" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1541"><i></i></a><div id="fragbit-1541" class="collapse"><div class="fragmentcode">       if (!<a href="../Primitives_and_Intersection_Acceleration/Primitive_Interface_and_Geometric_Primitives.html#SurfaceInteraction::material" class="code">material</a>)
           return {};</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Evaluatenormalorbumpmapifpresent-0">Evaluate normal or bump map, if present</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1542" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1542"><i></i></a><div id="fragbit-1542" class="collapse"><div class="fragmentcode">       <a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture" class="code">FloatTexture</a> displacement = <a href="../Primitives_and_Intersection_Acceleration/Primitive_Interface_and_Geometric_Primitives.html#SurfaceInteraction::material" class="code">material</a>.<a href="#Material::GetDisplacement" class="code">GetDisplacement</a>();
       const <a href="../Utilities/Images.html#Image" class="code">Image</a> *normalMap = <a href="../Primitives_and_Intersection_Acceleration/Primitive_Interface_and_Geometric_Primitives.html#SurfaceInteraction::material" class="code">material</a>.<a href="#Material::GetNormalMap" class="code">GetNormalMap</a>();
       if (displacement || normalMap) {
           &lt;&lt;<span class="fragmentname"><a href="#fragment-Getshadingdpduanddpdvusingnormalorbumpmap-0">Get shading <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.509ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2802.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential normal p slash partial-differential u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1143" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1643" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="2230" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.307ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2715.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential normal p slash partial-differential v</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1143" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1643" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="2230" y="0"></use>
</g>
</svg> using normal or bump map</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1543" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1543"><i></i></a><div id="fragbit-1543" class="collapse"><div class="fragmentcode">              <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> dpdu, dpdv;
              if (normalMap)
                  <a href="#NormalMap" class="code">NormalMap</a>(*normalMap, *this, &amp;dpdu, &amp;dpdv);
              else
                  <a href="#BumpMap" class="code">BumpMap</a>(UniversalTextureEvaluator(), displacement, *this, &amp;dpdu, &amp;dpdv);</div></div>
           <a href="../Geometry_and_Transformations/Normals.html#Normal3f" class="code">Normal3f</a> ns(<a href="../Geometry_and_Transformations/Vectors.html#Normalize" class="code">Normalize</a>(<a href="../Geometry_and_Transformations/Vectors.html#Cross" class="code">Cross</a>(dpdu, dpdv)));
           <a href="../Geometry_and_Transformations/Interactions.html#SurfaceInteraction::SetShadingGeometry" class="code">SetShadingGeometry</a>(ns, dpdu, dpdv, shading.<a href="../Geometry_and_Transformations/Interactions.html#SurfaceInteraction::shading::dndu" class="code">dndu</a>, shading.<a href="../Geometry_and_Transformations/Interactions.html#SurfaceInteraction::shading::dndv" class="code">dndv</a>, false);
       }</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ReturnBSDFforsurfaceinteraction-0">Return BSDF for surface interaction</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1544" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1544"><i></i></a><div id="fragbit-1544" class="collapse"><div class="fragmentcode">       <a href="../Reflection_Models/BSDF_Representation.html#BSDF" class="code">BSDF</a> bsdf = <a href="../Primitives_and_Intersection_Acceleration/Primitive_Interface_and_Geometric_Primitives.html#SurfaceInteraction::material" class="code">material</a>.<a href="#Material::GetBSDF" class="code">GetBSDF</a>(UniversalTextureEvaluator(), *this, lambda,
                                    scratchBuffer);
       if (bsdf &amp;&amp; <a href="../Utilities/System_Startup,_Cleanup,_and_Options.html#GetOptions" class="code">GetOptions</a>().<a href="../Utilities/System_Startup,_Cleanup,_and_Options.html#BasicPBRTOptions::forceDiffuse" class="code">forceDiffuse</a>) {
           &lt;&lt;<span class="fragmentname"><a href="#fragment-Overridemonobsdfwithdiffuseequivalent-0">Override <tt>bsdf</tt> with diffuse equivalent</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1545" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1545"><i></i></a><div id="fragbit-1545" class="collapse"><div class="fragmentcode">              <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a> r = bsdf.<a href="../Reflection_Models/BSDF_Representation.html#BSDF::rho" class="code">rho</a>(wo, {sampler.<a href="../Sampling_and_Reconstruction/Sampling_Interface.html#Sampler::Get1D" class="code">Get1D</a>()}, {sampler.<a href="../Sampling_and_Reconstruction/Sampling_Interface.html#Sampler::Get2D" class="code">Get2D</a>()});
              bsdf = <a href="../Reflection_Models/BSDF_Representation.html#BSDF" class="code">BSDF</a>(shading.<a href="../Geometry_and_Transformations/Interactions.html#SurfaceInteraction::shading::n" class="code">n</a>, shading.<a href="../Geometry_and_Transformations/Interactions.html#SurfaceInteraction::shading::dpdu" class="code">dpdu</a>,
                          scratchBuffer.<a href="../Utilities/Containers_and_Memory_Management.html#ScratchBuffer::Alloc" class="code">Alloc</a>&lt;<a href="../Reflection_Models/Diffuse_Reflection.html#DiffuseBxDF" class="code">DiffuseBxDF</a>&gt;(r));</div></div>
       }
       return bsdf;</div></div>
}</div><p>


</p>
<p>This method first calls the <tt>SurfaceInteraction</tt>&rsquo;s
<tt>ComputeDifferentials()</tt> method to compute information about the
projected size of the surface area around the intersection on the image
plane for use in texture antialiasing.

</p>
<p></p>
<span class="anchor" id="fragment-Estimateuvandpositiondifferentialsatintersectionpoint-0"></span><div class="fragmentname">&lt;&lt;Estimate <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.301ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2282.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis u comma v right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="962" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="1407" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1892" y="0"></use>
</g>
</svg> and position differentials at intersection point&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Textures_and_Materials/Texture_Sampling_and_Antialiasing.html#SurfaceInteraction::ComputeDifferentials" class="code">ComputeDifferentials</a>(ray, camera, sampler.<a href="../Sampling_and_Reconstruction/Sampling_Interface.html#Sampler::SamplesPerPixel" class="code">SamplesPerPixel</a>());</div><p>


</p>
<p>As described in Section&nbsp;<a href="#sec:mix-material">10.5.1</a>, if there is a
<a href="#MixMaterial"><tt>MixMaterial</tt></a> at the intersection point, it is necessary to resolve it
to be a regular material.  A <tt>while</tt> loop here ensures that nested
<tt>MixMaterial</tt>s are handled correctly.

</p>
<p></p>
<span class="anchor" id="fragment-ResolvemonoMixMaterialifnecessary-0"></span><div class="fragmentname">&lt;&lt;Resolve <tt>MixMaterial</tt> if necessary&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">while (<a href="../Primitives_and_Intersection_Acceleration/Primitive_Interface_and_Geometric_Primitives.html#SurfaceInteraction::material" class="code">material</a>.<a href="../Utilities/Containers_and_Memory_Management.html#TaggedPointer::Is" class="code">Is</a>&lt;<a href="#MixMaterial" class="code">MixMaterial</a>&gt;()) {
    <a href="#MixMaterial" class="code">MixMaterial</a> *mix = <a href="../Primitives_and_Intersection_Acceleration/Primitive_Interface_and_Geometric_Primitives.html#SurfaceInteraction::material" class="code">material</a>.<a href="../Utilities/Containers_and_Memory_Management.html#TaggedPointer::Cast" class="code">Cast</a>&lt;<a href="#MixMaterial" class="code">MixMaterial</a>&gt;();
    <a href="../Primitives_and_Intersection_Acceleration/Primitive_Interface_and_Geometric_Primitives.html#SurfaceInteraction::material" class="code">material</a> = mix-&gt;<a href="#MixMaterial::ChooseMaterial" class="code">ChooseMaterial</a>(UniversalTextureEvaluator(), *this);
}</div><p>


</p>
<p>If the final material is <tt>nullptr</tt>, it represents a non-scattering
interface between two types of participating media.  In this case, a
default uninitialized <tt>BSDF</tt> is returned.

</p>
<p></p>
<span class="anchor" id="fragment-ReturnunsetmonoBSDFifsurfacehasanullmaterial-0"></span><div class="fragmentname">&lt;&lt;Return unset <tt>BSDF</tt> if surface has a null material&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">if (!<a href="../Primitives_and_Intersection_Acceleration/Primitive_Interface_and_Geometric_Primitives.html#SurfaceInteraction::material" class="code">material</a>)
    return {};</div><p>


</p>
<p>Otherwise, normal or bump mapping is performed before the <a href="../Reflection_Models/BSDF_Representation.html#BSDF"><tt>BSDF</tt></a> is created.

</p>
<p></p>
<span class="anchor" id="fragment-Evaluatenormalorbumpmapifpresent-0"></span><div class="fragmentname">&lt;&lt;Evaluate normal or bump map, if present&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture" class="code">FloatTexture</a> displacement = <a href="../Primitives_and_Intersection_Acceleration/Primitive_Interface_and_Geometric_Primitives.html#SurfaceInteraction::material" class="code">material</a>.<a href="#Material::GetDisplacement" class="code">GetDisplacement</a>();
const <a href="../Utilities/Images.html#Image" class="code">Image</a> *normalMap = <a href="../Primitives_and_Intersection_Acceleration/Primitive_Interface_and_Geometric_Primitives.html#SurfaceInteraction::material" class="code">material</a>.<a href="#Material::GetNormalMap" class="code">GetNormalMap</a>();
if (displacement || normalMap) {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Getshadingdpduanddpdvusingnormalorbumpmap-0">Get shading <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.509ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2802.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential normal p slash partial-differential u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1143" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1643" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="2230" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.307ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2715.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential normal p slash partial-differential v</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1143" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1643" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="2230" y="0"></use>
</g>
</svg> using normal or bump map</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1546" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1546"><i></i></a><div id="fragbit-1546" class="collapse"><div class="fragmentcode">       <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> dpdu, dpdv;
       if (normalMap)
           <a href="#NormalMap" class="code">NormalMap</a>(*normalMap, *this, &amp;dpdu, &amp;dpdv);
       else
           <a href="#BumpMap" class="code">BumpMap</a>(UniversalTextureEvaluator(), displacement, *this, &amp;dpdu, &amp;dpdv);</div></div>
    <a href="../Geometry_and_Transformations/Normals.html#Normal3f" class="code">Normal3f</a> ns(<a href="../Geometry_and_Transformations/Vectors.html#Normalize" class="code">Normalize</a>(<a href="../Geometry_and_Transformations/Vectors.html#Cross" class="code">Cross</a>(dpdu, dpdv)));
    <a href="../Geometry_and_Transformations/Interactions.html#SurfaceInteraction::SetShadingGeometry" class="code">SetShadingGeometry</a>(ns, dpdu, dpdv, shading.<a href="../Geometry_and_Transformations/Interactions.html#SurfaceInteraction::shading::dndu" class="code">dndu</a>, shading.<a href="../Geometry_and_Transformations/Interactions.html#SurfaceInteraction::shading::dndv" class="code">dndv</a>, false);
}</div><p>


</p>
<p>The appropriate utility function for normal or bump mapping is called,
depending on which technique is to be used.

</p>
<p></p>
<span class="anchor" id="fragment-Getshadingdpduanddpdvusingnormalorbumpmap-0"></span><div class="fragmentname">&lt;&lt;Get shading <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.509ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2802.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential normal p slash partial-differential u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1143" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1643" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="2230" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.307ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2715.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential normal p slash partial-differential v</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1143" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1643" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="2230" y="0"></use>
</g>
</svg> using normal or bump map&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> dpdu, dpdv;
if (normalMap)
    <a href="#NormalMap" class="code">NormalMap</a>(*normalMap, *this, &amp;dpdu, &amp;dpdv);
else
    <a href="#BumpMap" class="code">BumpMap</a>(UniversalTextureEvaluator(), displacement, *this, &amp;dpdu, &amp;dpdv);</div><p>


</p>
<p>With differentials both for texture filtering and for shading geometry
now settled, the <a href="#Material::GetBSDF"><tt>Material::GetBSDF()</tt></a> method can be called.
Note that the universal texture evaluator is used both here and previously
in the method, as there is no need to distinguish between different texture
complexities in this part of the system.

</p>
<p></p>
<span class="anchor" id="fragment-ReturnBSDFforsurfaceinteraction-0"></span><div class="fragmentname">&lt;&lt;Return BSDF for surface interaction&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Reflection_Models/BSDF_Representation.html#BSDF" class="code">BSDF</a> bsdf = <a href="../Primitives_and_Intersection_Acceleration/Primitive_Interface_and_Geometric_Primitives.html#SurfaceInteraction::material" class="code">material</a>.<a href="#Material::GetBSDF" class="code">GetBSDF</a>(UniversalTextureEvaluator(), *this, lambda,
                             scratchBuffer);
if (bsdf &amp;&amp; <a href="../Utilities/System_Startup,_Cleanup,_and_Options.html#GetOptions" class="code">GetOptions</a>().<a href="../Utilities/System_Startup,_Cleanup,_and_Options.html#BasicPBRTOptions::forceDiffuse" class="code">forceDiffuse</a>) {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Overridemonobsdfwithdiffuseequivalent-0">Override <tt>bsdf</tt> with diffuse equivalent</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1547" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1547"><i></i></a><div id="fragbit-1547" class="collapse"><div class="fragmentcode">       <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a> r = bsdf.<a href="../Reflection_Models/BSDF_Representation.html#BSDF::rho" class="code">rho</a>(wo, {sampler.<a href="../Sampling_and_Reconstruction/Sampling_Interface.html#Sampler::Get1D" class="code">Get1D</a>()}, {sampler.<a href="../Sampling_and_Reconstruction/Sampling_Interface.html#Sampler::Get2D" class="code">Get2D</a>()});
       bsdf = <a href="../Reflection_Models/BSDF_Representation.html#BSDF" class="code">BSDF</a>(shading.<a href="../Geometry_and_Transformations/Interactions.html#SurfaceInteraction::shading::n" class="code">n</a>, shading.<a href="../Geometry_and_Transformations/Interactions.html#SurfaceInteraction::shading::dpdu" class="code">dpdu</a>,
                   scratchBuffer.<a href="../Utilities/Containers_and_Memory_Management.html#ScratchBuffer::Alloc" class="code">Alloc</a>&lt;<a href="../Reflection_Models/Diffuse_Reflection.html#DiffuseBxDF" class="code">DiffuseBxDF</a>&gt;(r));</div></div>
}
return bsdf;</div><p>


</p>
<p><tt>pbrt</tt> provides an option to override all the materials in a scene with
equivalent diffuse BSDFs; doing so can be useful for some debugging
problems.  In this case, the hemispherical&ndash;directional reflectance is used
to initialize a <a href="../Reflection_Models/Diffuse_Reflection.html#DiffuseBxDF"><tt>DiffuseBxDF</tt></a>.

</p>
<p></p>
<span class="anchor" id="fragment-Overridemonobsdfwithdiffuseequivalent-0"></span><div class="fragmentname">&lt;&lt;Override <tt>bsdf</tt> with diffuse equivalent&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a> r = bsdf.<a href="../Reflection_Models/BSDF_Representation.html#BSDF::rho" class="code">rho</a>(wo, {sampler.<a href="../Sampling_and_Reconstruction/Sampling_Interface.html#Sampler::Get1D" class="code">Get1D</a>()}, {sampler.<a href="../Sampling_and_Reconstruction/Sampling_Interface.html#Sampler::Get2D" class="code">Get2D</a>()});
bsdf = <a href="../Reflection_Models/BSDF_Representation.html#BSDF" class="code">BSDF</a>(shading.<a href="../Geometry_and_Transformations/Interactions.html#SurfaceInteraction::shading::n" class="code">n</a>, shading.<a href="../Geometry_and_Transformations/Interactions.html#SurfaceInteraction::shading::dpdu" class="code">dpdu</a>,
            scratchBuffer.<a href="../Utilities/Containers_and_Memory_Management.html#ScratchBuffer::Alloc" class="code">Alloc</a>&lt;<a href="../Reflection_Models/Diffuse_Reflection.html#DiffuseBxDF" class="code">DiffuseBxDF</a>&gt;(r));</div><p>


</p>
<p>The
<tt>SurfaceInteraction::GetBSSRDF()</tt><span class="anchor" id="SurfaceInteraction::GetBSSRDF"></span>
method, not included here, follows a similar path before calling
<a href="#Material::GetBSSRDF"><tt>Material::GetBSSRDF()</tt></a>.

</p>
<p>

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#NormalMapping"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:normal-mapping"></span><span id="NormalMapping"></span><h3>10.5.3  Normal Mapping</h3><p>



</p>
<p>Normal mapping is a technique that maps tabularized surface normals stored
in images to surfaces and uses them to specify shading normals in order to
give the appearance of fine geometric detail.

</p>
<p>With normal maps, one must choose a coordinate system for the stored normals.
While any coordinate system may be chosen, one of the most useful is
the local shading coordinate system at each point on a surface
where the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.086ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 467.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">z</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D467" d="M467 432c0 -4 -22 -52 -117 -145c-36 -36 -98 -90 -98 -90c-36 -31 -65 -56 -119 -114c9 3 27 3 27 3c21 0 36 -4 70 -17c21 -7 39 -13 59 -13c33 0 97 19 120 84c3 7 5 13 14 13c8 0 12 -5 12 -10c0 -27 -58 -154 -157 -154c-29 0 -47 16 -64 37c-25 29 -35 38 -58 38 c-32 0 -62 -27 -85 -62c-6 -11 -8 -13 -16 -13c0 0 -12 0 -12 10c0 7 35 64 103 131l90 84c19 16 103 88 139 131c-26 0 -37 0 -77 15c-23 8 -42 15 -63 15c-8 0 -66 -1 -85 -47c-2 -6 -4 -11 -13 -11s-12 6 -12 11c0 21 46 114 121 114c33 0 50 -20 69 -43 c15 -17 27 -32 51 -32s45 16 75 64c5 9 8 11 15 11c0 0 11 0 11 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D467" x="0" y="0"></use>
</g>
</svg> axis is aligned with the surface normal and tangent vectors
are aligned with <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.139ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 490.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">y</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
</g>
</svg>.  (This is the same as the reflection
coordinate system described in
Section&nbsp;<a href="../Reflection_Models/BSDF_Representation.html#sec:bsdf-geom-and-conventions">9.1.1</a>.)  When that coordinate system
is used, the approach is called <em>tangent-space normal mapping</em>.  With
tangent-space normal mapping, a given normal map can be applied to a variety of
shapes, while choosing a coordinate system like object space would closely
couple a normal map&rsquo;s encoding to a specific geometric object.

</p>
<p> </p>
<span class="anchor" id="fig:normal-map"></span><div class="card outerfigure"><div class="card-body figure"><p>


</p>
<div class="figure-row">
  <a href="pha10f21.svg" title=""><img src="pha10f21.svg" width=988 height=434 style="max-width: 100%;"></a>
</div>
<p>

</p>
<figcaption class="caption">Figure 10.21:  <span class="legend">
(a)&nbsp;A normal map modeling wrinkles for a pillow model.
(b)&nbsp;Pillow geometry without normal map.
(c)&nbsp;When applied to the pillow, the normal map gives a convincing approximation to more
detailed geometry than is actually present.
<em>(Scene courtesy of Angelo Ferretti.)</em>
</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>Normal maps are traditionally encoded in RGB images, where red, green, and
blue respectively store the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
</g>
</svg>, <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.139ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 490.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">y</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
</g>
</svg>, and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.086ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 467.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">z</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D467" d="M467 432c0 -4 -22 -52 -117 -145c-36 -36 -98 -90 -98 -90c-36 -31 -65 -56 -119 -114c9 3 27 3 27 3c21 0 36 -4 70 -17c21 -7 39 -13 59 -13c33 0 97 19 120 84c3 7 5 13 14 13c8 0 12 -5 12 -10c0 -27 -58 -154 -157 -154c-29 0 -47 16 -64 37c-25 29 -35 38 -58 38 c-32 0 -62 -27 -85 -62c-6 -11 -8 -13 -16 -13c0 0 -12 0 -12 10c0 7 35 64 103 131l90 84c19 16 103 88 139 131c-26 0 -37 0 -77 15c-23 8 -42 15 -63 15c-8 0 -66 -1 -85 -47c-2 -6 -4 -11 -13 -11s-12 6 -12 11c0 21 46 114 121 114c33 0 50 -20 69 -43 c15 -17 27 -32 51 -32s45 16 75 64c5 9 8 11 15 11c0 0 11 0 11 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D467" x="0" y="0"></use>
</g>
</svg> components of the surface
normal.  When tangent-space normal mapping is used, normal map images are
typically predominantly blue, reflecting the fact that the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.086ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 467.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">z</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D467" d="M467 432c0 -4 -22 -52 -117 -145c-36 -36 -98 -90 -98 -90c-36 -31 -65 -56 -119 -114c9 3 27 3 27 3c21 0 36 -4 70 -17c21 -7 39 -13 59 -13c33 0 97 19 120 84c3 7 5 13 14 13c8 0 12 -5 12 -10c0 -27 -58 -154 -157 -154c-29 0 -47 16 -64 37c-25 29 -35 38 -58 38 c-32 0 -62 -27 -85 -62c-6 -11 -8 -13 -16 -13c0 0 -12 0 -12 10c0 7 35 64 103 131l90 84c19 16 103 88 139 131c-26 0 -37 0 -77 15c-23 8 -42 15 -63 15c-8 0 -66 -1 -85 -47c-2 -6 -4 -11 -13 -11s-12 6 -12 11c0 21 46 114 121 114c33 0 50 -20 69 -43 c15 -17 27 -32 51 -32s45 16 75 64c5 9 8 11 15 11c0 0 11 0 11 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D467" x="0" y="0"></use>
</g>
</svg> component of
the surface normal has the largest magnitude unless the normal has been
substantially perturbed.  (See Figure&nbsp;<a href="#fig:normal-map">10.21</a>.)

</p>
<p>This RGB encoding brings us to an unfortunate casualty from the adoption of
spectral rendering in this version of <tt>pbrt</tt>: while <tt>pbrt</tt>&rsquo;s <a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#SpectrumTexture"><tt>SpectrumTexture</tt></a>s
previously returned RGB colors, they now return point-sampled spectral
values.  If an RGB image map is used for a spectrum texture, it is not
possible to exactly reconstruct the original RGB colors; there will
unavoidably be error in the Monte Carlo estimator that must be evaluated to
find RGB.
Introducing noise in the orientations of surface normals is unacceptable,
since it would lead to systemic bias in rendered images.  Consider a bumpy
shiny object: error in the surface normal would lead to scattered rays
intersecting objects that they would never intersect given the correct
normals, which could cause arbitrarily large error.

</p>
<p>We might avoid that problem by augmenting the <a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#SpectrumTexture"><tt>SpectrumTexture</tt></a> interface
to include a method that returned RGB color, introducing a separate 
<tt>RGBTexture</tt> interface and texture implementations, or by introducing a
<tt>NormalTexture</tt> that returned normals directly.  Any of these could
cleanly support normal mapping, though all would require a significant
amount of additional code.

</p>
<p>Because the capability of directly looking up RGB values is only needed for
normal mapping, the
<tt>NormalMap()</tt> function therefore takes an <a href="../Utilities/Images.html#Image"><tt>Image</tt></a> to specify the
normal map.  It assumes that the first three channels of the image
represent red, green, and blue.  With this approach we have lost the
benefits of being able to scale and mix textures as well as the ability to
apply a variety of mapping functions to compute texture coordinates.  While
that is unfortunate, those capabilities are less often used with normal
maps than with other types of textures, and so we prefer not to make the
<tt>Texture</tt> interfaces more complex purely for normal mapping.

</p>
<p></p>
<span class="anchor" id="fragment-NormalMappingFunctionDefinitions-0"></span><div class="fragmentname">&lt;&lt;Normal Mapping Function Definitions&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">void <span class="anchor" id="NormalMap"></span>NormalMap(const <a href="../Utilities/Images.html#Image" class="code">Image</a> &amp;normalMap, const <a href="#NormalBumpEvalContext" class="code">NormalBumpEvalContext</a> &amp;ctx,
               <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> *dpdu, <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> *dpdv) {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Getnormalizednormalvectorfromnormalmap-0">Get normalized normal vector from normal map</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1548" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1548"><i></i></a><div id="fragbit-1548" class="collapse"><div class="fragmentcode">       WrapMode2D wrap(WrapMode::Repeat);
       <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> <a href="#NormalBumpEvalContext::uv" class="code">uv</a>(ctx.<a href="#NormalBumpEvalContext::uv" class="code">uv</a>[0], 1 - ctx.<a href="#NormalBumpEvalContext::uv" class="code">uv</a>[1]);
       <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> ns(2 * normalMap.<a href="../Utilities/Images.html#Image::BilerpChannel" class="code">BilerpChannel</a>(<a href="#NormalBumpEvalContext::uv" class="code">uv</a>, 0, wrap) - 1,
                   2 * normalMap.<a href="../Utilities/Images.html#Image::BilerpChannel" class="code">BilerpChannel</a>(<a href="#NormalBumpEvalContext::uv" class="code">uv</a>, 1, wrap) - 1,
                   2 * normalMap.<a href="../Utilities/Images.html#Image::BilerpChannel" class="code">BilerpChannel</a>(<a href="#NormalBumpEvalContext::uv" class="code">uv</a>, 2, wrap) - 1);
       ns = <a href="../Geometry_and_Transformations/Vectors.html#Normalize" class="code">Normalize</a>(ns);</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Transformtangent-spacenormaltorenderingspace-0">Transform tangent-space normal to rendering space</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1549" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1549"><i></i></a><div id="fragbit-1549" class="collapse"><div class="fragmentcode">       <a href="../Geometry_and_Transformations/Applying_Transformations.html#Frame" class="code">Frame</a> frame = <a href="../Geometry_and_Transformations/Applying_Transformations.html#Frame" class="code">Frame</a>::FromZ(ctx.shading.<a href="#NormalBumpEvalContext::shading::n" class="code">n</a>);
       ns = frame.<a href="../Geometry_and_Transformations/Applying_Transformations.html#Frame::FromLocal" class="code">FromLocal</a>(ns);</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Finddpduanddpdvthatgiveshadingnormal-0">Find <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.509ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2802.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential normal p slash partial-differential u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1143" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1643" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="2230" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.307ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2715.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential normal p slash partial-differential v</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1143" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1643" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="2230" y="0"></use>
</g>
</svg> that give shading normal</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1550" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1550"><i></i></a><div id="fragbit-1550" class="collapse"><div class="fragmentcode">       Float ulen = <a href="../Geometry_and_Transformations/Vectors.html#Length" class="code">Length</a>(ctx.shading.<a href="#NormalBumpEvalContext::shading::dpdu" class="code">dpdu</a>), vlen = <a href="../Geometry_and_Transformations/Vectors.html#Length" class="code">Length</a>(ctx.shading.<a href="#NormalBumpEvalContext::shading::dpdv" class="code">dpdv</a>);
       *<a href="#NormalBumpEvalContext::shading::dpdu" class="code">dpdu</a> = <a href="../Geometry_and_Transformations/Vectors.html#Normalize" class="code">Normalize</a>(<a href="../Geometry_and_Transformations/Vectors.html#GramSchmidt" class="code">GramSchmidt</a>(ctx.shading.<a href="#NormalBumpEvalContext::shading::dpdu" class="code">dpdu</a>, ns)) * ulen;
       *<a href="#NormalBumpEvalContext::shading::dpdv" class="code">dpdv</a> = <a href="../Geometry_and_Transformations/Vectors.html#Normalize" class="code">Normalize</a>(<a href="../Geometry_and_Transformations/Vectors.html#Cross" class="code">Cross</a>(ns, *<a href="#NormalBumpEvalContext::shading::dpdu" class="code">dpdu</a>)) * vlen;</div></div>
}</div><p>


</p>
<p>Both <a href="#NormalMap"><tt>NormalMap()</tt></a> and <a href="#BumpMap"><tt>BumpMap()</tt></a> take a
<tt>NormalBumpEvalContext</tt> to specify the local geometric information for
the point where the shading geometry is being computed.

</p>
<p></p>
<span class="anchor" id="fragment-NormalBumpEvalContextDefinition-0"></span><div class="fragmentname">&lt;&lt;NormalBumpEvalContext Definition&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">struct <span class="anchor" id="NormalBumpEvalContext"></span>NormalBumpEvalContext {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-NormalBumpEvalContextPublicMethods-0">NormalBumpEvalContext Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1551" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1551"><i></i></a><div id="fragbit-1551" class="collapse"><div class="fragmentcode">       NormalBumpEvalContext() = default;
       PBRT_CPU_GPU
       NormalBumpEvalContext(const <a href="../Geometry_and_Transformations/Interactions.html#SurfaceInteraction" class="code">SurfaceInteraction</a> &amp;si)
           : <a href="#NormalBumpEvalContext::p" class="code">p</a>(si.<a href="#NormalBumpEvalContext::p" class="code">p</a>()), <a href="#NormalBumpEvalContext::uv" class="code">uv</a>(si.<a href="#NormalBumpEvalContext::uv" class="code">uv</a>), <a href="#NormalBumpEvalContext::n" class="code">n</a>(si.<a href="#NormalBumpEvalContext::n" class="code">n</a>), <a href="#NormalBumpEvalContext::dudx" class="code">dudx</a>(si.<a href="#NormalBumpEvalContext::dudx" class="code">dudx</a>), <a href="#NormalBumpEvalContext::dudy" class="code">dudy</a>(si.<a href="#NormalBumpEvalContext::dudy" class="code">dudy</a>),
             <a href="#NormalBumpEvalContext::dvdx" class="code">dvdx</a>(si.<a href="#NormalBumpEvalContext::dvdx" class="code">dvdx</a>), <a href="#NormalBumpEvalContext::dvdy" class="code">dvdy</a>(si.<a href="#NormalBumpEvalContext::dvdy" class="code">dvdy</a>), <a href="#NormalBumpEvalContext::dpdx" class="code">dpdx</a>(si.<a href="#NormalBumpEvalContext::dpdx" class="code">dpdx</a>), <a href="#NormalBumpEvalContext::dpdy" class="code">dpdy</a>(si.<a href="#NormalBumpEvalContext::dpdy" class="code">dpdy</a>),
             faceIndex(si.faceIndex) {
           shading.<a href="#NormalBumpEvalContext::n" class="code">n</a> = si.shading.<a href="#NormalBumpEvalContext::n" class="code">n</a>;
           shading.dpdu = si.shading.dpdu;
           shading.dpdv = si.shading.dpdv;
           shading.dndu = si.shading.dndu;
           shading.dndv = si.shading.dndv;
       }
       std::string ToString() const;
       operator <a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureEvalContext" class="code">TextureEvalContext</a>() const {
           return <a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureEvalContext" class="code">TextureEvalContext</a>(<a href="#NormalBumpEvalContext::p" class="code">p</a>, <a href="#NormalBumpEvalContext::dpdx" class="code">dpdx</a>, <a href="#NormalBumpEvalContext::dpdy" class="code">dpdy</a>, <a href="#NormalBumpEvalContext::n" class="code">n</a>, <a href="#NormalBumpEvalContext::uv" class="code">uv</a>, <a href="#NormalBumpEvalContext::dudx" class="code">dudx</a>, <a href="#NormalBumpEvalContext::dudy" class="code">dudy</a>,
                                     <a href="#NormalBumpEvalContext::dvdx" class="code">dvdx</a>, <a href="#NormalBumpEvalContext::dvdy" class="code">dvdy</a>);
       }</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-NormalBumpEvalContextPublicMembers-0">NormalBumpEvalContext Public Members</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1552" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1552"><i></i></a><div id="fragbit-1552" class="collapse"><div class="fragmentcode">       <a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a> p;
       <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> uv;
       <a href="../Geometry_and_Transformations/Normals.html#Normal3f" class="code">Normal3f</a> n;
       struct {
           <a href="../Geometry_and_Transformations/Normals.html#Normal3f" class="code">Normal3f</a> n;
           <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> dpdu, dpdv;
           <a href="../Geometry_and_Transformations/Normals.html#Normal3f" class="code">Normal3f</a> dndu, dndv;
       } shading;
       Float dudx = 0, dudy = 0, dvdx = 0, dvdy = 0;
       <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> dpdx, dpdy;
       </div></div>
};</div><p>


</p>
<p>As usual, it has a constructor, not included here, that performs
initialization given a <a href="../Geometry_and_Transformations/Interactions.html#SurfaceInteraction"><tt>SurfaceInteraction</tt></a>.

</p>
<p></p>
<span class="anchor" id="fragment-NormalBumpEvalContextPublicMembers-0"></span><div class="fragmentname">&lt;&lt;NormalBumpEvalContext Public Members&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a> <span class="anchor" id="NormalBumpEvalContext::p"></span>p;
<a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> <span class="anchor" id="NormalBumpEvalContext::uv"></span>uv;
<a href="../Geometry_and_Transformations/Normals.html#Normal3f" class="code">Normal3f</a> <span class="anchor" id="NormalBumpEvalContext::n"></span>n;
struct {
    <a href="../Geometry_and_Transformations/Normals.html#Normal3f" class="code">Normal3f</a> <span class="anchor" id="NormalBumpEvalContext::shading::n"></span>n;
    <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> <span class="anchor" id="NormalBumpEvalContext::shading::dpdu"></span>dpdu, <span class="anchor" id="NormalBumpEvalContext::shading::dpdv"></span>dpdv;
    <a href="../Geometry_and_Transformations/Normals.html#Normal3f" class="code">Normal3f</a> <span class="anchor" id="NormalBumpEvalContext::shading::dndu"></span>dndu, <span class="anchor" id="NormalBumpEvalContext::shading::dndv"></span>dndv;
} shading;
Float <span class="anchor" id="NormalBumpEvalContext::dudx"></span>dudx = 0, <span class="anchor" id="NormalBumpEvalContext::dudy"></span>dudy = 0, <span class="anchor" id="NormalBumpEvalContext::dvdx"></span>dvdx = 0, <span class="anchor" id="NormalBumpEvalContext::dvdy"></span>dvdy = 0;
<a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> <span class="anchor" id="NormalBumpEvalContext::dpdx"></span>dpdx, <span class="anchor" id="NormalBumpEvalContext::dpdy"></span>dpdy;
</div><p>


</p>
<p>

</p>
<p>It also provides a conversion operator to <a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureEvalContext"><tt>TextureEvalContext</tt></a>, which only
needs a subset of the values stored in <tt>NormalBumpEvalContext</tt>.

</p>
<p></p>
<span class="anchor" id="fragment-NormalBumpEvalContextPublicMethods-0"></span><div class="fragmentname">&lt;&lt;NormalBumpEvalContext Public Methods&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">operator <a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureEvalContext" class="code">TextureEvalContext</a>() const {
    return <a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureEvalContext" class="code">TextureEvalContext</a>(<a href="#NormalBumpEvalContext::p" class="code">p</a>, <a href="#NormalBumpEvalContext::dpdx" class="code">dpdx</a>, <a href="#NormalBumpEvalContext::dpdy" class="code">dpdy</a>, <a href="#NormalBumpEvalContext::n" class="code">n</a>, <a href="#NormalBumpEvalContext::uv" class="code">uv</a>, <a href="#NormalBumpEvalContext::dudx" class="code">dudx</a>, <a href="#NormalBumpEvalContext::dudy" class="code">dudy</a>,
                              <a href="#NormalBumpEvalContext::dvdx" class="code">dvdx</a>, <a href="#NormalBumpEvalContext::dvdy" class="code">dvdy</a>);
}</div><p>


</p>
<p>The first step in the normal mapping computation is to read the
tangent-space normal vector from the image map.  The image wrap mode is
hard-coded here since <tt>Repeat</tt> is almost always the desired mode,
though it would be easy to allow the wrap mode to be set via a parameter.
Note also that the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.128ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 485.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">v</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="0" y="0"></use>
</g>
</svg> coordinate is inverted, again following the image
texture coordinate convention discussed in
Section&nbsp;<a href="../Textures_and_Materials/Image_Texture.html#sec:image-texture-eval">10.4.2</a>.

</p>
<p>Normal maps are traditionally encoded in fixed-point image formats with
pixel values that range from&nbsp;0 to&nbsp;1.  This encoding allows the use of
compact 8-bit pixel representations as well as compressed image formats
that are supported by GPUs.  Values read from the image must therefore be
remapped to the range <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.461ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2781.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket negative 1 comma 1 right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1057" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1557" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="2002" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="2503" y="0"></use>
</g>
</svg> to reconstruct an associated normal vector.
The normal vector must be renormalized, as both the quantization in the
image pixel format and the bilinear interpolation may have caused it to be
non-unit-length.

</p>
<p></p>
<span class="anchor" id="fragment-Getnormalizednormalvectorfromnormalmap-0"></span><div class="fragmentname">&lt;&lt;Get normalized normal vector from normal map&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">WrapMode2D wrap(WrapMode::Repeat);
<a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> <a href="#NormalBumpEvalContext::uv" class="code">uv</a>(ctx.<a href="#NormalBumpEvalContext::uv" class="code">uv</a>[0], 1 - ctx.<a href="#NormalBumpEvalContext::uv" class="code">uv</a>[1]);
<a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> ns(2 * normalMap.<a href="../Utilities/Images.html#Image::BilerpChannel" class="code">BilerpChannel</a>(<a href="#NormalBumpEvalContext::uv" class="code">uv</a>, 0, wrap) - 1,
            2 * normalMap.<a href="../Utilities/Images.html#Image::BilerpChannel" class="code">BilerpChannel</a>(<a href="#NormalBumpEvalContext::uv" class="code">uv</a>, 1, wrap) - 1,
            2 * normalMap.<a href="../Utilities/Images.html#Image::BilerpChannel" class="code">BilerpChannel</a>(<a href="#NormalBumpEvalContext::uv" class="code">uv</a>, 2, wrap) - 1);
ns = <a href="../Geometry_and_Transformations/Vectors.html#Normalize" class="code">Normalize</a>(ns);</div><p>


</p>
<p>In order to transform the normal to rendering space, a <a href="../Geometry_and_Transformations/Applying_Transformations.html#Frame"><tt>Frame</tt></a> can be
used to specify a coordinate system where the original shading normal is
aligned with the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.894ex" height="2.176ex" style="vertical-align: -0.505ex;" viewBox="0 -719.6 1246 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">plus z</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D467" d="M467 432c0 -4 -22 -52 -117 -145c-36 -36 -98 -90 -98 -90c-36 -31 -65 -56 -119 -114c9 3 27 3 27 3c21 0 36 -4 70 -17c21 -7 39 -13 59 -13c33 0 97 19 120 84c3 7 5 13 14 13c8 0 12 -5 12 -10c0 -27 -58 -154 -157 -154c-29 0 -47 16 -64 37c-25 29 -35 38 -58 38 c-32 0 -62 -27 -85 -62c-6 -11 -8 -13 -16 -13c0 0 -12 0 -12 10c0 7 35 64 103 131l90 84c19 16 103 88 139 131c-26 0 -37 0 -77 15c-23 8 -42 15 -63 15c-8 0 -66 -1 -85 -47c-2 -6 -4 -11 -13 -11s-12 6 -12 11c0 21 46 114 121 114c33 0 50 -20 69 -43 c15 -17 27 -32 51 -32s45 16 75 64c5 9 8 11 15 11c0 0 11 0 11 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D467" x="778" y="0"></use>
</g>
</svg> axis.  Transforming the tangent-space normal into
this coordinate system gives the rendering-space normal.

</p>
<p></p>
<span class="anchor" id="fragment-Transformtangent-spacenormaltorenderingspace-0"></span><div class="fragmentname">&lt;&lt;Transform tangent-space normal to rendering space&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Geometry_and_Transformations/Applying_Transformations.html#Frame" class="code">Frame</a> frame = <a href="../Geometry_and_Transformations/Applying_Transformations.html#Frame" class="code">Frame</a>::FromZ(ctx.shading.<a href="#NormalBumpEvalContext::shading::n" class="code">n</a>);
ns = frame.<a href="../Geometry_and_Transformations/Applying_Transformations.html#Frame::FromLocal" class="code">FromLocal</a>(ns);</div><p>


</p>
<p>This function returns partial derivatives of the surface that account for
the shading normal rather than the shading normal itself.  Suitable partial
derivatives can be found in two steps.  First, a call to
<a href="../Geometry_and_Transformations/Vectors.html#GramSchmidt"><tt>GramSchmidt()</tt></a> with the original <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.509ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2802.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential normal p slash partial-differential u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1143" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1643" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="2230" y="0"></use>
</g>
</svg> and the new shading normal
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.464ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 1060.9 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold n Subscript bold s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D427" d="M615 0l-126 3l-126 -3v47h69v270c0 76 -21 97 -55 97c-63 0 -149 -49 -149 -158v-209h69v-47l-126 3l-126 -3v47h69v309c0 39 -7 39 -69 39v47l172 8v-108c26 51 79 108 175 108c100 0 154 -39 154 -144v-259h69v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D42C" d="M415 140c0 -146 -154 -146 -185 -146c-20 0 -72 0 -118 32l-26 -17c-21 -15 -23 -15 -30 -15c-18 0 -18 9 -18 28v109c0 23 0 29 24 29c14 0 19 0 24 -14c12 -43 38 -116 144 -116c22 0 114 0 114 75c0 59 -75 72 -111 78c-77 14 -115 20 -155 55c-20 17 -40 44 -40 84 c0 131 154 131 184 131c40 0 75 -6 101 -19c39 19 41 19 45 19c18 0 18 -9 18 -28v-80c0 -23 0 -28 -24 -28c-21 0 -22 5 -23 20c-5 55 -43 84 -118 84c-19 0 -112 0 -112 -62c0 -47 65 -58 102 -65c78 -13 110 -19 149 -48c35 -28 55 -63 55 -106Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D427" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D42C" x="904" y="-213"></use>
</g>
</svg> gives the closest vector to <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.509ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2802.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential normal p slash partial-differential u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1143" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1643" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="2230" y="0"></use>
</g>
</svg> that is perpendicular to
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.464ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 1060.9 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold n Subscript bold s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D427" d="M615 0l-126 3l-126 -3v47h69v270c0 76 -21 97 -55 97c-63 0 -149 -49 -149 -158v-209h69v-47l-126 3l-126 -3v47h69v309c0 39 -7 39 -69 39v47l172 8v-108c26 51 79 108 175 108c100 0 154 -39 154 -144v-259h69v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D42C" d="M415 140c0 -146 -154 -146 -185 -146c-20 0 -72 0 -118 32l-26 -17c-21 -15 -23 -15 -30 -15c-18 0 -18 9 -18 28v109c0 23 0 29 24 29c14 0 19 0 24 -14c12 -43 38 -116 144 -116c22 0 114 0 114 75c0 59 -75 72 -111 78c-77 14 -115 20 -155 55c-20 17 -40 44 -40 84 c0 131 154 131 184 131c40 0 75 -6 101 -19c39 19 41 19 45 19c18 0 18 -9 18 -28v-80c0 -23 0 -28 -24 -28c-21 0 -22 5 -23 20c-5 55 -43 84 -118 84c-19 0 -112 0 -112 -62c0 -47 65 -58 102 -65c78 -13 110 -19 149 -48c35 -28 55 -63 55 -106Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D427" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D42C" x="904" y="-213"></use>
</g>
</svg>.  <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.307ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2715.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential normal p slash partial-differential v</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1143" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1643" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="2230" y="0"></use>
</g>
</svg> is then found by taking the cross product of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.464ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 1060.9 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold n Subscript bold s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D427" d="M615 0l-126 3l-126 -3v47h69v270c0 76 -21 97 -55 97c-63 0 -149 -49 -149 -158v-209h69v-47l-126 3l-126 -3v47h69v309c0 39 -7 39 -69 39v47l172 8v-108c26 51 79 108 175 108c100 0 154 -39 154 -144v-259h69v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D42C" d="M415 140c0 -146 -154 -146 -185 -146c-20 0 -72 0 -118 32l-26 -17c-21 -15 -23 -15 -30 -15c-18 0 -18 9 -18 28v109c0 23 0 29 24 29c14 0 19 0 24 -14c12 -43 38 -116 144 -116c22 0 114 0 114 75c0 59 -75 72 -111 78c-77 14 -115 20 -155 55c-20 17 -40 44 -40 84 c0 131 154 131 184 131c40 0 75 -6 101 -19c39 19 41 19 45 19c18 0 18 -9 18 -28v-80c0 -23 0 -28 -24 -28c-21 0 -22 5 -23 20c-5 55 -43 84 -118 84c-19 0 -112 0 -112 -62c0 -47 65 -58 102 -65c78 -13 110 -19 149 -48c35 -28 55 -63 55 -106Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D427" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D42C" x="904" y="-213"></use>
</g>
</svg> and
the new <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.307ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2715.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential normal p slash partial-differential v</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1143" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1643" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="2230" y="0"></use>
</g>
</svg>, giving an orthogonal coordinate system.  Both of these
vectors are respectively scaled to have the same length as the original
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.509ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2802.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential normal p slash partial-differential u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1143" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1643" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="2230" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.307ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2715.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential normal p slash partial-differential v</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1143" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1643" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="2230" y="0"></use>
</g>
</svg> vectors.

</p>
<p></p>
<span class="anchor" id="fragment-Finddpduanddpdvthatgiveshadingnormal-0"></span><div class="fragmentname">&lt;&lt;Find <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.509ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2802.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential normal p slash partial-differential u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1143" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1643" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="2230" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.307ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2715.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential normal p slash partial-differential v</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1143" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1643" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="2230" y="0"></use>
</g>
</svg> that give shading normal&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float ulen = <a href="../Geometry_and_Transformations/Vectors.html#Length" class="code">Length</a>(ctx.shading.<a href="#NormalBumpEvalContext::shading::dpdu" class="code">dpdu</a>), vlen = <a href="../Geometry_and_Transformations/Vectors.html#Length" class="code">Length</a>(ctx.shading.<a href="#NormalBumpEvalContext::shading::dpdv" class="code">dpdv</a>);
*<a href="#NormalBumpEvalContext::shading::dpdu" class="code">dpdu</a> = <a href="../Geometry_and_Transformations/Vectors.html#Normalize" class="code">Normalize</a>(<a href="../Geometry_and_Transformations/Vectors.html#GramSchmidt" class="code">GramSchmidt</a>(ctx.shading.<a href="#NormalBumpEvalContext::shading::dpdu" class="code">dpdu</a>, ns)) * ulen;
*<a href="#NormalBumpEvalContext::shading::dpdv" class="code">dpdv</a> = <a href="../Geometry_and_Transformations/Vectors.html#Normalize" class="code">Normalize</a>(<a href="../Geometry_and_Transformations/Vectors.html#Cross" class="code">Cross</a>(ns, *<a href="#NormalBumpEvalContext::shading::dpdu" class="code">dpdu</a>)) * vlen;</div><p>


</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#BumpMapping"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span id="BumpMapping"></span><h3>10.5.4  Bump Mapping</h3><p>


</p>
<p>Another way to define shading normals is via a <a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture"><tt>FloatTexture</tt></a>
that defines a displacement at each point on the
surface: each point <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.293ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 556.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal p Subscript</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="0" y="0"></use>
</g>
</svg> has a displaced point <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.194ex" height="2.676ex" style="vertical-align: -0.671ex;" viewBox="0 -863.1 944.6 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal p prime</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="787" y="513"></use>
</g>
</svg> associated with
it, defined by <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.323ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 7889.1 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal p prime equals normal p Subscript Baseline plus d left-parenthesis normal p Subscript Baseline right-parenthesis bold n left-parenthesis normal p Subscript Baseline right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D427" d="M615 0l-126 3l-126 -3v47h69v270c0 76 -21 97 -55 97c-63 0 -149 -49 -149 -158v-209h69v-47l-126 3l-126 -3v47h69v309c0 39 -7 39 -69 39v47l172 8v-108c26 51 79 108 175 108c100 0 154 -39 154 -144v-259h69v-47Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="787" y="513"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="1222" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="2278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="3057" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="4058" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="4578" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="4968" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="5524" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D427" x="5914" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="6553" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="6943" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="7499" y="0"></use>
</g>
</svg>, where <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.311ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 1856 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">d left-parenthesis normal p Subscript Baseline right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="520" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="910" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1466" y="0"></use>
</g>
</svg>
is the offset returned by the displacement texture at <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.293ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 556.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal p Subscript</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="0" y="0"></use>
</g>
</svg> and
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.587ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 1975 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold n left-parenthesis normal p Subscript Baseline right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D427" d="M615 0l-126 3l-126 -3v47h69v270c0 76 -21 97 -55 97c-63 0 -149 -49 -149 -158v-209h69v-47l-126 3l-126 -3v47h69v309c0 39 -7 39 -69 39v47l172 8v-108c26 51 79 108 175 108c100 0 154 -39 154 -144v-259h69v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D427" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="639" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="1029" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1585" y="0"></use>
</g>
</svg> is the surface normal at <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.293ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 556.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal p Subscript</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="0" y="0"></use>
</g>
</svg>
(Figure&nbsp;<a href="#fig:displace-surf">10.22</a>).  We can use this texture to
compute shading normals so that the surface appears as if it actually had
been offset by the displacement function, without modifying its geometry.
This process is called <em>bump mapping</em>.  For relatively small
displacement functions, the visual effect of bump mapping can be quite
convincing.

</p>
<p> </p>
<span class="anchor" id="fig:displace-surf"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>
<div class="figure-row">
  <a href="pha10f22.svg" title=""><img src="pha10f22.svg" width=218 height=140 style="max-width: 100%;"></a>
</div>
<p>


</p>
<figcaption class="caption">Figure 10.22: <span class="legend"> A displacement function associated with
a material defines a new surface based on the old one, offset by the
displacement amount along the normal at each point.  <tt>pbrt</tt> does not compute a
geometric representation of this displaced surface in the <a href="#BumpMap"><tt>BumpMap()</tt></a>
function, but instead uses it
to compute shading normals for bump mapping.</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>An example of bump mapping is shown in Figure&nbsp;<a href="#fig:sanmiguel-bump-vs-no">10.23</a>,
which shows part of the <em>San Miguel</em> scene rendered
with and without bump mapping.  There, the
bump map gives the appearance of a substantial amount of detail in the
walls and floors that is not actually present in the geometric model.
Figure&nbsp;<a href="#fig:sanmiguel-bumpmap">10.24</a> shows one of the image maps used to define the bump function
in Figure&nbsp;<a href="#fig:sanmiguel-bump-vs-no">10.23</a>.

</p>
<p> </p>
<span class="anchor" id="fig:sanmiguel-bump-vs-no"></span><div class="card outerfigure"><div class="card-body figure"><p>


</p>

<div class="card-img-top" style="display:block; width: 100%; padding-top: 58.052%;  position:relative;">
<div id="xa_Without_bump_mapping38" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0;"></div></div>
<script>
Jeri.renderViewer(document.getElementById('xa_Without_bump_mapping38'), {
  title: '(a)_Without_bump_mapping38', children: [
 { title: '(a) Without bump mapping', image: 'sanmiguel-no-bump.png' },  { title: '(b) With bump mapping', image: 'sanmiguel-bump.png' }]});
</script>
<button data-toggle="tooltip" data-placement="left" class="btn yojeri" title="This image is interactive. Click and drag to pan and use the mouse-wheel to zoom. After clicking on the image to select it, type '?' to see a summary of keyboard controls."><i class="fa fa-snowflake fa-border"></i></button><p>

</p>
<figcaption class="caption">Figure 10.23: <span class="legend"> Detail of the <em>San Miguel</em> scene, rendered
(a)&nbsp;without bump mapping and (b)&nbsp;with bump mapping.  Bump mapping
substantially increases the apparent geometric complexity of the model,
without the increased rendering time and memory use that would result from
a geometric representation with the equivalent amount of small-scale
detail.
<em>(Scene courtesy of Guillermo M. Leal Llaguno.)</em>
</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p> </p>
<span class="anchor" id="fig:sanmiguel-bumpmap"></span><div class="card outerfigure"><div class="card-body figure"><p>


</p>
<div class="figure-row">
<img src="sanmiguel-bumpmap.png" style="max-width: 100%; height: auto;" width=700 height=497>
</div>
<p>

</p>
<figcaption class="caption">Figure 10.24: <span class="legend"> The image used as a bump map
for the tiles in the <em>San Miguel</em> rendering in
Figure&nbsp;<a href="#fig:sanmiguel-bump-vs-no">10.23</a>.</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>The <a href="#BumpMap"><tt>BumpMap()</tt></a> function is responsible for computing the effect of bump
mapping at the point being shaded given a particular displacement
texture.  Its implementation is based on finding an approximation to
the partial derivatives <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.509ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2802.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential normal p slash partial-differential u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1143" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1643" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="2230" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.307ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2715.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential normal p slash partial-differential v</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1143" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1643" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="2230" y="0"></use>
</g>
</svg> of the displaced surface and
using them in place of the surface&rsquo;s actual partial derivatives to compute
the shading normal.  Assume that the
original surface is defined by a parametric function <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.543ex" height="2.843ex" style="vertical-align: -0.838ex; margin-left: -0.073ex;" viewBox="-31.5 -863.1 2817.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">p left-parenthesis u comma v right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45D" d="M490 282c0 -147 -125 -293 -241 -293c-51 0 -79 35 -92 64c-7 -25 -49 -188 -49 -200c0 -9 0 -16 50 -16c14 0 24 0 24 -11c0 -20 -13 -20 -18 -20c-32 0 -66 3 -99 3c-28 0 -57 -3 -84 -3c-8 0 -13 4 -13 12c0 19 11 19 23 19c44 0 46 7 54 41l112 445c4 17 7 28 7 51 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c37 0 80 -21 90 -75c33 39 81 75 131 75c76 0 133 -66 133 -160zM418 326c0 59 -24 94 -64 94c-17 0 -46 -7 -81 -38c-18 -15 -45 -43 -52 -70 l-49 -196c-3 -12 -3 -16 -3 -16c0 -6 13 -89 79 -89c37 0 85 33 119 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45D" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="503" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="893" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1465" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="1910" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2396" y="0"></use>
</g>
</svg>, and the bump
offset function is a scalar function <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.509ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2802.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">d left-parenthesis u comma v right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="520" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="910" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1482" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="1927" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2413" y="0"></use>
</g>
</svg>.  Then the displaced surface
is given by
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="33.796ex" height="3.009ex" style="vertical-align: -0.838ex; margin-left: -0.073ex;" viewBox="-31.5 -934.9 14550.8 1295.7" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">p prime left-parenthesis u comma v right-parenthesis equals p left-parenthesis u comma v right-parenthesis plus d left-parenthesis u comma v right-parenthesis bold n Subscript Baseline left-parenthesis u comma v right-parenthesis comma</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45D" d="M490 282c0 -147 -125 -293 -241 -293c-51 0 -79 35 -92 64c-7 -25 -49 -188 -49 -200c0 -9 0 -16 50 -16c14 0 24 0 24 -11c0 -20 -13 -20 -18 -20c-32 0 -66 3 -99 3c-28 0 -57 -3 -84 -3c-8 0 -13 4 -13 12c0 19 11 19 23 19c44 0 46 7 54 41l112 445c4 17 7 28 7 51 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c37 0 80 -21 90 -75c33 39 81 75 131 75c76 0 133 -66 133 -160zM418 326c0 59 -24 94 -64 94c-17 0 -46 -7 -81 -38c-18 -15 -45 -43 -52 -70 l-49 -196c-3 -12 -3 -16 -3 -16c0 -6 13 -89 79 -89c37 0 85 33 119 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D427" d="M615 0l-126 3l-126 -3v47h69v270c0 76 -21 97 -55 97c-63 0 -149 -49 -149 -158v-209h69v-47l-126 3l-126 -3v47h69v309c0 39 -7 39 -69 39v47l172 8v-108c26 51 79 108 175 108c100 0 154 -39 154 -144v-259h69v-47Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45D" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="712" y="583"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="891" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="1281" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1853" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="2298" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2784" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="3451" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45D" x="4507" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="5011" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="5400" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="5973" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="6418" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="6904" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="7515" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="8516" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="9036" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="9426" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="9998" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="10444" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="10929" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D427" x="11319" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="11958" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="12348" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="12920" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="13365" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="13851" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="14240" y="0"></use>
</g>
</svg>
</div>
<p>

where <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.786ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2921.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold n Subscript Baseline left-parenthesis u comma v right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D427" d="M615 0l-126 3l-126 -3v47h69v270c0 76 -21 97 -55 97c-63 0 -149 -49 -149 -158v-209h69v-47l-126 3l-126 -3v47h69v309c0 39 -7 39 -69 39v47l172 8v-108c26 51 79 108 175 108c100 0 154 -39 154 -144v-259h69v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D427" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="639" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="1029" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1601" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="2046" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2532" y="0"></use>
</g>
</svg> is the surface normal at <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.301ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2282.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis u comma v right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="962" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="1407" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1892" y="0"></use>
</g>
</svg>.

</p>
<p></p>
<span class="anchor" id="fragment-BumpMappingFunctionDefinitions-0"></span><div class="fragmentname">&lt;&lt;Bump Mapping Function Definitions&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">template &lt;typename <a href="#TextureEvaluator" class="code">TextureEvaluator</a>&gt;
void <span class="anchor" id="BumpMap"></span>BumpMap(<a href="#TextureEvaluator" class="code">TextureEvaluator</a> texEval, <a href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html#FloatTexture" class="code">FloatTexture</a> displacement,
        const <a href="#NormalBumpEvalContext" class="code">NormalBumpEvalContext</a> &amp;ctx, <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> *dpdu, <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> *dpdv) {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Computeoffsetpositionsandevaluatedisplacementtexture-0">Compute offset positions and evaluate displacement texture</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1553" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1553"><i></i></a><div id="fragbit-1553" class="collapse"><div class="fragmentcode">       <a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureEvalContext" class="code">TextureEvalContext</a> shiftedCtx = ctx;
       &lt;&lt;<span class="fragmentname"><a href="#fragment-ShiftmonoshiftedCtxmonoduintheudirection-0">Shift <tt>shiftedCtx</tt> <tt>du</tt> in the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
</g>
</svg> direction</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1554" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1554"><i></i></a><div id="fragbit-1554" class="collapse"><div class="fragmentcode">          Float du = .5f * (std::abs(ctx.<a href="#NormalBumpEvalContext::dudx" class="code">dudx</a>) + std::abs(ctx.<a href="#NormalBumpEvalContext::dudy" class="code">dudy</a>));
          if (du == 0) du = .0005f;
          shiftedCtx.<a href="#NormalBumpEvalContext::p" class="code">p</a> = ctx.<a href="#NormalBumpEvalContext::p" class="code">p</a> + du * ctx.shading.<a href="#NormalBumpEvalContext::shading::dpdu" class="code">dpdu</a>;
          shiftedCtx.<a href="#NormalBumpEvalContext::uv" class="code">uv</a> = ctx.<a href="#NormalBumpEvalContext::uv" class="code">uv</a> + <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a>(du, 0.f);</div></div>
       Float uDisplace = texEval(displacement, shiftedCtx);
       &lt;&lt;<span class="fragmentname">Shift <tt>shiftedCtx</tt> <tt>dv</tt> in the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.128ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 485.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">v</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="0" y="0"></use>
</g>
</svg> direction</span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1555" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1555"><i></i></a><div id="fragbit-1555" class="collapse"><div class="fragmentcode">          Float dv = .5f * (std::abs(ctx.dvdx) + std::abs(ctx.dvdy));
          if (dv == 0) dv = .0005f;
          shiftedCtx.p = ctx.p + dv * ctx.shading.dpdv;
          shiftedCtx.uv = ctx.uv + <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a>(0.f, dv);</div></div>
       Float vDisplace = texEval(displacement, shiftedCtx);
       Float displace = texEval(displacement, ctx);</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Computebump-mappeddifferentialgeometry-0">Compute bump-mapped differential geometry</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1556" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1556"><i></i></a><div id="fragbit-1556" class="collapse"><div class="fragmentcode">       *<a href="#NormalBumpEvalContext::shading::dpdu" class="code">dpdu</a> = ctx.shading.<a href="#NormalBumpEvalContext::shading::dpdu" class="code">dpdu</a> +
               (uDisplace - displace) / du * <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a>(ctx.shading.<a href="#NormalBumpEvalContext::shading::n" class="code">n</a>) +
               displace * <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a>(ctx.shading.<a href="#NormalBumpEvalContext::shading::dndu" class="code">dndu</a>);
       *<a href="#NormalBumpEvalContext::shading::dpdv" class="code">dpdv</a> = ctx.shading.<a href="#NormalBumpEvalContext::shading::dpdv" class="code">dpdv</a> +
               (vDisplace - displace) / dv * <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a>(ctx.shading.<a href="#NormalBumpEvalContext::shading::n" class="code">n</a>) +
               displace * <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a>(ctx.shading.<a href="#NormalBumpEvalContext::shading::dndv" class="code">dndv</a>);</div></div>
}</div><p>


</p>
<p>The partial derivatives of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.144ex" height="2.676ex" style="vertical-align: -0.671ex; margin-left: -0.073ex;" viewBox="-31.5 -863.1 923.1 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">p prime</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45D" d="M490 282c0 -147 -125 -293 -241 -293c-51 0 -79 35 -92 64c-7 -25 -49 -188 -49 -200c0 -9 0 -16 50 -16c14 0 24 0 24 -11c0 -20 -13 -20 -18 -20c-32 0 -66 3 -99 3c-28 0 -57 -3 -84 -3c-8 0 -13 4 -13 12c0 19 11 19 23 19c44 0 46 7 54 41l112 445c4 17 7 28 7 51 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c37 0 80 -21 90 -75c33 39 81 75 131 75c76 0 133 -66 133 -160zM418 326c0 59 -24 94 -64 94c-17 0 -46 -7 -81 -38c-18 -15 -45 -43 -52 -70 l-49 -196c-3 -12 -3 -16 -3 -16c0 -6 13 -89 79 -89c37 0 85 33 119 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45D" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="712" y="513"></use>
</g>
</svg> can be found using the chain rule.
For example, the partial derivative in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
</g>
</svg> is
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="eq:bump-map"></span><div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="53.351ex" height="5.843ex" style="vertical-align: -2.005ex;" viewBox="0 -1652.5 22970.4 2515.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">StartFraction partial-differential p Superscript prime Baseline Over partial-differential u EndFraction equals StartFraction partial-differential p left-parenthesis u comma v right-parenthesis Over partial-differential u EndFraction plus StartFraction partial-differential d left-parenthesis u comma v right-parenthesis Over partial-differential u EndFraction bold n Subscript Baseline left-parenthesis u comma v right-parenthesis plus d left-parenthesis u comma v right-parenthesis StartFraction partial-differential bold n Subscript Baseline left-parenthesis u comma v right-parenthesis Over partial-differential u EndFraction period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45D" d="M490 282c0 -147 -125 -293 -241 -293c-51 0 -79 35 -92 64c-7 -25 -49 -188 -49 -200c0 -9 0 -16 50 -16c14 0 24 0 24 -11c0 -20 -13 -20 -18 -20c-32 0 -66 3 -99 3c-28 0 -57 -3 -84 -3c-8 0 -13 4 -13 12c0 19 11 19 23 19c44 0 46 7 54 41l112 445c4 17 7 28 7 51 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c37 0 80 -21 90 -75c33 39 81 75 131 75c76 0 133 -66 133 -160zM418 326c0 59 -24 94 -64 94c-17 0 -46 -7 -81 -38c-18 -15 -45 -43 -52 -70 l-49 -196c-3 -12 -3 -16 -3 -16c0 -6 13 -89 79 -89c37 0 85 33 119 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D427" d="M615 0l-126 3l-126 -3v47h69v270c0 76 -21 97 -55 97c-63 0 -149 -49 -149 -158v-209h69v-47l-126 3l-126 -3v47h69v309c0 39 -7 39 -69 39v47l172 8v-108c26 51 79 108 175 108c100 0 154 -39 154 -144v-259h69v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
<g transform="translate(120,0)">
<rect stroke="none" width="1598" height="60" x="0" y="220"></rect>
<g transform="translate(60,714)">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
<g transform="translate(586,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45D" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="712" y="513"></use>
</g>
</g>
<g transform="translate(219,-737)">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="586" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="2115" y="0"></use>
<g transform="translate(2894,0)">
<g transform="translate(397,0)">
<rect stroke="none" width="3492" height="60" x="0" y="220"></rect>
<g transform="translate(60,768)">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45D" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1090" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="1479" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2052" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="2497" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2982" y="0"></use>
</g>
<g transform="translate(1166,-737)">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="586" y="0"></use>
</g>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="7126" y="0"></use>
<g transform="translate(7905,0)">
<g transform="translate(342,0)">
<rect stroke="none" width="3509" height="60" x="0" y="220"></rect>
<g transform="translate(60,768)">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1107" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="1496" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2069" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="2514" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2999" y="0"></use>
</g>
<g transform="translate(1175,-737)">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="586" y="0"></use>
</g>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D427" x="11876" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="12515" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="12905" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="13477" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="13923" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="14408" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="15020" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="16021" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="16541" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="16931" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="17503" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="17948" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="18434" y="0"></use>
<g transform="translate(18823,0)">
<g transform="translate(120,0)">
<rect stroke="none" width="3628" height="60" x="0" y="220"></rect>
<g transform="translate(60,768)">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D427" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1226" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="1615" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2188" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="2633" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="3118" y="0"></use>
</g>
<g transform="translate(1234,-737)">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="586" y="0"></use>
</g>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="22691" y="0"></use>
</g>
</svg>
</div>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">
<div class="eqno">(<a href="#eq:bump-map">10.12</a>)</div>
</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<p>

We have already computed the value of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.686ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 5031.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential p left-parenthesis u comma v right-parenthesis slash partial-differential u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45D" d="M490 282c0 -147 -125 -293 -241 -293c-51 0 -79 35 -92 64c-7 -25 -49 -188 -49 -200c0 -9 0 -16 50 -16c14 0 24 0 24 -11c0 -20 -13 -20 -18 -20c-32 0 -66 3 -99 3c-28 0 -57 -3 -84 -3c-8 0 -13 4 -13 12c0 19 11 19 23 19c44 0 46 7 54 41l112 445c4 17 7 28 7 51 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c37 0 80 -21 90 -75c33 39 81 75 131 75c76 0 133 -66 133 -160zM418 326c0 59 -24 94 -64 94c-17 0 -46 -7 -81 -38c-18 -15 -45 -43 -52 -70 l-49 -196c-3 -12 -3 -16 -3 -16c0 -6 13 -89 79 -89c37 0 85 33 119 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45D" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1090" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="1479" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2052" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="2497" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2982" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="3372" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="3872" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="4459" y="0"></use>
</g>
</svg>; it is
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.509ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2802.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential normal p slash partial-differential u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1143" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1643" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="2230" y="0"></use>
</g>
</svg> and is available in the <a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureEvalContext"><tt>TextureEvalContext</tt></a> structure, which
also stores the surface normal <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.786ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2921.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold n Subscript Baseline left-parenthesis u comma v right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D427" d="M615 0l-126 3l-126 -3v47h69v270c0 76 -21 97 -55 97c-63 0 -149 -49 -149 -158v-209h69v-47l-126 3l-126 -3v47h69v309c0 39 -7 39 -69 39v47l172 8v-108c26 51 79 108 175 108c100 0 154 -39 154 -144v-259h69v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D427" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="639" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="1029" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1601" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="2046" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2532" y="0"></use>
</g>
</svg> and the partial derivative
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="21.803ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 9387.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential bold n Subscript Baseline left-parenthesis u comma v right-parenthesis slash partial-differential u equals partial-differential bold n Subscript Baseline slash partial-differential u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D427" d="M615 0l-126 3l-126 -3v47h69v270c0 76 -21 97 -55 97c-63 0 -149 -49 -149 -158v-209h69v-47l-126 3l-126 -3v47h69v309c0 39 -7 39 -69 39v47l172 8v-108c26 51 79 108 175 108c100 0 154 -39 154 -144v-259h69v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D427" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1226" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="1615" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2188" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="2633" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="3118" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="3508" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="4008" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="4595" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="5445" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="6501" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D427" x="7088" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="7727" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="8228" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="8814" y="0"></use>
</g>
</svg>.  The displacement function
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.509ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2802.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">d left-parenthesis u comma v right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="520" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="910" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1482" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="1927" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2413" y="0"></use>
</g>
</svg> can be readily evaluated, which leaves <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.726ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 5048.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential d left-parenthesis u comma v right-parenthesis slash partial-differential u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1107" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="1496" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2069" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="2514" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2999" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="3389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="3889" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="4476" y="0"></use>
</g>
</svg> as the only remaining term.

</p>
<p>There are two possible approaches to finding the values of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.726ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 5048.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential d left-parenthesis u comma v right-parenthesis slash partial-differential u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1107" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="1496" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2069" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="2514" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2999" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="3389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="3889" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="4476" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.524ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 4961.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential d left-parenthesis u comma v right-parenthesis slash partial-differential v</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1107" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="1496" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2069" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="2514" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2999" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="3389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="3889" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="4476" y="0"></use>
</g>
</svg>.  One option would be
to augment the <tt>FloatTexture</tt> interface with a method to compute partial
derivatives of the underlying texture function.  For example, for image map
textures mapped to the surface directly using its <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.301ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2282.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis u comma v right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="962" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="1407" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1892" y="0"></use>
</g>
</svg> parameterization,
these partial derivatives can be computed by subtracting adjacent texels in
the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.128ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 485.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">v</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="0" y="0"></use>
</g>
</svg> directions.  However, this approach is difficult to extend
to complex procedural textures like some of the ones defined earlier in
this chapter.  Therefore, <tt>pbrt</tt> directly computes these values with
forward differencing, without modifying the <tt>FloatTexture</tt> interface.

</p>
<p>Recall the definition of the partial derivative:
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="40.246ex" height="6.176ex" style="vertical-align: -2.338ex;" viewBox="0 -1652.5 17328 2659.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">StartFraction partial-differential d left-parenthesis u comma v right-parenthesis Over partial-differential u EndFraction equals limit Underscript normal upper Delta Subscript u Baseline right-arrow 0 Endscripts StartFraction d left-parenthesis u plus normal upper Delta Subscript u Baseline comma v right-parenthesis minus d left-parenthesis u comma v right-parenthesis Over normal upper Delta Subscript u Baseline EndFraction period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E2-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E2-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E2-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E2-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-6C" d="M255 0l-111 3l-111 -3v31c67 0 78 0 78 45v520c0 49 -8 56 -78 56v31l144 11v-618c0 -45 11 -45 78 -45v-31Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-69" d="M247 0c-34 1 -69 3 -104 3l-110 -3v31c67 0 78 0 78 45v269c0 49 -9 55 -74 55v31l140 11v-367c0 -39 4 -44 70 -44v-31zM192 604c0 -25 -20 -53 -54 -53c-30 0 -53 26 -53 53c0 25 20 53 54 53c30 0 53 -26 53 -53Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-6D" d="M813 0l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31 c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l141 11v-105c28 62 75 105 148 105c45 0 119 -11 133 -98c17 38 61 98 145 98c58 0 91 -20 105 -37c31 -36 31 -67 31 -153v-191c1 -30 26 -30 78 -30v-31Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-394" d="M785 8c0 -8 -6 -8 -22 -8h-694c-16 0 -22 0 -22 8c0 0 0 3 5 12l338 678c7 13 9 18 26 18s19 -5 26 -18l338 -678c5 -9 5 -12 5 -12zM653 76l-269 540l-270 -540h539Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-2192" d="M943 250c0 -6 -4 -11 -9 -13c-57 -19 -101 -59 -137 -104c-28 -36 -49 -80 -58 -127c-2 -9 -10 -16 -20 -16c-11 0 -20 9 -20 20c0 1 1 3 1 4c10 53 33 102 66 144c22 28 48 52 78 72h-766c-11 0 -20 9 -20 20s9 20 20 20h766c-30 20 -56 44 -78 72 c-33 42 -56 91 -66 144c0 1 -1 3 -1 4c0 11 9 20 20 20c10 0 18 -7 20 -16c9 -47 30 -91 58 -127c36 -45 80 -85 137 -104c5 -2 9 -7 9 -13Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E2-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
<g transform="translate(120,0)">
<rect stroke="none" width="3509" height="60" x="0" y="220"></rect>
<g transform="translate(60,768)">
 <use xlink:href="#E2-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E2-LATINMODERNNORMAL-1D451" x="586" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-28" x="1107" y="0"></use>
 <use xlink:href="#E2-LATINMODERNNORMAL-1D462" x="1496" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-2C" x="2069" y="0"></use>
 <use xlink:href="#E2-LATINMODERNNORMAL-1D463" x="2514" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-29" x="2999" y="0"></use>
</g>
<g transform="translate(1175,-737)">
 <use xlink:href="#E2-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E2-LATINMODERNNORMAL-1D462" x="586" y="0"></use>
</g>
</g>
 <use xlink:href="#E2-LATINMODERNMAIN-3D" x="4026" y="0"></use>
<g transform="translate(5083,0)">
<g transform="translate(329,0)">
 <use xlink:href="#E2-LATINMODERNMAIN-6C"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-69" x="278" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-6D" x="557" y="0"></use>
</g>
<g transform="translate(0,-675)">
 <use transform="scale(0.707)" xlink:href="#E2-LATINMODERNMAIN-394" x="0" y="0"></use>
 <use transform="scale(0.574)" xlink:href="#E2-LATINMODERNNORMAL-1D462" x="1026" y="-185"></use>
 <use transform="scale(0.707)" xlink:href="#E2-LATINMODERNMAIN-2192" x="1398" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E2-LATINMODERNMAIN-30" x="2398" y="0"></use>
</g>
</g>
<g transform="translate(7133,0)">
<g transform="translate(286,0)">
<rect stroke="none" width="9509" height="60" x="0" y="220"></rect>
<g transform="translate(60,768)">
 <use xlink:href="#E2-LATINMODERNNORMAL-1D451" x="0" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-28" x="520" y="0"></use>
 <use xlink:href="#E2-LATINMODERNNORMAL-1D462" x="910" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-2B" x="1704" y="0"></use>
<g transform="translate(2705,0)">
 <use xlink:href="#E2-LATINMODERNMAIN-394" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E2-LATINMODERNNORMAL-1D462" x="1178" y="-213"></use>
</g>
 <use xlink:href="#E2-LATINMODERNMAIN-2C" x="4043" y="0"></use>
 <use xlink:href="#E2-LATINMODERNNORMAL-1D463" x="4488" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-29" x="4974" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-2212" x="5586" y="0"></use>
 <use xlink:href="#E2-LATINMODERNNORMAL-1D451" x="6586" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-28" x="7107" y="0"></use>
 <use xlink:href="#E2-LATINMODERNNORMAL-1D462" x="7496" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-2C" x="8069" y="0"></use>
 <use xlink:href="#E2-LATINMODERNNORMAL-1D463" x="8514" y="0"></use>
 <use xlink:href="#E2-LATINMODERNMAIN-29" x="9000" y="0"></use>
</g>
<g transform="translate(4085,-737)">
 <use xlink:href="#E2-LATINMODERNMAIN-394" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E2-LATINMODERNNORMAL-1D462" x="1178" y="-213"></use>
</g>
</g>
</g>
 <use xlink:href="#E2-LATINMODERNMAIN-2E" x="17049" y="0"></use>
</g>
</svg>
</div>
<p>

Forward differencing approximates the value using a finite value of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.108ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1338.3 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal upper Delta Subscript u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-394" d="M785 8c0 -8 -6 -8 -22 -8h-694c-16 0 -22 0 -22 8c0 0 0 3 5 12l338 678c7 13 9 18 26 18s19 -5 26 -18l338 -678c5 -9 5 -12 5 -12zM653 76l-269 540l-270 -540h539Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-394" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D462" x="1178" y="-213"></use>
</g>
</svg>
and evaluating <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.509ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2802.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">d left-parenthesis u comma v right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="520" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="910" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1482" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="1927" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2413" y="0"></use>
</g>
</svg> at two positions.  Thus, the final expression for
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.287ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3137.6 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential p prime slash partial-differential u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45D" d="M490 282c0 -147 -125 -293 -241 -293c-51 0 -79 35 -92 64c-7 -25 -49 -188 -49 -200c0 -9 0 -16 50 -16c14 0 24 0 24 -11c0 -20 -13 -20 -18 -20c-32 0 -66 3 -99 3c-28 0 -57 -3 -84 -3c-8 0 -13 4 -13 12c0 19 11 19 23 19c44 0 46 7 54 41l112 445c4 17 7 28 7 51 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c37 0 80 -21 90 -75c33 39 81 75 131 75c76 0 133 -66 133 -160zM418 326c0 59 -24 94 -64 94c-17 0 -46 -7 -81 -38c-18 -15 -45 -43 -52 -70 l-49 -196c-3 -12 -3 -16 -3 -16c0 -6 13 -89 79 -89c37 0 85 33 119 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
<g transform="translate(586,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45D" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="712" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1478" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1978" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="2565" y="0"></use>
</g>
</svg> is the following (for simplicity, we have dropped the explicit dependence on <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.301ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2282.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis u comma v right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="962" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="1407" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1892" y="0"></use>
</g>
</svg>
for some of the terms):
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="51.534ex" height="6.176ex" style="vertical-align: -2.338ex;" viewBox="0 -1652.5 22188.3 2659.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">StartFraction partial-differential p Superscript prime Baseline Over partial-differential u EndFraction almost-equals StartFraction partial-differential normal p Over partial-differential u EndFraction plus StartFraction d left-parenthesis u plus normal upper Delta Subscript u Baseline comma v right-parenthesis minus d left-parenthesis u comma v right-parenthesis Over normal upper Delta Subscript u Baseline EndFraction bold n Subscript Baseline plus d left-parenthesis u comma v right-parenthesis StartFraction partial-differential bold n Over partial-differential u EndFraction period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45D" d="M490 282c0 -147 -125 -293 -241 -293c-51 0 -79 35 -92 64c-7 -25 -49 -188 -49 -200c0 -9 0 -16 50 -16c14 0 24 0 24 -11c0 -20 -13 -20 -18 -20c-32 0 -66 3 -99 3c-28 0 -57 -3 -84 -3c-8 0 -13 4 -13 12c0 19 11 19 23 19c44 0 46 7 54 41l112 445c4 17 7 28 7 51 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c37 0 80 -21 90 -75c33 39 81 75 131 75c76 0 133 -66 133 -160zM418 326c0 59 -24 94 -64 94c-17 0 -46 -7 -81 -38c-18 -15 -45 -43 -52 -70 l-49 -196c-3 -12 -3 -16 -3 -16c0 -6 13 -89 79 -89c37 0 85 33 119 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2248" d="M717 438v-2c-20 -93 -56 -149 -139 -169c-11 -3 -23 -4 -35 -4c-62 0 -120 37 -172 76c-43 32 -89 67 -138 67c-9 0 -17 -1 -26 -3c-67 -17 -111 -49 -127 -124c-1 -5 -6 -9 -12 -9c-7 0 -12 5 -12 12v2c20 93 56 149 139 169c12 3 24 4 35 4c62 0 120 -37 172 -76 c43 -32 89 -67 139 -67c8 0 16 1 25 3c67 17 111 49 127 124c2 5 6 9 12 9c7 0 12 -5 12 -12zM717 218v-2c-20 -93 -56 -149 -139 -169c-11 -3 -23 -4 -35 -4c-62 0 -120 37 -172 76c-43 32 -89 67 -138 67c-9 0 -17 -1 -26 -3c-67 -17 -111 -49 -127 -124 c-1 -5 -6 -9 -12 -9c-7 0 -12 5 -12 12v2c20 93 56 149 139 169c12 3 24 4 35 4c62 0 120 -37 172 -76c43 -32 89 -67 139 -67c8 0 16 1 25 3c67 17 111 49 127 124c2 5 6 9 12 9c7 0 12 -5 12 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-394" d="M785 8c0 -8 -6 -8 -22 -8h-694c-16 0 -22 0 -22 8c0 0 0 3 5 12l338 678c7 13 9 18 26 18s19 -5 26 -18l338 -678c5 -9 5 -12 5 -12zM653 76l-269 540l-270 -540h539Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D427" d="M615 0l-126 3l-126 -3v47h69v270c0 76 -21 97 -55 97c-63 0 -149 -49 -149 -158v-209h69v-47l-126 3l-126 -3v47h69v309c0 39 -7 39 -69 39v47l172 8v-108c26 51 79 108 175 108c100 0 154 -39 154 -144v-259h69v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
<g transform="translate(120,0)">
<rect stroke="none" width="1598" height="60" x="0" y="220"></rect>
<g transform="translate(60,714)">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
<g transform="translate(586,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45D" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="712" y="513"></use>
</g>
</g>
<g transform="translate(219,-737)">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="586" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2248" x="2115" y="0"></use>
<g transform="translate(2889,0)">
<g transform="translate(397,0)">
<rect stroke="none" width="1279" height="60" x="0" y="220"></rect>
<g transform="translate(68,714)">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="586" y="0"></use>
</g>
<g transform="translate(60,-737)">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="586" y="0"></use>
</g>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="4908" y="0"></use>
<g transform="translate(5686,0)">
<g transform="translate(342,0)">
<rect stroke="none" width="9509" height="60" x="0" y="220"></rect>
<g transform="translate(60,768)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="520" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="910" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="1704" y="0"></use>
<g transform="translate(2705,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-394" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D462" x="1178" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="4043" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="4488" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="4974" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="5586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="6586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="7107" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="7496" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="8069" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="8514" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="9000" y="0"></use>
</g>
<g transform="translate(4085,-737)">
 <use xlink:href="#E1-LATINMODERNMAIN-394" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D462" x="1178" y="-213"></use>
</g>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D427" x="15658" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="16520" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="17521" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="18041" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="18431" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="19003" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="19448" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="19934" y="0"></use>
<g transform="translate(20323,0)">
<g transform="translate(120,0)">
<rect stroke="none" width="1346" height="60" x="0" y="220"></rect>
<g transform="translate(60,676)">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D427" x="586" y="0"></use>
</g>
<g transform="translate(93,-737)">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="586" y="0"></use>
</g>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="21909" y="0"></use>
</g>
</svg>
</div>
<p>


</p>
<p>Interestingly enough, most bump-mapping implementations ignore the final
term under the assumption that <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.509ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2802.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">d left-parenthesis u comma v right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="520" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="910" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1482" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="1927" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2413" y="0"></use>
</g>
</svg> is expected to be relatively small.
(Since bump mapping is mostly useful for approximating small perturbations,
this is a reasonable assumption.)  The fact that many renderers do not
compute the values <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.702ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2885.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential bold n Subscript slash partial-differential u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D427" d="M615 0l-126 3l-126 -3v47h69v270c0 76 -21 97 -55 97c-63 0 -149 -49 -149 -158v-209h69v-47l-126 3l-126 -3v47h69v309c0 39 -7 39 -69 39v47l172 8v-108c26 51 79 108 175 108c100 0 154 -39 154 -144v-259h69v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D427" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1226" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1726" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="2313" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.5ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2798.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential bold n Subscript slash partial-differential v</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D427" d="M615 0l-126 3l-126 -3v47h69v270c0 76 -21 97 -55 97c-63 0 -149 -49 -149 -158v-209h69v-47l-126 3l-126 -3v47h69v309c0 39 -7 39 -69 39v47l172 8v-108c26 51 79 108 175 108c100 0 154 -39 154 -144v-259h69v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D427" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1226" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1726" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="2313" y="0"></use>
</g>
</svg> may also have something to do with
this simplification.  An implication of ignoring the last term is that the
magnitude of the displacement function then does not affect the bump-mapped
partial derivatives; adding a constant value to it globally does not affect
the final result, since only differences of the bump function affect it.
<tt>pbrt</tt> computes all three terms since it has <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.702ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2885.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential bold n Subscript slash partial-differential u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D427" d="M615 0l-126 3l-126 -3v47h69v270c0 76 -21 97 -55 97c-63 0 -149 -49 -149 -158v-209h69v-47l-126 3l-126 -3v47h69v309c0 39 -7 39 -69 39v47l172 8v-108c26 51 79 108 175 108c100 0 154 -39 154 -144v-259h69v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D427" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1226" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1726" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="2313" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.5ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2798.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential bold n Subscript slash partial-differential v</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D427" d="M615 0l-126 3l-126 -3v47h69v270c0 76 -21 97 -55 97c-63 0 -149 -49 -149 -158v-209h69v-47l-126 3l-126 -3v47h69v309c0 39 -7 39 -69 39v47l172 8v-108c26 51 79 108 175 108c100 0 154 -39 154 -144v-259h69v-47Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D427" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1226" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1726" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="2313" y="0"></use>
</g>
</svg> readily
available, although in practice this final term rarely makes a visually
noticeable difference.

</p>
<p></p>
<span class="anchor" id="fragment-Computeoffsetpositionsandevaluatedisplacementtexture-0"></span><div class="fragmentname">&lt;&lt;Compute offset positions and evaluate displacement texture&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureEvalContext" class="code">TextureEvalContext</a> shiftedCtx = ctx;
&lt;&lt;<span class="fragmentname"><a href="#fragment-ShiftmonoshiftedCtxmonoduintheudirection-0">Shift <tt>shiftedCtx</tt> <tt>du</tt> in the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
</g>
</svg> direction</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1557" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1557"><i></i></a><div id="fragbit-1557" class="collapse"><div class="fragmentcode">   Float du = .5f * (std::abs(ctx.<a href="#NormalBumpEvalContext::dudx" class="code">dudx</a>) + std::abs(ctx.<a href="#NormalBumpEvalContext::dudy" class="code">dudy</a>));
   if (du == 0) du = .0005f;
   shiftedCtx.<a href="#NormalBumpEvalContext::p" class="code">p</a> = ctx.<a href="#NormalBumpEvalContext::p" class="code">p</a> + du * ctx.shading.<a href="#NormalBumpEvalContext::shading::dpdu" class="code">dpdu</a>;
   shiftedCtx.<a href="#NormalBumpEvalContext::uv" class="code">uv</a> = ctx.<a href="#NormalBumpEvalContext::uv" class="code">uv</a> + <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a>(du, 0.f);</div></div>
Float uDisplace = texEval(displacement, shiftedCtx);
&lt;&lt;<span class="fragmentname">Shift <tt>shiftedCtx</tt> <tt>dv</tt> in the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.128ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 485.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">v</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="0" y="0"></use>
</g>
</svg> direction</span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1558" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1558"><i></i></a><div id="fragbit-1558" class="collapse"><div class="fragmentcode">   Float dv = .5f * (std::abs(ctx.dvdx) + std::abs(ctx.dvdy));
   if (dv == 0) dv = .0005f;
   shiftedCtx.p = ctx.p + dv * ctx.shading.dpdv;
   shiftedCtx.uv = ctx.uv + <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a>(0.f, dv);</div></div>
Float vDisplace = texEval(displacement, shiftedCtx);
Float displace = texEval(displacement, ctx);</div><p>


</p>
<p>One remaining issue is how to choose the offsets <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.108ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1338.3 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal upper Delta Subscript u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-394" d="M785 8c0 -8 -6 -8 -22 -8h-694c-16 0 -22 0 -22 8c0 0 0 3 5 12l338 678c7 13 9 18 26 18s19 -5 26 -18l338 -678c5 -9 5 -12 5 -12zM653 76l-269 540l-270 -540h539Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-394" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D462" x="1178" y="-213"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.965ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1276.8 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal upper Delta Subscript v</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-394" d="M785 8c0 -8 -6 -8 -22 -8h-694c-16 0 -22 0 -22 8c0 0 0 3 5 12l338 678c7 13 9 18 26 18s19 -5 26 -18l338 -678c5 -9 5 -12 5 -12zM653 76l-269 540l-270 -540h539Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-394" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D463" x="1178" y="-213"></use>
</g>
</svg>
for the finite differencing computations.  They should be small enough that
fine changes in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.509ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2802.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">d left-parenthesis u comma v right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="520" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="910" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1482" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="1927" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2413" y="0"></use>
</g>
</svg> are captured but large enough so that available
floating-point precision is sufficient to give a good result.  Here, we
will choose <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.108ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1338.3 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal upper Delta Subscript u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-394" d="M785 8c0 -8 -6 -8 -22 -8h-694c-16 0 -22 0 -22 8c0 0 0 3 5 12l338 678c7 13 9 18 26 18s19 -5 26 -18l338 -678c5 -9 5 -12 5 -12zM653 76l-269 540l-270 -540h539Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-394" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D462" x="1178" y="-213"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.965ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1276.8 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal upper Delta Subscript v</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-394" d="M785 8c0 -8 -6 -8 -22 -8h-694c-16 0 -22 0 -22 8c0 0 0 3 5 12l338 678c7 13 9 18 26 18s19 -5 26 -18l338 -678c5 -9 5 -12 5 -12zM653 76l-269 540l-270 -540h539Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-394" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D463" x="1178" y="-213"></use>
</g>
</svg> values that lead to an offset that is
about half the image-space pixel sample spacing and use them to update the
appropriate member variables in the <a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureEvalContext"><tt>TextureEvalContext</tt></a> to reflect a
shift to the offset position.

</p>
<p></p>
<span class="anchor" id="fragment-ShiftmonoshiftedCtxmonoduintheudirection-0"></span><div class="fragmentname">&lt;&lt;Shift <tt>shiftedCtx</tt> <tt>du</tt> in the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
</g>
</svg> direction&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float du = .5f * (std::abs(ctx.<a href="#NormalBumpEvalContext::dudx" class="code">dudx</a>) + std::abs(ctx.<a href="#NormalBumpEvalContext::dudy" class="code">dudy</a>));
if (du == 0) du = .0005f;
shiftedCtx.<a href="#NormalBumpEvalContext::p" class="code">p</a> = ctx.<a href="#NormalBumpEvalContext::p" class="code">p</a> + du * ctx.shading.<a href="#NormalBumpEvalContext::shading::dpdu" class="code">dpdu</a>;
shiftedCtx.<a href="#NormalBumpEvalContext::uv" class="code">uv</a> = ctx.<a href="#NormalBumpEvalContext::uv" class="code">uv</a> + <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a>(du, 0.f);</div><p>


</p>
<p>The &lt;&lt;<span class="fragmentname">Shift <tt>shiftedCtx</tt> <tt>dv</tt> in the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.128ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 485.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">v</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="0" y="0"></use>
</g>
</svg> direction</span>&gt;&gt; fragment
is nearly the same as the fragment that shifts <tt>du</tt>, so it is not included
here.

</p>
<p>

</p>
<p>Given the new positions and the displacement texture&rsquo;s values at them, the
partial derivatives can be computed directly using
Equation&nbsp;(<a href="#eq:bump-map">10.12</a>):

</p>
<p></p>
<span class="anchor" id="fragment-Computebump-mappeddifferentialgeometry-0"></span><div class="fragmentname">&lt;&lt;Compute bump-mapped differential geometry&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">*<a href="#NormalBumpEvalContext::shading::dpdu" class="code">dpdu</a> = ctx.shading.<a href="#NormalBumpEvalContext::shading::dpdu" class="code">dpdu</a> +
        (uDisplace - displace) / du * <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a>(ctx.shading.<a href="#NormalBumpEvalContext::shading::n" class="code">n</a>) +
        displace * <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a>(ctx.shading.<a href="#NormalBumpEvalContext::shading::dndu" class="code">dndu</a>);
*<a href="#NormalBumpEvalContext::shading::dpdv" class="code">dpdv</a> = ctx.shading.<a href="#NormalBumpEvalContext::shading::dpdv" class="code">dpdv</a> +
        (vDisplace - displace) / dv * <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a>(ctx.shading.<a href="#NormalBumpEvalContext::shading::n" class="code">n</a>) +
        displace * <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a>(ctx.shading.<a href="#NormalBumpEvalContext::shading::dndv" class="code">dndv</a>);</div><p>


</p>
<p>

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

</div>  <!-- container-fluid -->
</div>  <!-- maincontainer -->

<nav class="navbar navbar-expand-md bg-light navbar-light">
<div class="container-fluid">
  <span class="navbar-text"><i>Physically Based Rendering: From Theory To Implementation</i>,<br>
<a href="https://creativecommons.org/licenses/by-nc-nd/4.0/">&copy; 2004-2023</a> Matt Pharr, Wenzel Jakob, and Greg Humphreys.
<a href="https://github.com/mmp/pbr-book-website/"><span class="fab fa-github"></span></a><br>
Purchase a printed copy: <a href="https://www.amazon.com/Physically-Based-Rendering-fourth-Implementation/dp/0262048027?keywords=physically+based+rendering+4th+edition&qid=1671730412&sprefix=physically+based%!C(MISSING)aps%!C(MISSING)145&sr=8-1&linkCode=ll1&tag=pharr-20&linkId=81a816d90f0c7e872617f1f930a51fd6&language=en_US&ref_=as_li_ss_tl"><span class="fab fa-amazon"></span></a>
<a href="https://mitpress.mit.edu/9780262048026/physically-based-rendering/"><img src="/mitpress.png" width=10 height=16></a>
</span>
</div>
  <div class="container">
    <ul class="nav navbar-nav ml-auto">
      <li class="nav-item">Next: <a href="../Textures_and_Materials/Further_Reading.html">Textures and Materials / Further Reading</a></li>
    </ul>
  </div>

</nav>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script>
  $(function () {
    $('[data-toggle="popover"]').popover()
    $('[data-toggle="tooltip"]').tooltip()
   })
</script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

<script>
// https://stackoverflow.com/a/17535094
// The function actually applying the offset
function offsetAnchor() {
  if (location.hash.length !== 0) {
    window.scrollTo(window.scrollX, window.scrollY - window.innerHeight / 8);
  }
}

// Captures click events of all <a> elements with href starting with #
$(document).on('click', 'a[href^="#"]', function(event) {
  // Click events are captured before hashchanges. Timeout
  // causes offsetAnchor to be called after the page jump.
  window.setTimeout(function() {
    offsetAnchor();
  }, 500);
});

// Set the offset when entering page with hash present in the url
window.setTimeout(offsetAnchor, 1500);
</script>

</body>
</html>
