
<!doctype html>
<html lang="en">
<head>

<!-- all praise to https://realfavicongenerator.net -->
<link rel="icon" href="/favicon.ico?v=2" /> <!-- force refresh -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="/fonts.css">
  <link rel="stylesheet" href="../pbrstyle.css">
  <link rel="stylesheet" href="/fontawesome-free-5.15.3-web/css/all.css">

  <script async src="https://cse.google.com/cse.js?cx=003601324460585362024:4xwpwgaitgd"></script>
  <script src="/react.min.js"></script>
  <script src="/react-dom.min.js"></script>
  <script src="/jeri.min.js"></script>
  <link rel="preload" href="/exr.worker.js" as="script" crossorigin="anonymous">
        
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/bootstrap.min.css">

  <title>Dielectric BSDF</title>
</head>
        
<body>

<nav class="fixed-top-lg-navbar navbar navbar-expand bg-light navbar-light">
  <ul class="nav navbar-nav">
    <a class="navbar-brand" href="../contents.html"><img src="../pbr.jpg" width=25 height=25></a>
    <li class="nav-item"><a class="nav-link" href="../Reflection_Models.html">Reflection Models</a></li>
    <span class="navbar-text">/</span>
    <li class="nav-item"><a class="nav-link" href="#">Dielectric BSDF</a></li>
    <span class="navbar-text">&nbsp;&nbsp;</span>
    <li class="nav-item"><a class="nav-link" href="../Reflection_Models/Conductor_BRDF.html">(Previous: Conductor BRDF)</a></li>
  </ul>

  <ul class="nav navbar-nav ml-auto d-none d-md-block">
        <li class="nav-item"><div class="gcse-search"></div></li>
    </ul>
  <ul class="nav navbar-nav d-block d-md-none">
        <li class="nav-item"><div class="gcse-search"></div></li>
    </ul>
</nav>

<div class="maincontainer">
<div class="container-fluid">

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#"><i class="fas fa-link "></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:smooth-dielectrics"></span><h2>9.5 Dielectric BSDF</h2><p>



</p>
<p>In the dielectric case, the relative index of refraction is real-valued, and
specular transmission must be considered in addition to reflection. The
<tt>DielectricBxDF</tt> handles this scenario for smooth and rough
interfaces.

</p>
<p>Figure&nbsp;<a href="#fig:transparent-machines-glass">9.14</a> shows an image of an abstract model
using this <tt>BxDF</tt> to model a glass material.

</p>
<p></p>
<span class="anchor" id="fig:transparent-machines-glass"></span><div class="card outerfigure"><div class="card-body figure"><p>


</p>
<div class="figure-row">
<img src="transparent-machines-glass.png" style="max-width: 100%; height: auto;" width=1920 height=840>
</div>
<p>

</p>
<figcaption class="caption">Figure 9.14: <span class="legend"> When the BRDF for specular reflection
and the BTDF for specular transmission are modulated with the Fresnel
formula for dielectrics, the realistic angle-dependent variation of the
amount of reflection and transmission gives a visually accurate
representation of the glass.
<em>(Scene courtesy of Beeple.)</em>
</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p></p>
<span class="anchor" id="fragment-DielectricBxDFDefinition-0"></span><div class="fragmentname">&lt;&lt;DielectricBxDF Definition&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">class <span class="anchor" id="DielectricBxDF"></span>DielectricBxDF {
  public:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-DielectricBxDFPublicMethods-0">DielectricBxDF Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1261" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1261"><i></i></a><div id="fragbit-1261" class="collapse"><div class="fragmentcode">       DielectricBxDF(Float <a href="#DielectricBxDF::eta" class="code">eta</a>, <a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution" class="code">TrowbridgeReitzDistribution</a> <a href="#DielectricBxDF::mfDistrib" class="code">mfDistrib</a>)
           : <a href="#DielectricBxDF::eta" class="code">eta</a>(<a href="#DielectricBxDF::eta" class="code">eta</a>), <a href="#DielectricBxDF::mfDistrib" class="code">mfDistrib</a>(<a href="#DielectricBxDF::mfDistrib" class="code">mfDistrib</a>) {}
       <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a> Flags() const {
           <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a> flags = (<a href="#DielectricBxDF::eta" class="code">eta</a> == 1) ? <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a>::Transmission :
                             (<a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a>::Reflection | <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a>::Transmission);
           return flags | (<a href="#DielectricBxDF::mfDistrib" class="code">mfDistrib</a>.<a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution::EffectivelySmooth" class="code">EffectivelySmooth</a>() ? <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a>::Specular
                                                         : <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a>::Glossy);
       }
       pstd::optional&lt;<a href="../Reflection_Models/BSDF_Representation.html#BSDFSample" class="code">BSDFSample</a>&gt; Sample_f(<a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wo, Float uc, <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> u,
               TransportMode mode, BxDFReflTransFlags sampleFlags = BxDFReflTransFlags::All) const;
       <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a> f(<a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wo, <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wi, TransportMode mode) const;
       Float PDF(<a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wo, <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wi, TransportMode mode,
                 BxDFReflTransFlags sampleFlags = BxDFReflTransFlags::All) const;
       PBRT_CPU_GPU
       static constexpr const char *Name() { return "DielectricBxDF"; }
       
       std::string ToString() const;
       void <a href="../Light_Transport_I_Surface_Reflection/A_Better_Path_Tracer.html#TrowbridgeReitzDistribution::Regularize" class="code">Regularize</a>() { <a href="#DielectricBxDF::mfDistrib" class="code">mfDistrib</a>.<a href="../Light_Transport_I_Surface_Reflection/A_Better_Path_Tracer.html#TrowbridgeReitzDistribution::Regularize" class="code">Regularize</a>(); }</div></div>
  private:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-DielectricBxDFPrivateMembers-0">DielectricBxDF Private Members</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1262" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1262"><i></i></a><div id="fragbit-1262" class="collapse"><div class="fragmentcode">       Float eta;
       <a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution" class="code">TrowbridgeReitzDistribution</a> mfDistrib;</div></div>
};</div><p>


</p>
<p>The constructor takes a single <tt>Float</tt>-valued <tt>eta</tt> parameter and a
microfacet distribution <tt>mfDistrib</tt>. Spectrally varying IORs that disperse
light into different directions are handled by randomly sampling a single
wavelength to follow and then instantiating a corresponding <tt>DielectricBxDF</tt>.
Section&nbsp;<a href="../Textures_and_Materials/Material_Interface_and_Implementations.html#sec:dielectric-material">10.5.1</a> discusses this topic in more detail.

</p>
<p></p>
<span class="anchor" id="fragment-DielectricBxDFPublicMethods-0"></span><div class="fragmentname">&lt;&lt;DielectricBxDF Public Methods&gt;&gt;=&nbsp;<a href="#fragment-DielectricBxDFPublicMethods-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">DielectricBxDF(Float <a href="#DielectricBxDF::eta" class="code">eta</a>, <a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution" class="code">TrowbridgeReitzDistribution</a> <a href="#DielectricBxDF::mfDistrib" class="code">mfDistrib</a>)
    : <a href="#DielectricBxDF::eta" class="code">eta</a>(<a href="#DielectricBxDF::eta" class="code">eta</a>), <a href="#DielectricBxDF::mfDistrib" class="code">mfDistrib</a>(<a href="#DielectricBxDF::mfDistrib" class="code">mfDistrib</a>) {}</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-DielectricBxDFPrivateMembers-0"></span><div class="fragmentname">&lt;&lt;DielectricBxDF Private Members&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float <span class="anchor" id="DielectricBxDF::eta"></span>eta;
<a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution" class="code">TrowbridgeReitzDistribution</a> <span class="anchor" id="DielectricBxDF::mfDistrib"></span>mfDistrib;</div><p>


</p>
<p>The <tt>Flags()</tt><span class="anchor" id="DielectricBxDF::Flags"></span> method handles three
different cases. The first is when the dielectric interface is
<em>index-matched</em>&mdash;that is, with an equal IOR
on both sides (in which case <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.416ex" height="2.676ex" style="vertical-align: -0.838ex;" viewBox="0 -791.3 2332.1 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">eta equals 1</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D702" d="M496 335c0 -27 -3 -40 -8 -58l-114 -453c-3 -11 -10 -40 -41 -40c-17 0 -28 12 -28 27c0 0 0 4 3 16l114 460c10 40 10 58 10 63c0 36 -11 70 -54 70s-74 -19 -96 -35c-34 -27 -65 -83 -68 -92c-1 -6 -9 -39 -11 -45c-5 -23 -11 -45 -17 -67l-22 -90 c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43l58 231c13 52 16 63 16 84c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c45 0 87 -30 92 -87 c24 35 76 87 155 87c75 0 115 -42 115 -107Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D702" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="775" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1831" y="0"></use>
</g>
</svg>)&mdash;and light
is only transmitted.  Otherwise, in the other two cases, the BSDF has both reflected and
transmitted components.  In both of these cases, the
<a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution"><tt>TrowbridgeReitzDistribution</tt></a>&rsquo;s <tt>EffectivelySmooth()</tt> method
differentiates between specular and glossy scattering.

</p>
<p></p>
<span class="anchor" id="fragment-DielectricBxDFPublicMethods-1"></span><div class="fragmentname">&lt;&lt;DielectricBxDF Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-DielectricBxDFPublicMethods-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="../Light_Transport_I_Surface_Reflection/A_Better_Path_Tracer.html#fragment-DielectricBxDFPublicMethods-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode"><a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a> Flags() const {
    <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a> flags = (<a href="#DielectricBxDF::eta" class="code">eta</a> == 1) ? <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a>::Transmission :
                      (<a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a>::Reflection | <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a>::Transmission);
    return flags | (<a href="#DielectricBxDF::mfDistrib" class="code">mfDistrib</a>.<a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution::EffectivelySmooth" class="code">EffectivelySmooth</a>() ? <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a>::Specular
                                                  : <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a>::Glossy);
}</div><p>


</p>
<p>

</p>
<p>The <tt>Sample_f()</tt> method must choose between sampling perfect specular
reflection or transmission. As before, we postpone handling of rough surfaces and
only discuss the perfect specular case for now.

</p>
<p></p>
<span class="anchor" id="fragment-DielectricBxDFMethodDefinitions-0"></span><div class="fragmentname">&lt;&lt;DielectricBxDF Method Definitions&gt;&gt;=&nbsp;<a href="#fragment-DielectricBxDFMethodDefinitions-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">pstd::optional&lt;<a href="../Reflection_Models/BSDF_Representation.html#BSDFSample" class="code">BSDFSample</a>&gt;
<span class="anchor" id="DielectricBxDF::Sample_f"></span>DielectricBxDF::Sample_f(<a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wo, Float uc, <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> u,
        <a href="#TransportMode" class="code">TransportMode</a> mode, <a href="../Reflection_Models/BSDF_Representation.html#BxDFReflTransFlags" class="code">BxDFReflTransFlags</a> sampleFlags) const {
    if (<a href="#DielectricBxDF::eta" class="code">eta</a> == 1 || <a href="#DielectricBxDF::mfDistrib" class="code">mfDistrib</a>.<a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution::EffectivelySmooth" class="code">EffectivelySmooth</a>()) {
        &lt;&lt;<span class="fragmentname"><a href="#fragment-SampleperfectspeculardielectricBSDF-0">Sample perfect specular dielectric BSDF</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1263" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1263"><i></i></a><div id="fragbit-1263" class="collapse"><div class="fragmentcode">           Float R = <a href="../Reflection_Models/Specular_Reflection_and_Transmission.html#FrDielectric" class="code">FrDielectric</a>(<a href="../Geometry_and_Transformations/Spherical_Geometry.html#CosTheta" class="code">CosTheta</a>(wo), <a href="#DielectricBxDF::eta" class="code">eta</a>), T = 1 - R;
           &lt;&lt;<span class="fragmentname"><a href="#fragment-Computeprobabilitiesmonoprandmonoptforsamplingreflectionandtransmission-0">Compute probabilities <tt>pr</tt> and <tt>pt</tt> for sampling reflection and transmission</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1264" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1264"><i></i></a><div id="fragbit-1264" class="collapse"><div class="fragmentcode">              Float pr = R, pt = T;
              if (!(sampleFlags &amp; <a href="../Reflection_Models/BSDF_Representation.html#BxDFReflTransFlags::Transmission" class="code">BxDFReflTransFlags</a>::Reflection)) pr = 0;
              if (!(sampleFlags &amp; <a href="../Reflection_Models/BSDF_Representation.html#BxDFReflTransFlags::Transmission" class="code">BxDFReflTransFlags</a>::Transmission)) pt = 0;
              if (pr == 0 &amp;&amp; pt == 0)
                  return {};</div></div>
           if (uc &lt; pr / (pr + pt)) {
               &lt;&lt;<span class="fragmentname"><a href="#fragment-SampleperfectspeculardielectricBRDF-0">Sample perfect specular dielectric BRDF</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1265" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1265"><i></i></a><div id="fragbit-1265" class="collapse"><div class="fragmentcode">                  <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wi(-wo.x, -wo.y, wo.z);
                  <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a> fr(R / <a href="../Geometry_and_Transformations/Spherical_Geometry.html#AbsCosTheta" class="code">AbsCosTheta</a>(wi));
                  return <a href="../Reflection_Models/BSDF_Representation.html#BSDFSample" class="code">BSDFSample</a>(fr, wi, pr / (pr + pt), <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a>::SpecularReflection);</div></div>
           } else {
               &lt;&lt;<span class="fragmentname"><a href="#fragment-SampleperfectspeculardielectricBTDF-0">Sample perfect specular dielectric BTDF</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1266" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1266"><i></i></a><div id="fragbit-1266" class="collapse"><div class="fragmentcode">                  &lt;&lt;<span class="fragmentname"><a href="#fragment-Computeraydirectionforspeculartransmission-0">Compute ray direction for specular transmission</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1267" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1267"><i></i></a><div id="fragbit-1267" class="collapse"><div class="fragmentcode">                     <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wi;
                     Float etap;
                     bool valid = <a href="../Reflection_Models/Specular_Reflection_and_Transmission.html#Refract" class="code">Refract</a>(wo, <a href="../Geometry_and_Transformations/Normals.html#Normal3f" class="code">Normal3f</a>(0, 0, 1), eta, &amp;etap, &amp;wi);
                     if (!valid) return {};</div></div>
                  <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a> ft(T / <a href="../Geometry_and_Transformations/Spherical_Geometry.html#AbsCosTheta" class="code">AbsCosTheta</a>(wi));
                  &lt;&lt;<span class="fragmentname"><a href="#fragment-Accountfornon-symmetrywithtransmissiontodifferentmedium-0">Account for non-symmetry with transmission to different medium</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1268" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1268"><i></i></a><div id="fragbit-1268" class="collapse"><div class="fragmentcode">                     if (mode == <a href="#TransportMode::Radiance" class="code">TransportMode</a>::Radiance)
                         ft /= <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(etap);</div></div>
                  return <a href="../Reflection_Models/BSDF_Representation.html#BSDFSample" class="code">BSDFSample</a>(ft, wi, pt / (pr + pt),
                                    <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a>::SpecularTransmission, etap);</div></div>
           }</div></div>
    } else {
        &lt;&lt;<span class="fragmentname"><a href="Rough_Dielectric_BSDF.html#fragment-SampleroughdielectricBSDF-0">Sample rough dielectric BSDF</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1269" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1269"><i></i></a><div id="fragbit-1269" class="collapse"><div class="fragmentcode">           <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wm = <a href="#DielectricBxDF::mfDistrib" class="code">mfDistrib</a>.<a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution::Sample_wm" class="code">Sample_wm</a>(wo, u);
           Float R = <a href="../Reflection_Models/Specular_Reflection_and_Transmission.html#FrDielectric" class="code">FrDielectric</a>(<a href="../Geometry_and_Transformations/Vectors.html#Dot" class="code">Dot</a>(wo, wm), eta);
           Float T = 1 - R;
           &lt;&lt;<span class="fragmentname"><a href="#fragment-Computeprobabilitiesmonoprandmonoptforsamplingreflectionandtransmission-0">Compute probabilities <tt>pr</tt> and <tt>pt</tt> for sampling reflection and transmission</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1270" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1270"><i></i></a><div id="fragbit-1270" class="collapse"><div class="fragmentcode">              Float pr = R, pt = T;
              if (!(sampleFlags &amp; <a href="../Reflection_Models/BSDF_Representation.html#BxDFReflTransFlags::Transmission" class="code">BxDFReflTransFlags</a>::Reflection)) pr = 0;
              if (!(sampleFlags &amp; <a href="../Reflection_Models/BSDF_Representation.html#BxDFReflTransFlags::Transmission" class="code">BxDFReflTransFlags</a>::Transmission)) pt = 0;
              if (pr == 0 &amp;&amp; pt == 0)
                  return {};</div></div>
           Float pdf;
           if (uc &lt; pr / (pr + pt)) {
               &lt;&lt;<span class="fragmentname"><a href="Rough_Dielectric_BSDF.html#fragment-Samplereflectionatroughdielectricinterface-0">Sample reflection at rough dielectric interface</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1271" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1271"><i></i></a><div id="fragbit-1271" class="collapse"><div class="fragmentcode">                  <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wi = <a href="../Reflection_Models/Specular_Reflection_and_Transmission.html#Reflect" class="code">Reflect</a>(wo, wm);
                  if (!<a href="../Reflection_Models/BSDF_Representation.html#SameHemisphere" class="code">SameHemisphere</a>(wo, wi)) return {};
                  &lt;&lt;<span class="fragmentname"><a href="Rough_Dielectric_BSDF.html#fragment-ComputePDFofroughdielectricreflection-0">Compute PDF of rough dielectric reflection</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1272" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1272"><i></i></a><div id="fragbit-1272" class="collapse"><div class="fragmentcode">                     pdf = <a href="#DielectricBxDF::mfDistrib" class="code">mfDistrib</a>.<a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution::PDF" class="code">PDF</a>(wo, wm) / (4 * <a href="../Geometry_and_Transformations/Vectors.html#AbsDot" class="code">AbsDot</a>(wo, wm)) * pr / (pr + pt);</div></div>
                  <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a> f(<a href="#DielectricBxDF::mfDistrib" class="code">mfDistrib</a>.<a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution::D" class="code">D</a>(wm) * <a href="#DielectricBxDF::mfDistrib" class="code">mfDistrib</a>.<a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution::D" class="code">G</a>(wo, wi) * R /
                                    (4 * <a href="../Geometry_and_Transformations/Spherical_Geometry.html#CosTheta" class="code">CosTheta</a>(wi) * <a href="../Geometry_and_Transformations/Spherical_Geometry.html#CosTheta" class="code">CosTheta</a>(wo)));
                  return <a href="../Reflection_Models/BSDF_Representation.html#BSDFSample" class="code">BSDFSample</a>(f, wi, pdf, <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a>::GlossyReflection);</div></div>
           } else {
               &lt;&lt;<span class="fragmentname"><a href="Rough_Dielectric_BSDF.html#fragment-Sampletransmissionatroughdielectricinterface-0">Sample transmission at rough dielectric interface</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1273" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1273"><i></i></a><div id="fragbit-1273" class="collapse"><div class="fragmentcode">                  Float etap;
                  <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wi;
                  bool tir = !<a href="../Reflection_Models/Specular_Reflection_and_Transmission.html#Refract" class="code">Refract</a>(wo, (<a href="../Geometry_and_Transformations/Normals.html#Normal3f" class="code">Normal3f</a>)wm, eta, &amp;etap, &amp;wi);
                  if (<a href="../Reflection_Models/BSDF_Representation.html#SameHemisphere" class="code">SameHemisphere</a>(wo, wi) || wi.z == 0 || tir)
                      return {};
                  &lt;&lt;<span class="fragmentname"><a href="Rough_Dielectric_BSDF.html#fragment-ComputePDFofroughdielectrictransmission-0">Compute PDF of rough dielectric transmission</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1274" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1274"><i></i></a><div id="fragbit-1274" class="collapse"><div class="fragmentcode">                     Float denom = <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(<a href="../Geometry_and_Transformations/Vectors.html#Dot" class="code">Dot</a>(wi, wm) + <a href="../Geometry_and_Transformations/Vectors.html#Dot" class="code">Dot</a>(wo, wm) / etap);
                     Float dwm_dwi = <a href="../Geometry_and_Transformations/Vectors.html#AbsDot" class="code">AbsDot</a>(wi, wm) / denom;
                     pdf = <a href="#DielectricBxDF::mfDistrib" class="code">mfDistrib</a>.<a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution::PDF" class="code">PDF</a>(wo, wm) * dwm_dwi * pt / (pr + pt);</div></div>
                  &lt;&lt;<span class="fragmentname"><a href="Rough_Dielectric_BSDF.html#fragment-EvaluateBRDFandreturnmonoBSDFSampleforroughtransmission-0">Evaluate BRDF and return <tt>BSDFSample</tt> for rough transmission</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1275" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1275"><i></i></a><div id="fragbit-1275" class="collapse"><div class="fragmentcode">                     <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a> ft(T * <a href="#DielectricBxDF::mfDistrib" class="code">mfDistrib</a>.<a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution::D" class="code">D</a>(wm) * <a href="#DielectricBxDF::mfDistrib" class="code">mfDistrib</a>.<a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution::G" class="code">G</a>(wo, wi) *
                         std::abs(<a href="../Geometry_and_Transformations/Vectors.html#Dot" class="code">Dot</a>(wi, wm) * <a href="../Geometry_and_Transformations/Vectors.html#Dot" class="code">Dot</a>(wo, wm) /
                         (<a href="../Geometry_and_Transformations/Spherical_Geometry.html#CosTheta" class="code">CosTheta</a>(wi) * <a href="../Geometry_and_Transformations/Spherical_Geometry.html#CosTheta" class="code">CosTheta</a>(wo) * denom)));
                     &lt;&lt;<span class="fragmentname"><a href="#fragment-Accountfornon-symmetrywithtransmissiontodifferentmedium-0">Account for non-symmetry with transmission to different medium</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1276" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1276"><i></i></a><div id="fragbit-1276" class="collapse"><div class="fragmentcode">                        if (mode == <a href="#TransportMode::Radiance" class="code">TransportMode</a>::Radiance)
                            ft /= <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(etap);</div></div>
                     return <a href="../Reflection_Models/BSDF_Representation.html#BSDFSample" class="code">BSDFSample</a>(ft, wi, pdf, <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a>::GlossyTransmission, etap);</div></div></div></div>
           }</div></div>
    }
}</div><p>


</p>
<p></p>
<span class="anchor" id="fig:dielectric-scatter-by-fresnel"></span><div class="card outerfigure"><div class="card-body figure"><p>


</p>

<div class="card-img-top" style="display:block; width: 100%; padding-top: 48.710%;  position:relative;">
<div id="xa_Equal_probability28" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0;"></div></div>
<script>
Jeri.renderViewer(document.getElementById('xa_Equal_probability28'), {
  title: '(a)_Equal_probability28', children: [
 { title: '(a) Equal probability', image: 'transparent-machines-fresnel-sample-bad.exr' },  { title: '(b) Sampling using Fresnel', image: 'transparent-machines-fresnel-sample-good.exr' }]});
</script>
<button data-toggle="tooltip" data-placement="left" class="btn yojeri" title="This image is interactive. Click and drag to pan and use the mouse-wheel to zoom. After clicking on the image to select it, type '?' to see a summary of keyboard controls."><i class="fa fa-snowflake fa-border"></i></button><p>

</p>
<figcaption class="caption">Figure 9.15: Glass Object Rendered Using the <a href="#DielectricBxDF"><tt>DielectricBxDF</tt></a>. <span class="legend">
(a)&nbsp;Choosing between specular reflection and
transmission with equal probability at each scattering event.
(b)&nbsp;Choosing with probability based on the value of the Fresnel equations,
as is implemented in the <tt>Sample_f()</tt> method.
Choosing between scattering modes with probability proportional to their
contribution significantly reduces error by following fewer paths with low
contributions.</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>Since dielectrics are characterized by both reflection and transmission,
the sampling scheme must randomly choose between these two components,
which influences the density function. While any discrete distribution is
in principle admissible, an efficient approach from a Monte Carlo
variance standpoint is to sample according to the contribution that these
two components make&mdash;in other words, proportional to the Fresnel
reflectance <tt>R</tt> and the complementary transmittance <tt>1-R</tt>.
Figure&nbsp;<a href="#fig:dielectric-scatter-by-fresnel">9.15</a> shows the benefit of
sampling in this way compared to an equal split between reflection and
transmission.

</p>
<p></p>
<span class="anchor" id="fragment-SampleperfectspeculardielectricBSDF-0"></span><div class="fragmentname">&lt;&lt;Sample perfect specular dielectric BSDF&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float R = <a href="../Reflection_Models/Specular_Reflection_and_Transmission.html#FrDielectric" class="code">FrDielectric</a>(<a href="../Geometry_and_Transformations/Spherical_Geometry.html#CosTheta" class="code">CosTheta</a>(wo), <a href="#DielectricBxDF::eta" class="code">eta</a>), T = 1 - R;
&lt;&lt;<span class="fragmentname"><a href="#fragment-Computeprobabilitiesmonoprandmonoptforsamplingreflectionandtransmission-0">Compute probabilities <tt>pr</tt> and <tt>pt</tt> for sampling reflection and transmission</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1277" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1277"><i></i></a><div id="fragbit-1277" class="collapse"><div class="fragmentcode">   Float pr = R, pt = T;
   if (!(sampleFlags &amp; <a href="../Reflection_Models/BSDF_Representation.html#BxDFReflTransFlags::Transmission" class="code">BxDFReflTransFlags</a>::Reflection)) pr = 0;
   if (!(sampleFlags &amp; <a href="../Reflection_Models/BSDF_Representation.html#BxDFReflTransFlags::Transmission" class="code">BxDFReflTransFlags</a>::Transmission)) pt = 0;
   if (pr == 0 &amp;&amp; pt == 0)
       return {};</div></div>
if (uc &lt; pr / (pr + pt)) {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-SampleperfectspeculardielectricBRDF-0">Sample perfect specular dielectric BRDF</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1278" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1278"><i></i></a><div id="fragbit-1278" class="collapse"><div class="fragmentcode">       <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wi(-wo.x, -wo.y, wo.z);
       <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a> fr(R / <a href="../Geometry_and_Transformations/Spherical_Geometry.html#AbsCosTheta" class="code">AbsCosTheta</a>(wi));
       return <a href="../Reflection_Models/BSDF_Representation.html#BSDFSample" class="code">BSDFSample</a>(fr, wi, pr / (pr + pt), <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a>::SpecularReflection);</div></div>
} else {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-SampleperfectspeculardielectricBTDF-0">Sample perfect specular dielectric BTDF</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1279" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1279"><i></i></a><div id="fragbit-1279" class="collapse"><div class="fragmentcode">       &lt;&lt;<span class="fragmentname"><a href="#fragment-Computeraydirectionforspeculartransmission-0">Compute ray direction for specular transmission</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1280" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1280"><i></i></a><div id="fragbit-1280" class="collapse"><div class="fragmentcode">          <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wi;
          Float etap;
          bool valid = <a href="../Reflection_Models/Specular_Reflection_and_Transmission.html#Refract" class="code">Refract</a>(wo, <a href="../Geometry_and_Transformations/Normals.html#Normal3f" class="code">Normal3f</a>(0, 0, 1), eta, &amp;etap, &amp;wi);
          if (!valid) return {};</div></div>
       <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a> ft(T / <a href="../Geometry_and_Transformations/Spherical_Geometry.html#AbsCosTheta" class="code">AbsCosTheta</a>(wi));
       &lt;&lt;<span class="fragmentname"><a href="#fragment-Accountfornon-symmetrywithtransmissiontodifferentmedium-0">Account for non-symmetry with transmission to different medium</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1281" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1281"><i></i></a><div id="fragbit-1281" class="collapse"><div class="fragmentcode">          if (mode == <a href="#TransportMode::Radiance" class="code">TransportMode</a>::Radiance)
              ft /= <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(etap);</div></div>
       return <a href="../Reflection_Models/BSDF_Representation.html#BSDFSample" class="code">BSDFSample</a>(ft, wi, pt / (pr + pt),
                         <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a>::SpecularTransmission, etap);</div></div>
}</div><p>


</p>
<p>Because BSDF components can be selectively enabled or disabled via the
<tt>sampleFlags</tt> argument, the component choice is based on adjusted
probabilities <tt>pr</tt> and <tt>pt</tt> that take this into account.

</p>
<p></p>
<span class="anchor" id="fragment-Computeprobabilitiesmonoprandmonoptforsamplingreflectionandtransmission-0"></span><div class="fragmentname">&lt;&lt;Compute probabilities <tt>pr</tt> and <tt>pt</tt> for sampling reflection and transmission&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float pr = R, pt = T;
if (!(sampleFlags &amp; <a href="../Reflection_Models/BSDF_Representation.html#BxDFReflTransFlags::Transmission" class="code">BxDFReflTransFlags</a>::Reflection)) pr = 0;
if (!(sampleFlags &amp; <a href="../Reflection_Models/BSDF_Representation.html#BxDFReflTransFlags::Transmission" class="code">BxDFReflTransFlags</a>::Transmission)) pt = 0;
if (pr == 0 &amp;&amp; pt == 0)
    return {};</div><p>


</p>
<p>In the most common case where both reflection and transmission are sampled,
the BSDF value and sample probability contain the common factor <tt>F</tt> or
<tt>T</tt>, which cancels when their ratio is taken.  Thus, all sampled rays
end up making the same contribution, and the Fresnel factor manifests in
the relative proportion of reflected and transmitted rays.

</p>
<p>Putting all of this together, the only change in the following code
compared to the analogous fragment &lt;&lt;<span class="fragmentname"><a href="Conductor_BRDF.html#fragment-SampleperfectspecularconductorBRDF-0">Sample perfect specular
conductor BRDF</a></span>&gt;&gt; is the incorporation of the discrete probability of the
sample.

</p>
<p></p>
<span class="anchor" id="fragment-SampleperfectspeculardielectricBRDF-0"></span><div class="fragmentname">&lt;&lt;Sample perfect specular dielectric BRDF&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wi(-wo.x, -wo.y, wo.z);
<a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a> fr(R / <a href="../Geometry_and_Transformations/Spherical_Geometry.html#AbsCosTheta" class="code">AbsCosTheta</a>(wi));
return <a href="../Reflection_Models/BSDF_Representation.html#BSDFSample" class="code">BSDFSample</a>(fr, wi, pr / (pr + pt), <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a>::SpecularReflection);</div><p>


</p>
<p>Specular transmission is handled along similar lines, though using the
refracted ray direction for <tt>wi</tt>.  The equation for the corresponding BTDF
is similar to the case for perfect specular reflection,
Equation&nbsp;(<a href="../Reflection_Models/Conductor_BRDF.html#eq:fresnel-perfect-specular">9.9</a>), though there is an additional
subtle technical detail: depending on the IOR <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.155ex" height="2.176ex" style="vertical-align: -0.838ex;" viewBox="0 -576.1 497.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">eta</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D702" d="M496 335c0 -27 -3 -40 -8 -58l-114 -453c-3 -11 -10 -40 -41 -40c-17 0 -28 12 -28 27c0 0 0 4 3 16l114 460c10 40 10 58 10 63c0 36 -11 70 -54 70s-74 -19 -96 -35c-34 -27 -65 -83 -68 -92c-1 -6 -9 -39 -11 -45c-5 -23 -11 -45 -17 -67l-22 -90 c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43l58 231c13 52 16 63 16 84c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c45 0 87 -30 92 -87 c24 35 76 87 155 87c75 0 115 -42 115 -107Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D702" x="0" y="0"></use>
</g>
</svg>, refraction either compresses or expands
radiance in the angular domain, and the implementation must scale <tt>ft</tt> to
account for this. This correction does not change the amount of
radiant power in the scene&mdash;rather, it models how the same power is contained
in a different solid angle. The details of this step differ depending on the
direction of propagation in bidirectional rendering algorithms, and we
therefore defer the corresponding fragment &lt;&lt;<span class="fragmentname"><a href="#fragment-Accountfornon-symmetrywithtransmissiontodifferentmedium-0">Account for non-symmetry with
transmission to different medium</a></span>&gt;&gt; to Section&nbsp;<a href="#sec:non-symmetric">9.5.2</a>.

</p>
<p></p>
<span class="anchor" id="fragment-SampleperfectspeculardielectricBTDF-0"></span><div class="fragmentname">&lt;&lt;Sample perfect specular dielectric BTDF&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">&lt;&lt;<span class="fragmentname"><a href="#fragment-Computeraydirectionforspeculartransmission-0">Compute ray direction for specular transmission</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1282" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1282"><i></i></a><div id="fragbit-1282" class="collapse"><div class="fragmentcode">   <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wi;
   Float etap;
   bool valid = <a href="../Reflection_Models/Specular_Reflection_and_Transmission.html#Refract" class="code">Refract</a>(wo, <a href="../Geometry_and_Transformations/Normals.html#Normal3f" class="code">Normal3f</a>(0, 0, 1), eta, &amp;etap, &amp;wi);
   if (!valid) return {};</div></div>
<a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a> ft(T / <a href="../Geometry_and_Transformations/Spherical_Geometry.html#AbsCosTheta" class="code">AbsCosTheta</a>(wi));
&lt;&lt;<span class="fragmentname"><a href="#fragment-Accountfornon-symmetrywithtransmissiontodifferentmedium-0">Account for non-symmetry with transmission to different medium</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1283" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1283"><i></i></a><div id="fragbit-1283" class="collapse"><div class="fragmentcode">   if (mode == <a href="#TransportMode::Radiance" class="code">TransportMode</a>::Radiance)
       ft /= <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(etap);</div></div>
return <a href="../Reflection_Models/BSDF_Representation.html#BSDFSample" class="code">BSDFSample</a>(ft, wi, pt / (pr + pt),
                  <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a>::SpecularTransmission, etap);</div><p>


</p>
<p>The function <a href="../Reflection_Models/Specular_Reflection_and_Transmission.html#Refract"><tt>Refract()</tt></a> computes the refracted direction <tt>wi</tt> via
Snell&rsquo;s law, which fails in the case of total internal reflection. In
principle, this should never happen: the transmission case is sampled with
probability <tt>T</tt>, which is zero in the case of total internal reflection.
However, due to floating-point rounding errors, inconsistencies can
occasionally arise here. We handle this corner case by returning an invalid
sample.

</p>
<p></p>
<span class="anchor" id="fragment-Computeraydirectionforspeculartransmission-0"></span><div class="fragmentname">&lt;&lt;Compute ray direction for specular transmission&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wi;
Float etap;
bool valid = <a href="../Reflection_Models/Specular_Reflection_and_Transmission.html#Refract" class="code">Refract</a>(wo, <a href="../Geometry_and_Transformations/Normals.html#Normal3f" class="code">Normal3f</a>(0, 0, 1), eta, &amp;etap, &amp;wi);
if (!valid) return {};</div><p>


</p>
<p>

</p>
<p>As with the <a href="../Reflection_Models/Conductor_BRDF.html#ConductorBxDF"><tt>ConductorBxDF</tt></a>, zero is returned from the <tt>f()</tt>
method if the interface is smooth and all scattering is perfect specular.

</p>
<p></p>
<span class="anchor" id="fragment-DielectricBxDFMethodDefinitions-1"></span><div class="fragmentname">&lt;&lt;DielectricBxDF Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-DielectricBxDFMethodDefinitions-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-DielectricBxDFMethodDefinitions-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode"><a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a> <span class="anchor" id="DielectricBxDF::f"></span>DielectricBxDF::f(<a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wo, <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wi,
                                  <a href="#TransportMode" class="code">TransportMode</a> mode) const {
    if (<a href="#DielectricBxDF::eta" class="code">eta</a> == 1 || <a href="#DielectricBxDF::mfDistrib" class="code">mfDistrib</a>.<a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution::EffectivelySmooth" class="code">EffectivelySmooth</a>())
        return <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a>(0.f);
    &lt;&lt;<span class="fragmentname"><a href="Rough_Dielectric_BSDF.html#fragment-EvaluateroughdielectricBSDF-0">Evaluate rough dielectric BSDF</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1284" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1284"><i></i></a><div id="fragbit-1284" class="collapse"><div class="fragmentcode">       &lt;&lt;<span class="fragmentname"><a href="Rough_Dielectric_BSDF.html#fragment-Computegeneralizedhalfvectormonowm-0">Compute generalized half vector <tt>wm</tt></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1285" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1285"><i></i></a><div id="fragbit-1285" class="collapse"><div class="fragmentcode">          Float cosTheta_o = <a href="../Geometry_and_Transformations/Spherical_Geometry.html#CosTheta" class="code">CosTheta</a>(wo), cosTheta_i = <a href="../Geometry_and_Transformations/Spherical_Geometry.html#CosTheta" class="code">CosTheta</a>(wi);
          bool reflect = cosTheta_i * cosTheta_o &gt; 0;
          float etap = 1;
          if (!reflect)
              etap = cosTheta_o &gt; 0 ? <a href="#DielectricBxDF::eta" class="code">eta</a> : (1 / <a href="#DielectricBxDF::eta" class="code">eta</a>);
          <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wm = wi * etap + wo;
          if (cosTheta_i == 0 || cosTheta_o == 0 || <a href="../Geometry_and_Transformations/Vectors.html#LengthSquared" class="code">LengthSquared</a>(wm) == 0) return {};
          wm = <a href="../Geometry_and_Transformations/Normals.html#FaceForward" class="code">FaceForward</a>(<a href="../Geometry_and_Transformations/Vectors.html#Normalize" class="code">Normalize</a>(wm), <a href="../Geometry_and_Transformations/Normals.html#Normal3f" class="code">Normal3f</a>(0, 0, 1));</div></div>
       &lt;&lt;<span class="fragmentname"><a href="Rough_Dielectric_BSDF.html#fragment-Discardbackfacingmicrofacets-0">Discard backfacing microfacets</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1286" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1286"><i></i></a><div id="fragbit-1286" class="collapse"><div class="fragmentcode">          if (<a href="../Geometry_and_Transformations/Vectors.html#Dot" class="code">Dot</a>(wm, wi) * cosTheta_i &lt; 0 || <a href="../Geometry_and_Transformations/Vectors.html#Dot" class="code">Dot</a>(wm, wo) * cosTheta_o &lt; 0)
              return {};</div></div>
       Float F = <a href="../Reflection_Models/Specular_Reflection_and_Transmission.html#FrDielectric" class="code">FrDielectric</a>(<a href="../Geometry_and_Transformations/Vectors.html#Dot" class="code">Dot</a>(wo, wm), <a href="#DielectricBxDF::eta" class="code">eta</a>);
       if (reflect) {
           &lt;&lt;<span class="fragmentname"><a href="Rough_Dielectric_BSDF.html#fragment-Computereflectionatroughdielectricinterface-0">Compute reflection at rough dielectric interface</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1287" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1287"><i></i></a><div id="fragbit-1287" class="collapse"><div class="fragmentcode">              return <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a>(<a href="#DielectricBxDF::mfDistrib" class="code">mfDistrib</a>.<a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution::D" class="code">D</a>(wm) * <a href="#DielectricBxDF::mfDistrib" class="code">mfDistrib</a>.<a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution::G" class="code">G</a>(wo, wi) * F /
                                     std::abs(4 * cosTheta_i * cosTheta_o));</div></div>
       } else {
           &lt;&lt;<span class="fragmentname"><a href="Rough_Dielectric_BSDF.html#fragment-Computetransmissionatroughdielectricinterface-0">Compute transmission at rough dielectric interface</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1288" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1288"><i></i></a><div id="fragbit-1288" class="collapse"><div class="fragmentcode">              Float denom = <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(<a href="../Geometry_and_Transformations/Vectors.html#Dot" class="code">Dot</a>(wi, wm) + <a href="../Geometry_and_Transformations/Vectors.html#Dot" class="code">Dot</a>(wo, wm)/etap) * cosTheta_i * cosTheta_o;
              Float ft = <a href="#DielectricBxDF::mfDistrib" class="code">mfDistrib</a>.<a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution::D" class="code">D</a>(wm) * (1 - F) * <a href="#DielectricBxDF::mfDistrib" class="code">mfDistrib</a>.<a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution::G" class="code">G</a>(wo, wi) *
                         std::abs(<a href="../Geometry_and_Transformations/Vectors.html#Dot" class="code">Dot</a>(wi, wm) * <a href="../Geometry_and_Transformations/Vectors.html#Dot" class="code">Dot</a>(wo, wm) / denom);
              &lt;&lt;<span class="fragmentname"><a href="#fragment-Accountfornon-symmetrywithtransmissiontodifferentmedium-0">Account for non-symmetry with transmission to different medium</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1289" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1289"><i></i></a><div id="fragbit-1289" class="collapse"><div class="fragmentcode">                 if (mode == <a href="#TransportMode::Radiance" class="code">TransportMode</a>::Radiance)
                     ft /= <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(etap);</div></div>
              return <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a>(ft);</div></div>
       }</div></div>
}</div><p>


</p>
<p>

</p>
<p>Also, a PDF value of zero is returned if the BSDF is represented using delta
distributions.

</p>
<p></p>
<span class="anchor" id="fragment-DielectricBxDFMethodDefinitions-2"></span><div class="fragmentname">&lt;&lt;DielectricBxDF Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-DielectricBxDFMethodDefinitions-1"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">Float <span class="anchor" id="DielectricBxDF::PDF"></span>DielectricBxDF::PDF(<a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wo, <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wi, <a href="#TransportMode" class="code">TransportMode</a> mode,
          <a href="../Reflection_Models/BSDF_Representation.html#BxDFReflTransFlags" class="code">BxDFReflTransFlags</a> sampleFlags) const {
    if (<a href="#DielectricBxDF::eta" class="code">eta</a> == 1 || <a href="#DielectricBxDF::mfDistrib" class="code">mfDistrib</a>.<a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution::EffectivelySmooth" class="code">EffectivelySmooth</a>())
        return 0;
    &lt;&lt;<span class="fragmentname"><a href="Rough_Dielectric_BSDF.html#fragment-EvaluatesamplingPDFofroughdielectricBSDF-0">Evaluate sampling PDF of rough dielectric BSDF</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1290" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1290"><i></i></a><div id="fragbit-1290" class="collapse"><div class="fragmentcode">       &lt;&lt;<span class="fragmentname"><a href="Rough_Dielectric_BSDF.html#fragment-Computegeneralizedhalfvectormonowm-0">Compute generalized half vector <tt>wm</tt></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1291" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1291"><i></i></a><div id="fragbit-1291" class="collapse"><div class="fragmentcode">          Float cosTheta_o = <a href="../Geometry_and_Transformations/Spherical_Geometry.html#CosTheta" class="code">CosTheta</a>(wo), cosTheta_i = <a href="../Geometry_and_Transformations/Spherical_Geometry.html#CosTheta" class="code">CosTheta</a>(wi);
          bool reflect = cosTheta_i * cosTheta_o &gt; 0;
          float etap = 1;
          if (!reflect)
              etap = cosTheta_o &gt; 0 ? <a href="#DielectricBxDF::eta" class="code">eta</a> : (1 / <a href="#DielectricBxDF::eta" class="code">eta</a>);
          <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wm = wi * etap + wo;
          if (cosTheta_i == 0 || cosTheta_o == 0 || <a href="../Geometry_and_Transformations/Vectors.html#LengthSquared" class="code">LengthSquared</a>(wm) == 0) return {};
          wm = <a href="../Geometry_and_Transformations/Normals.html#FaceForward" class="code">FaceForward</a>(<a href="../Geometry_and_Transformations/Vectors.html#Normalize" class="code">Normalize</a>(wm), <a href="../Geometry_and_Transformations/Normals.html#Normal3f" class="code">Normal3f</a>(0, 0, 1));</div></div>
       &lt;&lt;<span class="fragmentname"><a href="Rough_Dielectric_BSDF.html#fragment-Discardbackfacingmicrofacets-0">Discard backfacing microfacets</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1292" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1292"><i></i></a><div id="fragbit-1292" class="collapse"><div class="fragmentcode">          if (<a href="../Geometry_and_Transformations/Vectors.html#Dot" class="code">Dot</a>(wm, wi) * cosTheta_i &lt; 0 || <a href="../Geometry_and_Transformations/Vectors.html#Dot" class="code">Dot</a>(wm, wo) * cosTheta_o &lt; 0)
              return {};</div></div>
       &lt;&lt;<span class="fragmentname"><a href="Rough_Dielectric_BSDF.html#fragment-DetermineFresnelreflectanceofroughdielectricboundary-0">Determine Fresnel reflectance of rough dielectric boundary</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1293" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1293"><i></i></a><div id="fragbit-1293" class="collapse"><div class="fragmentcode">          Float R = <a href="../Reflection_Models/Specular_Reflection_and_Transmission.html#FrDielectric" class="code">FrDielectric</a>(<a href="../Geometry_and_Transformations/Vectors.html#Dot" class="code">Dot</a>(wo, wm), eta);
          Float T = 1 - R;</div></div>
       &lt;&lt;<span class="fragmentname"><a href="#fragment-Computeprobabilitiesmonoprandmonoptforsamplingreflectionandtransmission-0">Compute probabilities <tt>pr</tt> and <tt>pt</tt> for sampling reflection and transmission</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1294" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1294"><i></i></a><div id="fragbit-1294" class="collapse"><div class="fragmentcode">          Float pr = R, pt = T;
          if (!(sampleFlags &amp; <a href="../Reflection_Models/BSDF_Representation.html#BxDFReflTransFlags::Transmission" class="code">BxDFReflTransFlags</a>::Reflection)) pr = 0;
          if (!(sampleFlags &amp; <a href="../Reflection_Models/BSDF_Representation.html#BxDFReflTransFlags::Transmission" class="code">BxDFReflTransFlags</a>::Transmission)) pt = 0;
          if (pr == 0 &amp;&amp; pt == 0)
              return {};</div></div>
       &lt;&lt;<span class="fragmentname"><a href="Rough_Dielectric_BSDF.html#fragment-ReturnPDFforroughdielectric-0">Return PDF for rough dielectric</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1295" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1295"><i></i></a><div id="fragbit-1295" class="collapse"><div class="fragmentcode">          Float pdf;
          if (reflect) {
              &lt;&lt;<span class="fragmentname"><a href="Rough_Dielectric_BSDF.html#fragment-ComputePDFofroughdielectricreflection-0">Compute PDF of rough dielectric reflection</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1296" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1296"><i></i></a><div id="fragbit-1296" class="collapse"><div class="fragmentcode">                 pdf = <a href="#DielectricBxDF::mfDistrib" class="code">mfDistrib</a>.<a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution::PDF" class="code">PDF</a>(wo, wm) / (4 * <a href="../Geometry_and_Transformations/Vectors.html#AbsDot" class="code">AbsDot</a>(wo, wm)) * pr / (pr + pt);</div></div>
          } else {
              &lt;&lt;<span class="fragmentname"><a href="Rough_Dielectric_BSDF.html#fragment-ComputePDFofroughdielectrictransmission-0">Compute PDF of rough dielectric transmission</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1297" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1297"><i></i></a><div id="fragbit-1297" class="collapse"><div class="fragmentcode">                 Float denom = <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(<a href="../Geometry_and_Transformations/Vectors.html#Dot" class="code">Dot</a>(wi, wm) + <a href="../Geometry_and_Transformations/Vectors.html#Dot" class="code">Dot</a>(wo, wm) / etap);
                 Float dwm_dwi = <a href="../Geometry_and_Transformations/Vectors.html#AbsDot" class="code">AbsDot</a>(wi, wm) / denom;
                 pdf = <a href="#DielectricBxDF::mfDistrib" class="code">mfDistrib</a>.<a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html#TrowbridgeReitzDistribution::PDF" class="code">PDF</a>(wo, wm) * dwm_dwi * pt / (pr + pt);</div></div>
          }
          return pdf;</div></div></div></div>
}</div><p>


</p>
<p>The missing three fragments&mdash;&lt;&lt;<span class="fragmentname"><a href="Rough_Dielectric_BSDF.html#fragment-SampleroughdielectricBSDF-0">Sample rough dielectric BSDF</a></span>&gt;&gt;,
&lt;&lt;<span class="fragmentname"><a href="Rough_Dielectric_BSDF.html#fragment-EvaluateroughdielectricBSDF-0">Evaluate rough dielectric BSDF</a></span>&gt;&gt;, and &lt;&lt;<span class="fragmentname"><a href="Rough_Dielectric_BSDF.html#fragment-EvaluatesamplingPDFofroughdielectricBSDF-0">Evaluate sampling PDF
of rough dielectric BSDF</a></span>&gt;&gt;&mdash;will be presented in
Section&nbsp;<a href="../Reflection_Models/Rough_Dielectric_BSDF.html#sec:rough-dielectric">9.7</a>.

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#ThinDielectricBSDF"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:thin-dielectric-bxdf"></span><span id="ThinDielectricBSDF"></span><h3>9.5.1  Thin Dielectric BSDF</h3><p>



</p>
<p>Dielectric interfaces rarely occur in isolation: a particularly common
configuration involves two nearby index of refraction changes that are smooth,
locally parallel, and mutually reciprocal&mdash;that is, with relative IOR <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.155ex" height="2.176ex" style="vertical-align: -0.838ex;" viewBox="0 -576.1 497.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">eta</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D702" d="M496 335c0 -27 -3 -40 -8 -58l-114 -453c-3 -11 -10 -40 -41 -40c-17 0 -28 12 -28 27c0 0 0 4 3 16l114 460c10 40 10 58 10 63c0 36 -11 70 -54 70s-74 -19 -96 -35c-34 -27 -65 -83 -68 -92c-1 -6 -9 -39 -11 -45c-5 -23 -11 -45 -17 -67l-22 -90 c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43l58 231c13 52 16 63 16 84c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c45 0 87 -30 92 -87 c24 35 76 87 155 87c75 0 115 -42 115 -107Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D702" x="0" y="0"></use>
</g>
</svg> and a
corresponding interface with the inverse <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.48ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 1498.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">1 slash eta</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D702" d="M496 335c0 -27 -3 -40 -8 -58l-114 -453c-3 -11 -10 -40 -41 -40c-17 0 -28 12 -28 27c0 0 0 4 3 16l114 460c10 40 10 58 10 63c0 36 -11 70 -54 70s-74 -19 -96 -35c-34 -27 -65 -83 -68 -92c-1 -6 -9 -39 -11 -45c-5 -23 -11 -45 -17 -67l-22 -90 c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43l58 231c13 52 16 63 16 84c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c45 0 87 -30 92 -87 c24 35 76 87 155 87c75 0 115 -42 115 -107Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D702" x="1001" y="0"></use>
</g>
</svg>. Examples include plate- and
acrylic glass in windows or plastic foil used to seal and preserve food.

</p>
<p>This important special case is referred to as a <em>thin dielectric</em> due
to the spatial proximity of the two interfaces compared to the larger
lateral dimensions.  When incident light splits into a reflected and a
transmitted component with two separate interfaces, it is scattered in a
recursive process that traps some of the light within the two interfaces
(though this amount progressively decays as it undergoes an increasing
number of reflections).

</p>
<p>While the internal scattering process within a general dielectric may be
daunting, simple analytic solutions can fully describe what happens inside
such a thin dielectric&mdash;that is, an interface pair satisfying the above
simplifying conditions. <tt>pbrt</tt> provides a specialized BSDF named
<tt>ThinDielectricBxDF</tt> that exploits these insights to efficiently
represent an infinite number of internal interactions.  It further allows
such surfaces to be represented with a single interface, saving the ray
intersection expense of tracing ray paths between the two surfaces.

</p>
<p></p>
<span class="anchor" id="fragment-ThinDielectricBxDFDefinition-0"></span><div class="fragmentname">&lt;&lt;ThinDielectricBxDF Definition&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">class <span class="anchor" id="ThinDielectricBxDF"></span>ThinDielectricBxDF {
  public:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ThinDielectricBxDFPublicMethods-0">ThinDielectricBxDF Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1298" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1298"><i></i></a><div id="fragbit-1298" class="collapse"><div class="fragmentcode">       ThinDielectricBxDF(Float eta) : eta(eta) {}
       <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a> f(<a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wo, <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wi, <a href="#TransportMode" class="code">TransportMode</a> mode) const {
           return <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a>(0);
       }
       pstd::optional&lt;<a href="../Reflection_Models/BSDF_Representation.html#BSDFSample" class="code">BSDFSample</a>&gt;
       Sample_f(<a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wo, Float uc, <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> u, <a href="#TransportMode" class="code">TransportMode</a> mode,
                <a href="../Reflection_Models/BSDF_Representation.html#BxDFReflTransFlags" class="code">BxDFReflTransFlags</a> sampleFlags) const {
           Float R = <a href="../Reflection_Models/Specular_Reflection_and_Transmission.html#FrDielectric" class="code">FrDielectric</a>(<a href="../Geometry_and_Transformations/Spherical_Geometry.html#AbsCosTheta" class="code">AbsCosTheta</a>(wo), eta), T = 1 - R;
           &lt;&lt;<span class="fragmentname"><a href="#fragment-ComputemonoRandmonoTaccountingforscatteringbetweeninterfaces-0">Compute <tt>R</tt> and <tt>T</tt> accounting for scattering between interfaces</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1299" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1299"><i></i></a><div id="fragbit-1299" class="collapse"><div class="fragmentcode">              if (R &lt; 1) {
                  R += <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(T) * R / (1 - <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(R));
                  T = 1 - R;
              }</div></div>
           &lt;&lt;<span class="fragmentname"><a href="#fragment-Computeprobabilitiesmonoprandmonoptforsamplingreflectionandtransmission-0">Compute probabilities <tt>pr</tt> and <tt>pt</tt> for sampling reflection and transmission</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1300" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1300"><i></i></a><div id="fragbit-1300" class="collapse"><div class="fragmentcode">              Float pr = R, pt = T;
              if (!(sampleFlags &amp; <a href="../Reflection_Models/BSDF_Representation.html#BxDFReflTransFlags::Transmission" class="code">BxDFReflTransFlags</a>::Reflection)) pr = 0;
              if (!(sampleFlags &amp; <a href="../Reflection_Models/BSDF_Representation.html#BxDFReflTransFlags::Transmission" class="code">BxDFReflTransFlags</a>::Transmission)) pt = 0;
              if (pr == 0 &amp;&amp; pt == 0)
                  return {};</div></div>
           if (uc &lt; pr / (pr + pt)) {
               &lt;&lt;<span class="fragmentname"><a href="#fragment-SampleperfectspeculardielectricBRDF-0">Sample perfect specular dielectric BRDF</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1301" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1301"><i></i></a><div id="fragbit-1301" class="collapse"><div class="fragmentcode">                  <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wi(-wo.x, -wo.y, wo.z);
                  <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a> fr(R / <a href="../Geometry_and_Transformations/Spherical_Geometry.html#AbsCosTheta" class="code">AbsCosTheta</a>(wi));
                  return <a href="../Reflection_Models/BSDF_Representation.html#BSDFSample" class="code">BSDFSample</a>(fr, wi, pr / (pr + pt), <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a>::SpecularReflection);</div></div>
           } else {
               &lt;&lt;<span class="fragmentname"><a href="#fragment-Sampleperfectspeculartransmissionatthindielectricinterface-0">Sample perfect specular transmission at thin dielectric interface</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1302" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1302"><i></i></a><div id="fragbit-1302" class="collapse"><div class="fragmentcode">                  <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wi = -wo;
                  <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a> ft(T / <a href="../Geometry_and_Transformations/Spherical_Geometry.html#AbsCosTheta" class="code">AbsCosTheta</a>(wi));
                  return <a href="../Reflection_Models/BSDF_Representation.html#BSDFSample" class="code">BSDFSample</a>(ft, wi, pt / (pr + pt), <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a>::SpecularTransmission);</div></div>
           }
       }
       PBRT_CPU_GPU
       Float PDF(<a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wo, <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wi, <a href="#TransportMode" class="code">TransportMode</a> mode,
                 <a href="../Reflection_Models/BSDF_Representation.html#BxDFReflTransFlags" class="code">BxDFReflTransFlags</a> sampleFlags) const {
           return 0;
       }
       
       PBRT_CPU_GPU
       static constexpr const char *Name() { return "ThinDielectricBxDF"; }
       
       std::string ToString() const;
       
       PBRT_CPU_GPU
       void Regularize() { /* TODO */ }
       
       PBRT_CPU_GPU
       <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a> Flags() const {
           return (<a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a>::Reflection | <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a>::Transmission | <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a>::Specular);
       }</div></div>
  private:
    Float <span class="anchor" id="ThinDielectricBxDF::eta"></span>eta;
};</div><p>


</p>
<p>The only parameter to this <tt>BxDF</tt> is the relative index of refraction
of the interior medium.

</p>
<p></p>
<span class="anchor" id="fragment-ThinDielectricBxDFPublicMethods-0"></span><div class="fragmentname">&lt;&lt;ThinDielectricBxDF Public Methods&gt;&gt;=&nbsp;<a href="#fragment-ThinDielectricBxDFPublicMethods-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">ThinDielectricBxDF(Float eta) : eta(eta) {}</div><p>


</p>
<p>Since this <tt>BxDF</tt> models only perfect specular scattering, both its
<tt>f()</tt> and <tt>PDF()</tt> methods just return zero and are therefore not
included here.

</p>
<p> </p>
<span class="anchor" id="fig:plane-parallel-specular-dielectric"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>
<div class="figure-row">
  <a href="pha09f16.svg" title=""><img src="pha09f16.svg" width=619 height=154 style="max-width: 100%;"></a>
</div>
<p>


</p>
<figcaption class="caption">Figure 9.16: Light Paths in a Thin Plane-Parallel Dielectric Medium. <span class="legend">
An incident light ray (red) gives rise to an infinite internal scattering
process that occurs within the glass plate (blue). At each scattering event,
some fraction of the light manages to escape, causing a successive decay of the
trapped energy. </span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>The theory of the thin dielectric BSDF goes back to seminal work by
Stokes&nbsp;(<a href="Further_Reading.html#cite:Stokes1860">1860</a>), who investigated light propagation in stacks
of glass plates. Figure&nbsp;<a href="#fig:plane-parallel-specular-dielectric">9.16</a>
illustrates the most common case involving only a single glass plate: an
incident light ray (red) reflects and transmits in proportions <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.764ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 759.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper R</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D445" d="M646 553c0 99 -111 99 -182 99c-20 0 -52 0 -61 -1c-19 -3 -22 -13 -28 -37l-65 -261h112c90 0 143 32 169 58c39 39 55 108 55 142zM755 93c0 -14 -35 -115 -120 -115c-13 0 -133 0 -133 108c0 20 9 57 16 85c6 23 14 54 14 69c0 35 -18 91 -109 91h-119l-66 -265 c-1 -6 -3 -11 -3 -17c0 -18 28 -18 65 -18c19 0 28 0 28 -11c0 -20 -12 -20 -20 -20l-127 3l-126 -3s-14 0 -14 11c0 20 9 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 9 20 29 20h285 c131 0 221 -64 221 -150c0 -101 -119 -171 -220 -193c27 -10 94 -41 94 -118c0 -14 -2 -33 -4 -47c-4 -32 -10 -83 -10 -114c0 -39 7 -61 40 -61c23 0 66 17 91 91c2 7 4 14 13 14c0 0 12 0 12 -12Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D445" x="0" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.502ex" height="2.343ex" style="vertical-align: -0.505ex;" viewBox="0 -791.3 4521.5 1008.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper T equals 1 minus upper R</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D447" d="M704 666c0 -3 -1 -13 -2 -17l-27 -174c-2 -15 -4 -23 -15 -23c-9 0 -12 7 -12 13c0 3 2 15 3 19c4 26 8 65 8 80c0 78 -45 82 -146 82c-21 0 -54 0 -63 -2c-12 -3 -16 -9 -23 -37l-133 -531c-4 -15 -4 -21 -4 -21c0 -16 8 -19 37 -22c26 -2 39 -2 64 -2c26 0 34 0 34 -11 c0 -20 -12 -20 -22 -20c-28 0 -58 2 -87 2l-83 1l-85 -1c-27 0 -55 -2 -82 -2c-6 0 -17 0 -17 12c0 19 6 19 42 19c107 0 110 11 119 48l134 534c1 3 4 15 4 21c0 8 0 12 -28 12h-39c-148 0 -174 -18 -228 -173c-6 -16 -7 -21 -17 -21c-7 0 -12 5 -12 11c0 0 5 16 6 18 l60 176c7 19 8 20 32 20h555c17 0 27 0 27 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D445" d="M646 553c0 99 -111 99 -182 99c-20 0 -52 0 -61 -1c-19 -3 -22 -13 -28 -37l-65 -261h112c90 0 143 32 169 58c39 39 55 108 55 142zM755 93c0 -14 -35 -115 -120 -115c-13 0 -133 0 -133 108c0 20 9 57 16 85c6 23 14 54 14 69c0 35 -18 91 -109 91h-119l-66 -265 c-1 -6 -3 -11 -3 -17c0 -18 28 -18 65 -18c19 0 28 0 28 -11c0 -20 -12 -20 -20 -20l-127 3l-126 -3s-14 0 -14 11c0 20 9 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 9 20 29 20h285 c131 0 221 -64 221 -150c0 -101 -119 -171 -220 -193c27 -10 94 -41 94 -118c0 -14 -2 -33 -4 -47c-4 -32 -10 -83 -10 -114c0 -39 7 -61 40 -61c23 0 66 17 91 91c2 7 4 14 13 14c0 0 12 0 12 -12Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D447" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="982" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="2038" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="2761" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D445" x="3762" y="0"></use>
</g>
</svg>.
When the transmitted ray encounters the bottom interface, reciprocity causes
it to reflect and transmit according to the same proportions. This process
repeats in perpetuity.

</p>
<p>Of course, rays beyond the first interaction are displaced relative to the
entrance point. Due to the assumption of a <em>thin</em> dielectric, this spatial
shift is considered to be negligible; only the total amount of reflected or
transmitted light matters. By making this simplification, it is possible to
aggregate the effect of the infinite number of scattering events into
a simple modification of the reflectance and transmittance factors.

</p>
<p>Consider the paths that are reflected out from the top layer. Their aggregate
reflectance <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.666ex" height="2.343ex" style="vertical-align: -0.338ex;" viewBox="0 -863.1 1147.6 1008.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper R prime</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D445" d="M646 553c0 99 -111 99 -182 99c-20 0 -52 0 -61 -1c-19 -3 -22 -13 -28 -37l-65 -261h112c90 0 143 32 169 58c39 39 55 108 55 142zM755 93c0 -14 -35 -115 -120 -115c-13 0 -133 0 -133 108c0 20 9 57 16 85c6 23 14 54 14 69c0 35 -18 91 -109 91h-119l-66 -265 c-1 -6 -3 -11 -3 -17c0 -18 28 -18 65 -18c19 0 28 0 28 -11c0 -20 -12 -20 -20 -20l-127 3l-126 -3s-14 0 -14 11c0 20 9 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 9 20 29 20h285 c131 0 221 -64 221 -150c0 -101 -119 -171 -220 -193c27 -10 94 -41 94 -118c0 -14 -2 -33 -4 -47c-4 -32 -10 -83 -10 -114c0 -39 7 -61 40 -61c23 0 66 17 91 91c2 7 4 14 13 14c0 0 12 0 12 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D445" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="1074" y="513"></use>
</g>
</svg> is given by a geometric series that can be converted into an
explicit form:
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="eq:stokes-plates-R"></span><div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="46.686ex" height="6.176ex" style="vertical-align: -2.338ex;" viewBox="0 -1652.5 20101.1 2659.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper R prime equals upper R plus upper T upper R upper T plus upper T upper R upper R upper R upper T plus midline-horizontal-ellipsis equals upper R plus StartFraction upper T squared upper R Over 1 minus upper R squared EndFraction period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D445" d="M646 553c0 99 -111 99 -182 99c-20 0 -52 0 -61 -1c-19 -3 -22 -13 -28 -37l-65 -261h112c90 0 143 32 169 58c39 39 55 108 55 142zM755 93c0 -14 -35 -115 -120 -115c-13 0 -133 0 -133 108c0 20 9 57 16 85c6 23 14 54 14 69c0 35 -18 91 -109 91h-119l-66 -265 c-1 -6 -3 -11 -3 -17c0 -18 28 -18 65 -18c19 0 28 0 28 -11c0 -20 -12 -20 -20 -20l-127 3l-126 -3s-14 0 -14 11c0 20 9 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 9 20 29 20h285 c131 0 221 -64 221 -150c0 -101 -119 -171 -220 -193c27 -10 94 -41 94 -118c0 -14 -2 -33 -4 -47c-4 -32 -10 -83 -10 -114c0 -39 7 -61 40 -61c23 0 66 17 91 91c2 7 4 14 13 14c0 0 12 0 12 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D447" d="M704 666c0 -3 -1 -13 -2 -17l-27 -174c-2 -15 -4 -23 -15 -23c-9 0 -12 7 -12 13c0 3 2 15 3 19c4 26 8 65 8 80c0 78 -45 82 -146 82c-21 0 -54 0 -63 -2c-12 -3 -16 -9 -23 -37l-133 -531c-4 -15 -4 -21 -4 -21c0 -16 8 -19 37 -22c26 -2 39 -2 64 -2c26 0 34 0 34 -11 c0 -20 -12 -20 -22 -20c-28 0 -58 2 -87 2l-83 1l-85 -1c-27 0 -55 -2 -82 -2c-6 0 -17 0 -17 12c0 19 6 19 42 19c107 0 110 11 119 48l134 534c1 3 4 15 4 21c0 8 0 12 -28 12h-39c-148 0 -174 -18 -228 -173c-6 -16 -7 -21 -17 -21c-7 0 -12 5 -12 11c0 0 5 16 6 18 l60 176c7 19 8 20 32 20h555c17 0 27 0 27 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-22EF" d="M162 250c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53zM441 250c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53zM720 250c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D445" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="1074" y="583"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="1425" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D445" x="2481" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="3463" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D447" x="4464" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D445" x="5001" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D447" x="5761" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="6688" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D447" x="7688" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D445" x="8226" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D445" x="8986" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D445" x="9745" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D447" x="10505" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="11431" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-22EF" x="12432" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="13486" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D445" x="14543" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="15524" y="0"></use>
<g transform="translate(16303,0)">
<g transform="translate(342,0)">
<rect stroke="none" width="3056" height="60" x="0" y="220"></rect>
<g transform="translate(551,676)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D447" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="1047" y="513"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D445" x="1194" y="0"></use>
</g>
<g transform="translate(60,-780)">
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="722" y="0"></use>
<g transform="translate(1723,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D445" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="1074" y="408"></use>
</g>
</g>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="19822" y="0"></use>
</g>
</svg>
</div>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">
<div class="eqno">(<a href="#eq:stokes-plates-R">9.10</a>)</div>
</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<p>

A similar series gives how much light is transmitted, but it can be just as
easily computed as <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.388ex" height="2.509ex" style="vertical-align: -0.505ex;" viewBox="0 -863.1 5333.8 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper T prime equals 1 minus upper R prime</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D447" d="M704 666c0 -3 -1 -13 -2 -17l-27 -174c-2 -15 -4 -23 -15 -23c-9 0 -12 7 -12 13c0 3 2 15 3 19c4 26 8 65 8 80c0 78 -45 82 -146 82c-21 0 -54 0 -63 -2c-12 -3 -16 -9 -23 -37l-133 -531c-4 -15 -4 -21 -4 -21c0 -16 8 -19 37 -22c26 -2 39 -2 64 -2c26 0 34 0 34 -11 c0 -20 -12 -20 -22 -20c-28 0 -58 2 -87 2l-83 1l-85 -1c-27 0 -55 -2 -82 -2c-6 0 -17 0 -17 12c0 19 6 19 42 19c107 0 110 11 119 48l134 534c1 3 4 15 4 21c0 8 0 12 -28 12h-39c-148 0 -174 -18 -228 -173c-6 -16 -7 -21 -17 -21c-7 0 -12 5 -12 11c0 0 5 16 6 18 l60 176c7 19 8 20 32 20h555c17 0 27 0 27 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D445" d="M646 553c0 99 -111 99 -182 99c-20 0 -52 0 -61 -1c-19 -3 -22 -13 -28 -37l-65 -261h112c90 0 143 32 169 58c39 39 55 108 55 142zM755 93c0 -14 -35 -115 -120 -115c-13 0 -133 0 -133 108c0 20 9 57 16 85c6 23 14 54 14 69c0 35 -18 91 -109 91h-119l-66 -265 c-1 -6 -3 -11 -3 -17c0 -18 28 -18 65 -18c19 0 28 0 28 -11c0 -20 -12 -20 -20 -20l-127 3l-126 -3s-14 0 -14 11c0 20 9 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 9 20 29 20h285 c131 0 221 -64 221 -150c0 -101 -119 -171 -220 -193c27 -10 94 -41 94 -118c0 -14 -2 -33 -4 -47c-4 -32 -10 -83 -10 -114c0 -39 7 -61 40 -61c23 0 66 17 91 91c2 7 4 14 13 14c0 0 12 0 12 -12Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D447" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="1047" y="513"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="1406" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="2462" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="3185" y="0"></use>
<g transform="translate(4186,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D445" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="1074" y="513"></use>
</g>
</g>
</svg>, due to energy conservation.
Figure&nbsp;<a href="#fig:stokes-R-vs-Rprime">9.17</a> plots
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.666ex" height="2.343ex" style="vertical-align: -0.338ex;" viewBox="0 -863.1 1147.6 1008.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper R prime</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D445" d="M646 553c0 99 -111 99 -182 99c-20 0 -52 0 -61 -1c-19 -3 -22 -13 -28 -37l-65 -261h112c90 0 143 32 169 58c39 39 55 108 55 142zM755 93c0 -14 -35 -115 -120 -115c-13 0 -133 0 -133 108c0 20 9 57 16 85c6 23 14 54 14 69c0 35 -18 91 -109 91h-119l-66 -265 c-1 -6 -3 -11 -3 -17c0 -18 28 -18 65 -18c19 0 28 0 28 -11c0 -20 -12 -20 -20 -20l-127 3l-126 -3s-14 0 -14 11c0 20 9 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 9 20 29 20h285 c131 0 221 -64 221 -150c0 -101 -119 -171 -220 -193c27 -10 94 -41 94 -118c0 -14 -2 -33 -4 -47c-4 -32 -10 -83 -10 -114c0 -39 7 -61 40 -61c23 0 66 17 91 91c2 7 4 14 13 14c0 0 12 0 12 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D445" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="1074" y="513"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.764ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 759.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper R</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D445" d="M646 553c0 99 -111 99 -182 99c-20 0 -52 0 -61 -1c-19 -3 -22 -13 -28 -37l-65 -261h112c90 0 143 32 169 58c39 39 55 108 55 142zM755 93c0 -14 -35 -115 -120 -115c-13 0 -133 0 -133 108c0 20 9 57 16 85c6 23 14 54 14 69c0 35 -18 91 -109 91h-119l-66 -265 c-1 -6 -3 -11 -3 -17c0 -18 28 -18 65 -18c19 0 28 0 28 -11c0 -20 -12 -20 -20 -20l-127 3l-126 -3s-14 0 -14 11c0 20 9 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 9 20 29 20h285 c131 0 221 -64 221 -150c0 -101 -119 -171 -220 -193c27 -10 94 -41 94 -118c0 -14 -2 -33 -4 -47c-4 -32 -10 -83 -10 -114c0 -39 7 -61 40 -61c23 0 66 17 91 91c2 7 4 14 13 14c0 0 12 0 12 -12Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D445" x="0" y="0"></use>
</g>
</svg> as a function of incident angle <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 469.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">theta</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D703" d="M455 500c0 -224 -152 -511 -293 -511c-91 0 -120 111 -120 205c0 229 154 511 293 511c102 0 120 -139 120 -205zM389 562c0 57 -6 121 -55 121c-45 0 -82 -56 -109 -105c-40 -71 -60 -151 -77 -215h209c24 99 32 150 32 199zM348 331h-208c-26 -98 -32 -156 -32 -198 c0 -93 21 -122 54 -122c43 0 81 49 116 117c38 72 59 157 70 203Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="0" y="0"></use>
</g>
</svg>.
The second interface has the effect of increasing the overall amount of reflection
compared to a single Fresnel interaction.

</p>
<p></p>
<span class="anchor" id="fig:stokes-R-vs-Rprime"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>
<div class="figure-row">
  <a href="pha09f17.svg" title=""><img src="pha09f17.svg" width=722 height=299 style="max-width: 100%;"></a>
</div>
<p>


</p>
<figcaption class="caption">Figure 9.17: Reflectance of a Fresnel Interface and a Thin Dielectric. <span class="legend">
This plot compares the reflectance of a single dielectric interface with
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.226ex" height="2.676ex" style="vertical-align: -0.838ex;" viewBox="0 -791.3 3111.1 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">eta equals 1.5</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D702" d="M496 335c0 -27 -3 -40 -8 -58l-114 -453c-3 -11 -10 -40 -41 -40c-17 0 -28 12 -28 27c0 0 0 4 3 16l114 460c10 40 10 58 10 63c0 36 -11 70 -54 70s-74 -19 -96 -35c-34 -27 -65 -83 -68 -92c-1 -6 -9 -39 -11 -45c-5 -23 -11 -45 -17 -67l-22 -90 c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43l58 231c13 52 16 63 16 84c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c45 0 87 -30 92 -87 c24 35 76 87 155 87c75 0 115 -42 115 -107Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-35" d="M449 201c0 -127 -102 -223 -218 -223c-112 0 -181 97 -181 183c0 46 35 53 49 53c33 0 50 -25 50 -49s-17 -49 -50 -49c-11 0 -14 1 -17 2c17 -59 74 -112 147 -112c46 0 83 26 107 65c24 42 24 102 24 137c0 50 -2 89 -18 126c-8 18 -33 64 -85 64 c-81 0 -118 -54 -129 -70c-4 -6 -6 -9 -13 -9c-14 0 -14 8 -14 26v296c0 16 0 24 10 24c0 0 4 0 12 -3c47 -21 93 -28 133 -28c67 0 116 20 136 29c5 3 8 3 8 3c7 0 10 -5 10 -11c0 -13 -70 -104 -193 -104c-32 0 -65 7 -85 13v-195c36 35 79 51 127 51 c108 0 190 -100 190 -219Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D702" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="775" y="0"></use>
<g transform="translate(1831,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-31"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-35" x="779" y="0"></use>
</g>
</g>
</svg> as determined by the Fresnel equations&nbsp;(<a href="../Reflection_Models/Specular_Reflection_and_Transmission.html#eq:fresnel">9.6</a>) to that of
a matching thin dielectric according to Equation&nbsp;(<a href="#eq:stokes-plates-R">9.10</a>).
</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>

</p>
<p>The <tt>Sample_f()</tt> method computes the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.666ex" height="2.343ex" style="vertical-align: -0.338ex;" viewBox="0 -863.1 1147.6 1008.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper R prime</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D445" d="M646 553c0 99 -111 99 -182 99c-20 0 -52 0 -61 -1c-19 -3 -22 -13 -28 -37l-65 -261h112c90 0 143 32 169 58c39 39 55 108 55 142zM755 93c0 -14 -35 -115 -120 -115c-13 0 -133 0 -133 108c0 20 9 57 16 85c6 23 14 54 14 69c0 35 -18 91 -109 91h-119l-66 -265 c-1 -6 -3 -11 -3 -17c0 -18 28 -18 65 -18c19 0 28 0 28 -11c0 -20 -12 -20 -20 -20l-127 3l-126 -3s-14 0 -14 11c0 20 9 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 9 20 29 20h285 c131 0 221 -64 221 -150c0 -101 -119 -171 -220 -193c27 -10 94 -41 94 -118c0 -14 -2 -33 -4 -47c-4 -32 -10 -83 -10 -114c0 -39 7 -61 40 -61c23 0 66 17 91 91c2 7 4 14 13 14c0 0 12 0 12 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D445" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="1074" y="513"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.621ex" height="2.343ex" style="vertical-align: -0.338ex;" viewBox="0 -863.1 1128.7 1008.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper T prime</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D447" d="M704 666c0 -3 -1 -13 -2 -17l-27 -174c-2 -15 -4 -23 -15 -23c-9 0 -12 7 -12 13c0 3 2 15 3 19c4 26 8 65 8 80c0 78 -45 82 -146 82c-21 0 -54 0 -63 -2c-12 -3 -16 -9 -23 -37l-133 -531c-4 -15 -4 -21 -4 -21c0 -16 8 -19 37 -22c26 -2 39 -2 64 -2c26 0 34 0 34 -11 c0 -20 -12 -20 -22 -20c-28 0 -58 2 -87 2l-83 1l-85 -1c-27 0 -55 -2 -82 -2c-6 0 -17 0 -17 12c0 19 6 19 42 19c107 0 110 11 119 48l134 534c1 3 4 15 4 21c0 8 0 12 -28 12h-39c-148 0 -174 -18 -228 -173c-6 -16 -7 -21 -17 -21c-7 0 -12 5 -12 11c0 0 5 16 6 18 l60 176c7 19 8 20 32 20h555c17 0 27 0 27 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D447" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="1047" y="513"></use>
</g>
</svg> coefficients and
then computes probabilities for sampling reflection and transmission, just
as the <a href="#DielectricBxDF"><tt>DielectricBxDF</tt></a> did, reusing the corresponding code fragment.

</p>
<p></p>
<span class="anchor" id="fragment-ThinDielectricBxDFPublicMethods-1"></span><div class="fragmentname">&lt;&lt;ThinDielectricBxDF Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-ThinDielectricBxDFPublicMethods-0"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">pstd::optional&lt;<a href="../Reflection_Models/BSDF_Representation.html#BSDFSample" class="code">BSDFSample</a>&gt;
<span class="anchor" id="ThinDielectricBxDF::Sample_f"></span>Sample_f(<a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wo, Float uc, <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> u, <a href="#TransportMode" class="code">TransportMode</a> mode,
         <a href="../Reflection_Models/BSDF_Representation.html#BxDFReflTransFlags" class="code">BxDFReflTransFlags</a> sampleFlags) const {
    Float R = <a href="../Reflection_Models/Specular_Reflection_and_Transmission.html#FrDielectric" class="code">FrDielectric</a>(<a href="../Geometry_and_Transformations/Spherical_Geometry.html#AbsCosTheta" class="code">AbsCosTheta</a>(wo), eta), T = 1 - R;
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ComputemonoRandmonoTaccountingforscatteringbetweeninterfaces-0">Compute <tt>R</tt> and <tt>T</tt> accounting for scattering between interfaces</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1303" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1303"><i></i></a><div id="fragbit-1303" class="collapse"><div class="fragmentcode">       if (R &lt; 1) {
           R += <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(T) * R / (1 - <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(R));
           T = 1 - R;
       }</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Computeprobabilitiesmonoprandmonoptforsamplingreflectionandtransmission-0">Compute probabilities <tt>pr</tt> and <tt>pt</tt> for sampling reflection and transmission</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1304" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1304"><i></i></a><div id="fragbit-1304" class="collapse"><div class="fragmentcode">       Float pr = R, pt = T;
       if (!(sampleFlags &amp; <a href="../Reflection_Models/BSDF_Representation.html#BxDFReflTransFlags::Transmission" class="code">BxDFReflTransFlags</a>::Reflection)) pr = 0;
       if (!(sampleFlags &amp; <a href="../Reflection_Models/BSDF_Representation.html#BxDFReflTransFlags::Transmission" class="code">BxDFReflTransFlags</a>::Transmission)) pt = 0;
       if (pr == 0 &amp;&amp; pt == 0)
           return {};</div></div>
    if (uc &lt; pr / (pr + pt)) {
        &lt;&lt;<span class="fragmentname"><a href="#fragment-SampleperfectspeculardielectricBRDF-0">Sample perfect specular dielectric BRDF</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1305" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1305"><i></i></a><div id="fragbit-1305" class="collapse"><div class="fragmentcode">           <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wi(-wo.x, -wo.y, wo.z);
           <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a> fr(R / <a href="../Geometry_and_Transformations/Spherical_Geometry.html#AbsCosTheta" class="code">AbsCosTheta</a>(wi));
           return <a href="../Reflection_Models/BSDF_Representation.html#BSDFSample" class="code">BSDFSample</a>(fr, wi, pr / (pr + pt), <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a>::SpecularReflection);</div></div>
    } else {
        &lt;&lt;<span class="fragmentname"><a href="#fragment-Sampleperfectspeculartransmissionatthindielectricinterface-0">Sample perfect specular transmission at thin dielectric interface</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1306" role="button" class="fa codecarat collapsed" aria-expanded="false" aria-controls="fragbit-1306"><i></i></a><div id="fragbit-1306" class="collapse"><div class="fragmentcode">           <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wi = -wo;
           <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a> ft(T / <a href="../Geometry_and_Transformations/Spherical_Geometry.html#AbsCosTheta" class="code">AbsCosTheta</a>(wi));
           return <a href="../Reflection_Models/BSDF_Representation.html#BSDFSample" class="code">BSDFSample</a>(ft, wi, pt / (pr + pt), <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a>::SpecularTransmission);</div></div>
    }
}</div><p>


</p>
<p>The updated reflection and transmission coefficients are easily computed
using Equation (<a href="#eq:stokes-plates-R">9.10</a>), though care must be taken to
avoid a division by zero in the case of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.025ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 2594.1 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper R equals 1</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D445" d="M646 553c0 99 -111 99 -182 99c-20 0 -52 0 -61 -1c-19 -3 -22 -13 -28 -37l-65 -261h112c90 0 143 32 169 58c39 39 55 108 55 142zM755 93c0 -14 -35 -115 -120 -115c-13 0 -133 0 -133 108c0 20 9 57 16 85c6 23 14 54 14 69c0 35 -18 91 -109 91h-119l-66 -265 c-1 -6 -3 -11 -3 -17c0 -18 28 -18 65 -18c19 0 28 0 28 -11c0 -20 -12 -20 -20 -20l-127 3l-126 -3s-14 0 -14 11c0 20 9 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 9 20 29 20h285 c131 0 221 -64 221 -150c0 -101 -119 -171 -220 -193c27 -10 94 -41 94 -118c0 -14 -2 -33 -4 -47c-4 -32 -10 -83 -10 -114c0 -39 7 -61 40 -61c23 0 66 17 91 91c2 7 4 14 13 14c0 0 12 0 12 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D445" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="1037" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="2093" y="0"></use>
</g>
</svg>.

</p>
<p></p>
<span class="anchor" id="fragment-ComputemonoRandmonoTaccountingforscatteringbetweeninterfaces-0"></span><div class="fragmentname">&lt;&lt;Compute <tt>R</tt> and <tt>T</tt> accounting for scattering between interfaces&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">if (R &lt; 1) {
    R += <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(T) * R / (1 - <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(R));
    T = 1 - R;
}</div><p>


</p>
<p>The <a href="#DielectricBxDF"><tt>DielectricBxDF</tt></a> fragment that samples perfect specular reflection is
also reused in this method&rsquo;s implementation, inheriting the computed <tt>R</tt>
value. The transmission case slightly deviates from the <tt>DielectricBxDF</tt>,
as the transmitted direction is simply the negation of <tt>wo</tt>.

</p>
<p></p>
<span class="anchor" id="fragment-Sampleperfectspeculartransmissionatthindielectricinterface-0"></span><div class="fragmentname">&lt;&lt;Sample perfect specular transmission at thin dielectric interface&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> wi = -wo;
<a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a> ft(T / <a href="../Geometry_and_Transformations/Spherical_Geometry.html#AbsCosTheta" class="code">AbsCosTheta</a>(wi));
return <a href="../Reflection_Models/BSDF_Representation.html#BSDFSample" class="code">BSDFSample</a>(ft, wi, pt / (pr + pt), <a href="../Reflection_Models/BSDF_Representation.html#BxDFFlags" class="code">BxDFFlags</a>::SpecularTransmission);</div><p>


</p>
<p>

</p>
<p>

</p>
<p>
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#Non-SymmetricScatteringandRefraction"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:non-symmetric"></span><span id="Non-SymmetricScatteringandRefraction"></span><h3>9.5.2  Non-Symmetric Scattering and Refraction<button data-toggle="tooltip" data-placement="right" class="btn difficult-button"
title="This section contains advanced content and may be skipped on a first reading.">
<i class="fas fa-exclamation-triangle midredtext"></i></button>
</h3><p>



</p>
<p> </p>
<span class="anchor" id="fig:snells-window"></span><div class="card outerfigure"><div class="card-body figure"><p>


</p>
<div class="figure-row">
<img src="snells-window.png" style="max-width: 100%; height: auto;" width=1280 height=720>
</div>
<p>

</p>
<figcaption class="caption">Figure 9.18: Snell&rsquo;s Window.
<span class="legend"> If one looks upward when underwater in a swimming pool, the sky is only
visible through a circular window because no light is refracted beyond the
critical angle.  Outside of the window, only the reflection of the pool
bottom is seen.</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>All physically based BRDFs are symmetric: the incident and outgoing
directions can be interchanged without changing the function&rsquo;s value.
However, the same is not generally true for BTDFs.
Non-symmetry with BTDFs is due to the fact
that when light refracts into a material with a higher index of refraction
than the incident medium&rsquo;s index of refraction, energy is compressed
into a smaller set of angles (and vice versa, when going in the opposite
direction).  This effect is easy to see yourself, for instance, by looking
at the sky from underwater in a quiet outdoor swimming pool. Because no
light can be refracted above the critical angle (<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.486ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 3223 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">tilde 48.6 Superscript ring</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-223C" d="M717 354c-4 -116 -34 -183 -119 -211c-15 -4 -30 -7 -45 -7c-66 0 -130 46 -184 95c-44 39 -93 81 -146 81c-10 0 -21 -1 -31 -5c-70 -23 -109 -67 -112 -161c0 -7 -6 -12 -12 -12c-7 0 -12 5 -12 12c4 116 34 183 120 211c14 4 29 7 44 7c66 0 130 -46 184 -95 c44 -39 93 -81 146 -81c11 0 21 1 32 5c69 23 108 67 111 161c0 7 6 12 12 12c7 0 12 -5 12 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-34" d="M471 165h-100v-87c0 -36 2 -47 76 -47h21v-31c-41 3 -94 3 -136 3s-94 0 -135 -3v31h21c74 0 76 11 76 47v87h-266v31l307 469c8 12 11 12 20 12c16 0 16 -6 16 -26v-455h100v-31zM300 196v373l-244 -373h244Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-38" d="M457 168c0 -107 -95 -190 -208 -190c-105 0 -207 67 -207 173c0 99 86 155 144 184c-25 17 -62 42 -73 54c-42 47 -44 92 -44 110c0 93 81 167 181 167c91 0 180 -57 180 -149c0 -66 -49 -118 -121 -155c64 -40 80 -50 99 -71c38 -42 49 -87 49 -123zM386 517 c0 72 -64 124 -137 124c-71 0 -136 -42 -136 -103c0 -17 4 -51 50 -81l124 -80c60 35 99 83 99 140zM407 132c0 61 -47 91 -75 110l-123 78c-85 -47 -117 -111 -117 -169c0 -83 72 -145 158 -145c82 0 157 52 157 126Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-36" d="M457 204c0 -132 -95 -226 -206 -226c-93 0 -209 71 -209 338c0 221 135 350 263 350c83 0 127 -48 127 -108c0 -39 -30 -48 -46 -48c-22 0 -46 15 -46 46c0 45 40 45 55 45c-22 34 -64 40 -88 40c-51 0 -175 -36 -175 -289v-24c20 48 57 99 125 99 c111 0 200 -96 200 -223zM367 205c0 49 0 100 -18 137c-31 62 -77 62 -93 62c-90 0 -122 -100 -122 -178c0 -18 0 -98 18 -145c6 -15 36 -75 99 -75c23 0 69 5 99 65c17 36 17 86 17 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2218" d="M356 250c0 -83 -67 -150 -150 -150s-150 67 -150 150s67 150 150 150s150 -67 150 -150zM316 250c0 61 -49 110 -110 110s-110 -49 -110 -110s49 -110 110 -110s110 49 110 110Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-223C" x="0" y="0"></use>
<g transform="translate(1051,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-34"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-38" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="1001" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-36" x="1279" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2218" x="2517" y="572"></use>
</g>
</g>
</svg> for
water), the incident hemisphere of light is squeezed into a considerably
smaller subset of the hemisphere, which covers the remaining set of
angles (Figure&nbsp;<a href="#fig:snells-window">9.18</a>). Radiance along rays that do refract therefore must increase so that
energy is preserved when light passes through the interface.

</p>
<p></p>
<span class="anchor" id="fig:radiance-boundary"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>
<div class="figure-row">
  <a href="pha09f19.svg" title=""><img src="pha09f19.svg" width=334 height=337 style="max-width: 100%;"></a>
</div>
<p>


</p>
<figcaption class="caption">Figure 9.19: <span class="legend"> The amount of transmitted radiance at
the boundary between media with different indices of refraction is scaled
by the squared ratio of the two indices of refraction.  Intuitively, this
can be understood as the result of the radiance&rsquo;s differential solid
angle being compressed or expanded as a result of transmission.</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>More formally, consider incident radiance arriving at the boundary between
two media, with indices of refraction <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.845ex" height="2.176ex" style="vertical-align: -0.838ex;" viewBox="0 -576.1 794.4 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">eta Subscript normal i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D702" d="M496 335c0 -27 -3 -40 -8 -58l-114 -453c-3 -11 -10 -40 -41 -40c-17 0 -28 12 -28 27c0 0 0 4 3 16l114 460c10 40 10 58 10 63c0 36 -11 70 -54 70s-74 -19 -96 -35c-34 -27 -65 -83 -68 -92c-1 -6 -9 -39 -11 -45c-5 -23 -11 -45 -17 -67l-22 -90 c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43l58 231c13 52 16 63 16 84c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c45 0 87 -30 92 -87 c24 35 76 87 155 87c75 0 115 -42 115 -107Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-69" d="M247 0c-34 1 -69 3 -104 3l-110 -3v31c67 0 78 0 78 45v269c0 49 -9 55 -74 55v31l140 11v-367c0 -39 4 -44 70 -44v-31zM192 604c0 -25 -20 -53 -54 -53c-30 0 -53 26 -53 53c0 25 20 53 54 53c30 0 53 -26 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D702" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="703" y="-213"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.21ex" height="2.176ex" style="vertical-align: -0.838ex;" viewBox="0 -576.1 951.4 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">eta Subscript normal o</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D702" d="M496 335c0 -27 -3 -40 -8 -58l-114 -453c-3 -11 -10 -40 -41 -40c-17 0 -28 12 -28 27c0 0 0 4 3 16l114 460c10 40 10 58 10 63c0 36 -11 70 -54 70s-74 -19 -96 -35c-34 -27 -65 -83 -68 -92c-1 -6 -9 -39 -11 -45c-5 -23 -11 -45 -17 -67l-22 -90 c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43l58 231c13 52 16 63 16 84c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c45 0 87 -30 92 -87 c24 35 76 87 155 87c75 0 115 -42 115 -107Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D702" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="703" y="-213"></use>
</g>
</svg>
(Figure&nbsp;<a href="#fig:radiance-boundary">9.19</a>).
Assuming for now that all the incident light is transmitted, the amount
of transmitted differential flux is then
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="13.539ex" height="3.009ex" style="vertical-align: -0.671ex;" viewBox="0 -1006.6 5829.2 1295.7" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal d squared normal upper Phi Subscript normal o Baseline equals normal d squared normal upper Phi Subscript normal i Baseline period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-64" d="M527 0l-147 -11v66c-25 -32 -70 -66 -134 -66c-114 0 -212 99 -212 226c0 129 105 227 223 227c54 0 97 -26 126 -62v216c0 49 -8 56 -78 56v31l144 11v-607c0 -49 8 -56 78 -56v-31zM380 118v205c0 18 0 20 -11 37c-31 45 -73 60 -108 60c-54 0 -92 -33 -113 -64 c-29 -45 -31 -105 -31 -142c0 -41 3 -98 29 -139c24 -38 60 -64 105 -64c43 0 88 22 118 70c11 17 11 19 11 37Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3A6" d="M665 341c0 -101 -111 -194 -266 -206v-56c0 -35 0 -48 95 -48h33v-31c-36 3 -129 3 -170 3s-133 0 -169 -3v31h33c95 0 95 14 95 48v56c-149 15 -260 104 -260 207c0 99 107 191 260 206v56c0 35 0 48 -95 48h-33v31c36 -3 129 -3 170 -3s133 0 169 3v-31h-33 c-95 0 -95 -14 -95 -48v-56c152 -12 266 -103 266 -207zM316 158v367c-150 -20 -160 -132 -160 -184c0 -62 18 -164 160 -183zM565 342c0 76 -28 168 -166 184v-369c151 18 166 125 166 185Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-69" d="M247 0c-34 1 -69 3 -104 3l-110 -3v31c67 0 78 0 78 45v269c0 49 -9 55 -74 55v31l140 11v-367c0 -39 4 -44 70 -44v-31zM192 604c0 -25 -20 -53 -54 -53c-30 0 -53 26 -53 53c0 25 20 53 54 53c30 0 53 -26 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="787" y="596"></use>
<g transform="translate(1010,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-3A6" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="1021" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="2464" y="0"></use>
<g transform="translate(3520,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="787" y="596"></use>
</g>
<g transform="translate(4531,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-3A6" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="1021" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="5550" y="0"></use>
</g>
</svg>
</div>
<p>

If we use the definition of radiance, Equation&nbsp;(<a href="../Radiometry,_Spectra,_and_Color/Radiometry.html#eq:radiance">4.3</a>), we
equivalently have
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="33.898ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 14594.9 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper L Subscript normal o Baseline cosine theta Subscript normal o Baseline normal d upper A Subscript Baseline normal d omega Subscript normal o Baseline equals upper L Subscript normal i Baseline cosine theta Subscript normal i Baseline normal d upper A Subscript Baseline omega Subscript normal i Baseline period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-63" d="M415 119c0 -10 -32 -130 -166 -130c-116 0 -215 99 -215 227c0 124 92 232 217 232c77 0 153 -39 153 -107c0 -30 -20 -47 -46 -47c-28 0 -46 20 -46 46c0 13 6 43 47 46c-35 36 -98 37 -107 37c-53 0 -135 -42 -135 -205c0 -161 88 -204 141 -204c37 0 102 12 131 105 c2 6 4 10 13 10c3 0 13 0 13 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-73" d="M360 128c0 -72 -46 -139 -161 -139c-21 0 -66 1 -110 43c-18 -19 -18 -21 -20 -23c-19 -19 -20 -20 -25 -20c-11 0 -11 7 -11 24v132c0 18 0 25 13 25c10 0 11 -4 14 -17c19 -85 55 -142 139 -142c78 0 113 40 113 91c0 72 -82 88 -104 92c-72 14 -100 20 -132 46 c-27 22 -43 50 -43 85c0 56 38 123 160 123c15 0 56 0 94 -28c4 3 14 12 17 16c13 12 15 12 20 12c11 0 11 -7 11 -24v-101c0 -19 0 -24 -13 -24c0 0 -11 0 -12 9c-2 31 -7 121 -117 121c-86 0 -112 -41 -112 -76c0 -58 67 -71 123 -82c42 -8 81 -16 114 -48 c12 -12 42 -42 42 -95Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D703" d="M455 500c0 -224 -152 -511 -293 -511c-91 0 -120 111 -120 205c0 229 154 511 293 511c102 0 120 -139 120 -205zM389 562c0 57 -6 121 -55 121c-45 0 -82 -56 -109 -105c-40 -71 -60 -151 -77 -215h209c24 99 32 150 32 199zM348 331h-208c-26 -98 -32 -156 -32 -198 c0 -93 21 -122 54 -122c43 0 81 49 116 117c38 72 59 157 70 203Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-64" d="M527 0l-147 -11v66c-25 -32 -70 -66 -134 -66c-114 0 -212 99 -212 226c0 129 105 227 223 227c54 0 97 -26 126 -62v216c0 49 -8 56 -78 56v31l144 11v-607c0 -49 8 -56 78 -56v-31zM380 118v205c0 18 0 20 -11 37c-31 45 -73 60 -108 60c-54 0 -92 -33 -113 -64 c-29 -45 -31 -105 -31 -142c0 -41 3 -98 29 -139c24 -38 60 -64 105 -64c43 0 88 22 118 70c11 17 11 19 11 37Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D434" d="M721 20c0 -20 -12 -20 -18 -20c-25 0 -88 3 -113 3c-41 0 -84 -3 -125 -3c0 0 -14 0 -14 11c0 20 10 20 24 20c20 0 72 3 72 33c0 10 -14 146 -16 167h-251c-68 -116 -69 -116 -76 -128c-8 -14 -14 -25 -14 -37c0 -25 24 -33 47 -35c7 0 16 -1 16 -12 c0 -19 -13 -19 -19 -19c-32 0 -67 3 -100 3c-28 0 -59 -3 -86 -3c-8 0 -13 5 -13 11c0 19 9 19 21 20c44 3 83 17 123 84l348 584c6 10 10 17 26 17c17 0 17 -4 19 -24l61 -625c3 -29 3 -36 65 -36c13 0 23 0 23 -11zM528 262l-32 330l-197 -330h229Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D714" d="M604 372c0 -40 -12 -90 -23 -133c-30 -121 -93 -250 -197 -250c-67 0 -102 44 -113 106c-38 -62 -90 -106 -153 -106c-76 0 -105 62 -105 143c0 35 5 74 15 112c16 63 41 127 82 184c5 6 12 9 18 9c3 0 6 0 9 -2c5 -3 9 -8 9 -14c0 -4 -2 -9 -5 -13 c-38 -53 -74 -109 -89 -169c-5 -22 -8 -45 -8 -65c0 -63 26 -113 87 -113c55 0 103 39 136 93c1 29 5 59 13 90c5 22 15 47 34 47c14 0 19 -11 19 -26c0 -8 -2 -17 -4 -26c-7 -30 -17 -60 -30 -88c9 -52 42 -90 98 -90c79 0 137 92 160 183c3 12 4 25 4 37 c0 35 -13 66 -38 88c-7 7 -11 15 -11 25c0 11 5 22 14 32c10 10 23 16 35 16c9 0 17 -3 23 -9c15 -13 20 -35 20 -61Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-69" d="M247 0c-34 1 -69 3 -104 3l-110 -3v31c67 0 78 0 78 45v269c0 49 -9 55 -74 55v31l140 11v-367c0 -39 4 -44 70 -44v-31zM192 604c0 -25 -20 -53 -54 -53c-30 0 -53 26 -53 53c0 25 20 53 54 53c30 0 53 -26 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="963" y="-213"></use>
<g transform="translate(1302,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-63"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="444" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-73" x="945" y="0"></use>
</g>
<g transform="translate(2808,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="663" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="3898" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D434" x="4454" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="5371" y="0"></use>
<g transform="translate(5928,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="880" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="7282" y="0"></use>
<g transform="translate(8338,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="963" y="-213"></use>
</g>
<g transform="translate(9484,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-63"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="444" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-73" x="945" y="0"></use>
</g>
<g transform="translate(10990,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="663" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="11923" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D434" x="12479" y="0"></use>
<g transform="translate(13396,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="880" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="14316" y="0"></use>
</g>
</svg>
</div>
<p>

Expanding the solid angles to spherical angles gives
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="eq:spherical-L-transmitted"></span><div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="53.538ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 23051.1 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper L Subscript normal o Baseline cosine theta Subscript normal o Baseline normal d upper A Subscript Baseline sine theta Subscript normal o Baseline normal d theta Subscript normal o Baseline normal d phi Subscript normal o Baseline equals upper L Subscript normal i Baseline cosine theta Subscript normal i Baseline normal d upper A Subscript Baseline sine theta Subscript normal i Baseline normal d theta Subscript normal i Baseline normal d phi Subscript normal i Baseline period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-63" d="M415 119c0 -10 -32 -130 -166 -130c-116 0 -215 99 -215 227c0 124 92 232 217 232c77 0 153 -39 153 -107c0 -30 -20 -47 -46 -47c-28 0 -46 20 -46 46c0 13 6 43 47 46c-35 36 -98 37 -107 37c-53 0 -135 -42 -135 -205c0 -161 88 -204 141 -204c37 0 102 12 131 105 c2 6 4 10 13 10c3 0 13 0 13 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-73" d="M360 128c0 -72 -46 -139 -161 -139c-21 0 -66 1 -110 43c-18 -19 -18 -21 -20 -23c-19 -19 -20 -20 -25 -20c-11 0 -11 7 -11 24v132c0 18 0 25 13 25c10 0 11 -4 14 -17c19 -85 55 -142 139 -142c78 0 113 40 113 91c0 72 -82 88 -104 92c-72 14 -100 20 -132 46 c-27 22 -43 50 -43 85c0 56 38 123 160 123c15 0 56 0 94 -28c4 3 14 12 17 16c13 12 15 12 20 12c11 0 11 -7 11 -24v-101c0 -19 0 -24 -13 -24c0 0 -11 0 -12 9c-2 31 -7 121 -117 121c-86 0 -112 -41 -112 -76c0 -58 67 -71 123 -82c42 -8 81 -16 114 -48 c12 -12 42 -42 42 -95Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D703" d="M455 500c0 -224 -152 -511 -293 -511c-91 0 -120 111 -120 205c0 229 154 511 293 511c102 0 120 -139 120 -205zM389 562c0 57 -6 121 -55 121c-45 0 -82 -56 -109 -105c-40 -71 -60 -151 -77 -215h209c24 99 32 150 32 199zM348 331h-208c-26 -98 -32 -156 -32 -198 c0 -93 21 -122 54 -122c43 0 81 49 116 117c38 72 59 157 70 203Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-64" d="M527 0l-147 -11v66c-25 -32 -70 -66 -134 -66c-114 0 -212 99 -212 226c0 129 105 227 223 227c54 0 97 -26 126 -62v216c0 49 -8 56 -78 56v31l144 11v-607c0 -49 8 -56 78 -56v-31zM380 118v205c0 18 0 20 -11 37c-31 45 -73 60 -108 60c-54 0 -92 -33 -113 -64 c-29 -45 -31 -105 -31 -142c0 -41 3 -98 29 -139c24 -38 60 -64 105 -64c43 0 88 22 118 70c11 17 11 19 11 37Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D434" d="M721 20c0 -20 -12 -20 -18 -20c-25 0 -88 3 -113 3c-41 0 -84 -3 -125 -3c0 0 -14 0 -14 11c0 20 10 20 24 20c20 0 72 3 72 33c0 10 -14 146 -16 167h-251c-68 -116 -69 -116 -76 -128c-8 -14 -14 -25 -14 -37c0 -25 24 -33 47 -35c7 0 16 -1 16 -12 c0 -19 -13 -19 -19 -19c-32 0 -67 3 -100 3c-28 0 -59 -3 -86 -3c-8 0 -13 5 -13 11c0 19 9 19 21 20c44 3 83 17 123 84l348 584c6 10 10 17 26 17c17 0 17 -4 19 -24l61 -625c3 -29 3 -36 65 -36c13 0 23 0 23 -11zM528 262l-32 330l-197 -330h229Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-69" d="M247 0c-34 1 -69 3 -104 3l-110 -3v31c67 0 78 0 78 45v269c0 49 -9 55 -74 55v31l140 11v-367c0 -39 4 -44 70 -44v-31zM192 604c0 -25 -20 -53 -54 -53c-30 0 -53 26 -53 53c0 25 20 53 54 53c30 0 53 -26 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6E" d="M535 0l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l141 11v-105c28 62 75 105 148 105c58 0 91 -20 105 -37 c31 -36 31 -67 31 -153v-191c1 -30 26 -30 78 -30v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D719" d="M573 262c0 -134 -145 -269 -306 -274l-38 -149c-3 -14 -9 -38 -11 -40c-3 -3 -5 -4 -10 -4s-12 1 -12 11c0 3 10 41 22 88l23 94c-122 7 -192 86 -192 181c0 136 147 269 306 274l58 231c4 17 5 20 15 20c12 0 12 -10 12 -10l-3 -14l-56 -227c139 -10 192 -102 192 -181z M349 421c-149 -13 -235 -153 -235 -273c0 -100 72 -135 132 -138zM508 283c0 88 -57 134 -133 138l-103 -411c150 12 236 155 236 273Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="963" y="-213"></use>
<g transform="translate(1302,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-63"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="444" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-73" x="945" y="0"></use>
</g>
<g transform="translate(2808,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="663" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="3898" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D434" x="4454" y="0"></use>
<g transform="translate(5371,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-73"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-69" x="394" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6E" x="673" y="0"></use>
</g>
<g transform="translate(6768,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="663" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="7858" y="0"></use>
<g transform="translate(8414,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="663" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="9504" y="0"></use>
<g transform="translate(10061,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D719" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="843" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="11389" y="0"></use>
<g transform="translate(12445,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="963" y="-213"></use>
</g>
<g transform="translate(13590,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-63"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="444" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-73" x="945" y="0"></use>
</g>
<g transform="translate(15097,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="663" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="16030" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D434" x="16586" y="0"></use>
<g transform="translate(17503,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-73"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-69" x="394" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6E" x="673" y="0"></use>
</g>
<g transform="translate(18899,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="663" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="19833" y="0"></use>
<g transform="translate(20389,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="663" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="21322" y="0"></use>
<g transform="translate(21879,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D719" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="843" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="22772" y="0"></use>
</g>
</svg>
</div>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">
<div class="eqno">(<a href="#eq:spherical-L-transmitted">9.11</a>)</div>
</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<p>

Differentiating Snell&rsquo;s law, Equation&nbsp;(<a href="../Reflection_Models/Specular_Reflection_and_Transmission.html#eq:snells-law">9.2</a>), with respect
to <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 469.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">theta</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D703" d="M455 500c0 -224 -152 -511 -293 -511c-91 0 -120 111 -120 205c0 229 154 511 293 511c102 0 120 -139 120 -205zM389 562c0 57 -6 121 -55 121c-45 0 -82 -56 -109 -105c-40 -71 -60 -151 -77 -215h209c24 99 32 150 32 199zM348 331h-208c-26 -98 -32 -156 -32 -198 c0 -93 21 -122 54 -122c43 0 81 49 116 117c38 72 59 157 70 203Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="0" y="0"></use>
</g>
</svg> gives the useful relation
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="26.78ex" height="2.676ex" style="vertical-align: -0.838ex;" viewBox="0 -791.3 11530.1 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">eta Subscript normal o Baseline cosine theta Subscript normal o Baseline normal d theta Subscript normal o Baseline equals eta Subscript normal i Baseline cosine theta Subscript normal i Baseline normal d theta Subscript normal i Baseline comma</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D702" d="M496 335c0 -27 -3 -40 -8 -58l-114 -453c-3 -11 -10 -40 -41 -40c-17 0 -28 12 -28 27c0 0 0 4 3 16l114 460c10 40 10 58 10 63c0 36 -11 70 -54 70s-74 -19 -96 -35c-34 -27 -65 -83 -68 -92c-1 -6 -9 -39 -11 -45c-5 -23 -11 -45 -17 -67l-22 -90 c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43l58 231c13 52 16 63 16 84c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c45 0 87 -30 92 -87 c24 35 76 87 155 87c75 0 115 -42 115 -107Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-63" d="M415 119c0 -10 -32 -130 -166 -130c-116 0 -215 99 -215 227c0 124 92 232 217 232c77 0 153 -39 153 -107c0 -30 -20 -47 -46 -47c-28 0 -46 20 -46 46c0 13 6 43 47 46c-35 36 -98 37 -107 37c-53 0 -135 -42 -135 -205c0 -161 88 -204 141 -204c37 0 102 12 131 105 c2 6 4 10 13 10c3 0 13 0 13 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-73" d="M360 128c0 -72 -46 -139 -161 -139c-21 0 -66 1 -110 43c-18 -19 -18 -21 -20 -23c-19 -19 -20 -20 -25 -20c-11 0 -11 7 -11 24v132c0 18 0 25 13 25c10 0 11 -4 14 -17c19 -85 55 -142 139 -142c78 0 113 40 113 91c0 72 -82 88 -104 92c-72 14 -100 20 -132 46 c-27 22 -43 50 -43 85c0 56 38 123 160 123c15 0 56 0 94 -28c4 3 14 12 17 16c13 12 15 12 20 12c11 0 11 -7 11 -24v-101c0 -19 0 -24 -13 -24c0 0 -11 0 -12 9c-2 31 -7 121 -117 121c-86 0 -112 -41 -112 -76c0 -58 67 -71 123 -82c42 -8 81 -16 114 -48 c12 -12 42 -42 42 -95Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D703" d="M455 500c0 -224 -152 -511 -293 -511c-91 0 -120 111 -120 205c0 229 154 511 293 511c102 0 120 -139 120 -205zM389 562c0 57 -6 121 -55 121c-45 0 -82 -56 -109 -105c-40 -71 -60 -151 -77 -215h209c24 99 32 150 32 199zM348 331h-208c-26 -98 -32 -156 -32 -198 c0 -93 21 -122 54 -122c43 0 81 49 116 117c38 72 59 157 70 203Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-64" d="M527 0l-147 -11v66c-25 -32 -70 -66 -134 -66c-114 0 -212 99 -212 226c0 129 105 227 223 227c54 0 97 -26 126 -62v216c0 49 -8 56 -78 56v31l144 11v-607c0 -49 8 -56 78 -56v-31zM380 118v205c0 18 0 20 -11 37c-31 45 -73 60 -108 60c-54 0 -92 -33 -113 -64 c-29 -45 -31 -105 -31 -142c0 -41 3 -98 29 -139c24 -38 60 -64 105 -64c43 0 88 22 118 70c11 17 11 19 11 37Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-69" d="M247 0c-34 1 -69 3 -104 3l-110 -3v31c67 0 78 0 78 45v269c0 49 -9 55 -74 55v31l140 11v-367c0 -39 4 -44 70 -44v-31zM192 604c0 -25 -20 -53 -54 -53c-30 0 -53 26 -53 53c0 25 20 53 54 53c30 0 53 -26 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D702" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="703" y="-213"></use>
<g transform="translate(1118,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-63"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="444" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-73" x="945" y="0"></use>
</g>
<g transform="translate(2624,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="663" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="3714" y="0"></use>
<g transform="translate(4270,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="663" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="5471" y="0"></use>
<g transform="translate(6528,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D702" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="703" y="-213"></use>
</g>
<g transform="translate(7489,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-63"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="444" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-73" x="945" y="0"></use>
</g>
<g transform="translate(8995,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="663" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="9928" y="0"></use>
<g transform="translate(10485,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="663" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="11251" y="0"></use>
</g>
</svg>
</div>
<p>

or
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.095ex" height="5.843ex" style="vertical-align: -2.338ex;" viewBox="0 -1508.9 7360.1 2515.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">StartFraction cosine theta Subscript normal o Baseline normal d theta Subscript normal o Baseline Over cosine theta Subscript normal i Baseline normal d theta Subscript normal i Baseline EndFraction equals StartFraction eta Subscript normal i Baseline Over eta Subscript normal o Baseline EndFraction period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-63" d="M415 119c0 -10 -32 -130 -166 -130c-116 0 -215 99 -215 227c0 124 92 232 217 232c77 0 153 -39 153 -107c0 -30 -20 -47 -46 -47c-28 0 -46 20 -46 46c0 13 6 43 47 46c-35 36 -98 37 -107 37c-53 0 -135 -42 -135 -205c0 -161 88 -204 141 -204c37 0 102 12 131 105 c2 6 4 10 13 10c3 0 13 0 13 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-73" d="M360 128c0 -72 -46 -139 -161 -139c-21 0 -66 1 -110 43c-18 -19 -18 -21 -20 -23c-19 -19 -20 -20 -25 -20c-11 0 -11 7 -11 24v132c0 18 0 25 13 25c10 0 11 -4 14 -17c19 -85 55 -142 139 -142c78 0 113 40 113 91c0 72 -82 88 -104 92c-72 14 -100 20 -132 46 c-27 22 -43 50 -43 85c0 56 38 123 160 123c15 0 56 0 94 -28c4 3 14 12 17 16c13 12 15 12 20 12c11 0 11 -7 11 -24v-101c0 -19 0 -24 -13 -24c0 0 -11 0 -12 9c-2 31 -7 121 -117 121c-86 0 -112 -41 -112 -76c0 -58 67 -71 123 -82c42 -8 81 -16 114 -48 c12 -12 42 -42 42 -95Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D703" d="M455 500c0 -224 -152 -511 -293 -511c-91 0 -120 111 -120 205c0 229 154 511 293 511c102 0 120 -139 120 -205zM389 562c0 57 -6 121 -55 121c-45 0 -82 -56 -109 -105c-40 -71 -60 -151 -77 -215h209c24 99 32 150 32 199zM348 331h-208c-26 -98 -32 -156 -32 -198 c0 -93 21 -122 54 -122c43 0 81 49 116 117c38 72 59 157 70 203Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-64" d="M527 0l-147 -11v66c-25 -32 -70 -66 -134 -66c-114 0 -212 99 -212 226c0 129 105 227 223 227c54 0 97 -26 126 -62v216c0 49 -8 56 -78 56v31l144 11v-607c0 -49 8 -56 78 -56v-31zM380 118v205c0 18 0 20 -11 37c-31 45 -73 60 -108 60c-54 0 -92 -33 -113 -64 c-29 -45 -31 -105 -31 -142c0 -41 3 -98 29 -139c24 -38 60 -64 105 -64c43 0 88 22 118 70c11 17 11 19 11 37Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-69" d="M247 0c-34 1 -69 3 -104 3l-110 -3v31c67 0 78 0 78 45v269c0 49 -9 55 -74 55v31l140 11v-367c0 -39 4 -44 70 -44v-31zM192 604c0 -25 -20 -53 -54 -53c-30 0 -53 26 -53 53c0 25 20 53 54 53c30 0 53 -26 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D702" d="M496 335c0 -27 -3 -40 -8 -58l-114 -453c-3 -11 -10 -40 -41 -40c-17 0 -28 12 -28 27c0 0 0 4 3 16l114 460c10 40 10 58 10 63c0 36 -11 70 -54 70s-74 -19 -96 -35c-34 -27 -65 -83 -68 -92c-1 -6 -9 -39 -11 -45c-5 -23 -11 -45 -17 -67l-22 -90 c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43l58 231c13 52 16 63 16 84c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c45 0 87 -30 92 -87 c24 35 76 87 155 87c75 0 115 -42 115 -107Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
<g transform="translate(120,0)">
<rect stroke="none" width="4196" height="60" x="0" y="220"></rect>
<g transform="translate(60,677)">
 <use xlink:href="#E1-LATINMODERNMAIN-63"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="444" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-73" x="945" y="0"></use>
<g transform="translate(1506,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="663" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="2596" y="0"></use>
<g transform="translate(3152,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="663" y="-213"></use>
</g>
</g>
<g transform="translate(216,-726)">
 <use xlink:href="#E1-LATINMODERNMAIN-63"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="444" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-73" x="945" y="0"></use>
<g transform="translate(1506,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="663" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="2439" y="0"></use>
<g transform="translate(2995,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="663" y="-213"></use>
</g>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="4713" y="0"></use>
<g transform="translate(5492,0)">
<g transform="translate(397,0)">
<rect stroke="none" width="1071" height="60" x="0" y="220"></rect>
<g transform="translate(138,736)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D702" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="703" y="-213"></use>
</g>
<g transform="translate(60,-686)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D702" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="703" y="-213"></use>
</g>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="7081" y="0"></use>
</g>
</svg>
</div>
<p>

Substituting both Snell&rsquo;s law and this relationship into
Equation&nbsp;(<a href="#eq:spherical-L-transmitted">9.11</a>) and then simplifying, we have
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="21.722ex" height="3.176ex" style="vertical-align: -1.005ex;" viewBox="0 -934.9 9352.7 1367.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper L Subscript normal o Baseline eta Subscript normal i Superscript 2 Baseline normal d phi Subscript normal o Baseline equals upper L Subscript normal i Baseline eta Subscript normal o Superscript 2 Baseline normal d phi Subscript normal i Baseline period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D702" d="M496 335c0 -27 -3 -40 -8 -58l-114 -453c-3 -11 -10 -40 -41 -40c-17 0 -28 12 -28 27c0 0 0 4 3 16l114 460c10 40 10 58 10 63c0 36 -11 70 -54 70s-74 -19 -96 -35c-34 -27 -65 -83 -68 -92c-1 -6 -9 -39 -11 -45c-5 -23 -11 -45 -17 -67l-22 -90 c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43l58 231c13 52 16 63 16 84c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c45 0 87 -30 92 -87 c24 35 76 87 155 87c75 0 115 -42 115 -107Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-69" d="M247 0c-34 1 -69 3 -104 3l-110 -3v31c67 0 78 0 78 45v269c0 49 -9 55 -74 55v31l140 11v-367c0 -39 4 -44 70 -44v-31zM192 604c0 -25 -20 -53 -54 -53c-30 0 -53 26 -53 53c0 25 20 53 54 53c30 0 53 -26 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-64" d="M527 0l-147 -11v66c-25 -32 -70 -66 -134 -66c-114 0 -212 99 -212 226c0 129 105 227 223 227c54 0 97 -26 126 -62v216c0 49 -8 56 -78 56v31l144 11v-607c0 -49 8 -56 78 -56v-31zM380 118v205c0 18 0 20 -11 37c-31 45 -73 60 -108 60c-54 0 -92 -33 -113 -64 c-29 -45 -31 -105 -31 -142c0 -41 3 -98 29 -139c24 -38 60 -64 105 -64c43 0 88 22 118 70c11 17 11 19 11 37Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D719" d="M573 262c0 -134 -145 -269 -306 -274l-38 -149c-3 -14 -9 -38 -11 -40c-3 -3 -5 -4 -10 -4s-12 1 -12 11c0 3 10 41 22 88l23 94c-122 7 -192 86 -192 181c0 136 147 269 306 274l58 231c4 17 5 20 15 20c12 0 12 -10 12 -10l-3 -14l-56 -227c139 -10 192 -102 192 -181z M349 421c-149 -13 -235 -153 -235 -273c0 -100 72 -135 132 -138zM508 283c0 88 -57 134 -133 138l-103 -411c150 12 236 155 236 273Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="963" y="-213"></use>
<g transform="translate(1302,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D702" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="703" y="488"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="703" y="-426"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="2420" y="0"></use>
<g transform="translate(2976,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D719" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="843" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="4304" y="0"></use>
<g transform="translate(5361,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="963" y="-213"></use>
</g>
<g transform="translate(6506,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D702" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="703" y="488"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="703" y="-217"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="7624" y="0"></use>
<g transform="translate(8180,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D719" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="843" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="9074" y="0"></use>
</g>
</svg>
</div>
<p>

Finally, <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.198ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 4390.9 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal d phi Subscript normal i Baseline equals normal d phi Subscript normal o</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-64" d="M527 0l-147 -11v66c-25 -32 -70 -66 -134 -66c-114 0 -212 99 -212 226c0 129 105 227 223 227c54 0 97 -26 126 -62v216c0 49 -8 56 -78 56v31l144 11v-607c0 -49 8 -56 78 -56v-31zM380 118v205c0 18 0 20 -11 37c-31 45 -73 60 -108 60c-54 0 -92 -33 -113 -64 c-29 -45 -31 -105 -31 -142c0 -41 3 -98 29 -139c24 -38 60 -64 105 -64c43 0 88 22 118 70c11 17 11 19 11 37Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D719" d="M573 262c0 -134 -145 -269 -306 -274l-38 -149c-3 -14 -9 -38 -11 -40c-3 -3 -5 -4 -10 -4s-12 1 -12 11c0 3 10 41 22 88l23 94c-122 7 -192 86 -192 181c0 136 147 269 306 274l58 231c4 17 5 20 15 20c12 0 12 -10 12 -10l-3 -14l-56 -227c139 -10 192 -102 192 -181z M349 421c-149 -13 -235 -153 -235 -273c0 -100 72 -135 132 -138zM508 283c0 88 -57 134 -133 138l-103 -411c150 12 236 155 236 273Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-69" d="M247 0c-34 1 -69 3 -104 3l-110 -3v31c67 0 78 0 78 45v269c0 49 -9 55 -74 55v31l140 11v-367c0 -39 4 -44 70 -44v-31zM192 604c0 -25 -20 -53 -54 -53c-30 0 -53 26 -53 53c0 25 20 53 54 53c30 0 53 -26 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="0" y="0"></use>
<g transform="translate(556,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D719" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="843" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="1727" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="2783" y="0"></use>
<g transform="translate(3340,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D719" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="843" y="-213"></use>
</g>
</g>
</svg>, which gives the final relationship
between incident and transmitted radiance:
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="eq:transmitted-radiance-change"></span><div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.701ex" height="6.676ex" style="vertical-align: -2.838ex;" viewBox="0 -1652.5 5037.8 2874.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper L Subscript normal o Superscript Baseline equals upper L Subscript normal i Baseline StartFraction eta Subscript normal o Superscript 2 Baseline Over eta Subscript normal i Superscript 2 Baseline EndFraction period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-69" d="M247 0c-34 1 -69 3 -104 3l-110 -3v31c67 0 78 0 78 45v269c0 49 -9 55 -74 55v31l140 11v-367c0 -39 4 -44 70 -44v-31zM192 604c0 -25 -20 -53 -54 -53c-30 0 -53 26 -53 53c0 25 20 53 54 53c30 0 53 -26 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D702" d="M496 335c0 -27 -3 -40 -8 -58l-114 -453c-3 -11 -10 -40 -41 -40c-17 0 -28 12 -28 27c0 0 0 4 3 16l114 460c10 40 10 58 10 63c0 36 -11 70 -54 70s-74 -19 -96 -35c-34 -27 -65 -83 -68 -92c-1 -6 -9 -39 -11 -45c-5 -23 -11 -45 -17 -67l-22 -90 c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43l58 231c13 52 16 63 16 84c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c45 0 87 -30 92 -87 c24 35 76 87 155 87c75 0 115 -42 115 -107Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="963" y="-213"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="1413" y="0"></use>
<g transform="translate(2469,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="963" y="-213"></use>
</g>
<g transform="translate(3447,0)">
<g transform="translate(120,0)">
<rect stroke="none" width="1071" height="60" x="0" y="220"></rect>
<g transform="translate(60,736)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D702" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="703" y="488"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="703" y="-217"></use>
</g>
<g transform="translate(60,-837)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D702" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="703" y="488"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="703" y="-426"></use>
</g>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="4759" y="0"></use>
</g>
</svg>
</div>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">
<div class="eqno">(<a href="#eq:transmitted-radiance-change">9.12</a>)</div>
</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<p>


</p>
<p>The symmetry relationship satisfied by a BTDF is thus
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="eq:btdf-symmetry"></span><div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="31.798ex" height="3.176ex" style="vertical-align: -1.005ex;" viewBox="0 -934.9 13690.5 1367.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">eta Subscript normal o Superscript 2 Baseline f Subscript normal t Baseline left-parenthesis normal p Subscript Baseline comma omega Subscript normal o Baseline comma omega Subscript normal i Baseline right-parenthesis equals eta Subscript normal i Superscript 2 Baseline f Subscript normal t Baseline left-parenthesis normal p Subscript Baseline comma omega Subscript normal i Baseline comma omega Subscript normal o Baseline right-parenthesis period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D702" d="M496 335c0 -27 -3 -40 -8 -58l-114 -453c-3 -11 -10 -40 -41 -40c-17 0 -28 12 -28 27c0 0 0 4 3 16l114 460c10 40 10 58 10 63c0 36 -11 70 -54 70s-74 -19 -96 -35c-34 -27 -65 -83 -68 -92c-1 -6 -9 -39 -11 -45c-5 -23 -11 -45 -17 -67l-22 -90 c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43l58 231c13 52 16 63 16 84c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c45 0 87 -30 92 -87 c24 35 76 87 155 87c75 0 115 -42 115 -107Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-74" d="M332 124c0 -64 -28 -135 -99 -135c-36 0 -129 12 -129 135v276h-85v22c98 4 128 111 129 193h25v-184h143v-31h-143v-278c0 -17 0 -108 67 -108c37 0 67 38 67 112v55h25v-57Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D714" d="M604 372c0 -40 -12 -90 -23 -133c-30 -121 -93 -250 -197 -250c-67 0 -102 44 -113 106c-38 -62 -90 -106 -153 -106c-76 0 -105 62 -105 143c0 35 5 74 15 112c16 63 41 127 82 184c5 6 12 9 18 9c3 0 6 0 9 -2c5 -3 9 -8 9 -14c0 -4 -2 -9 -5 -13 c-38 -53 -74 -109 -89 -169c-5 -22 -8 -45 -8 -65c0 -63 26 -113 87 -113c55 0 103 39 136 93c1 29 5 59 13 90c5 22 15 47 34 47c14 0 19 -11 19 -26c0 -8 -2 -17 -4 -26c-7 -30 -17 -60 -30 -88c9 -52 42 -90 98 -90c79 0 137 92 160 183c3 12 4 25 4 37 c0 35 -13 66 -38 88c-7 7 -11 15 -11 25c0 11 5 22 14 32c10 10 23 16 35 16c9 0 17 -3 23 -9c15 -13 20 -35 20 -61Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-69" d="M247 0c-34 1 -69 3 -104 3l-110 -3v31c67 0 78 0 78 45v269c0 49 -9 55 -74 55v31l140 11v-367c0 -39 4 -44 70 -44v-31zM192 604c0 -25 -20 -53 -54 -53c-30 0 -53 26 -53 53c0 25 20 53 54 53c30 0 53 -26 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D702" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="703" y="488"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="703" y="-217"></use>
<g transform="translate(951,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-74" x="693" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1817" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="2206" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2763" y="0"></use>
<g transform="translate(3208,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="880" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="4284" y="0"></use>
<g transform="translate(4730,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="880" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="5649" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="6316" y="0"></use>
<g transform="translate(7373,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D702" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="703" y="488"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="703" y="-426"></use>
</g>
<g transform="translate(8324,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-74" x="693" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="9190" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="9579" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="10136" y="0"></use>
<g transform="translate(10581,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="880" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="11500" y="0"></use>
<g transform="translate(11946,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="880" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="13022" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="13412" y="0"></use>
</g>
</svg>
</div>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">
<div class="eqno">(<a href="#eq:btdf-symmetry">9.13</a>)</div>
</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<p>


</p>
<p>Non-symmetric scattering can be particularly problematic for bidirectional light
transport algorithms that sample light paths starting both from the camera
and from the lights.  If non-symmetry is not accounted for, then
such algorithms may produce incorrect results, since the design of such
algorithms is fundamentally based on the principle of
symmetry.

</p>
<p>We will say that light paths sampled starting from the lights carry
<em>importance</em> while paths starting from the camera carry radiance.
These terms correspond to the quantity that is recorded at a path&rsquo;s
starting point.

With importance transport, the incident and outgoing direction
arguments of the BSDFs will be (incorrectly) reversed unless special
precautions are taken.

</p>
<p>We thus define the <em>adjoint BSDF</em> <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.381ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1025.1 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">f Superscript asterisk</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2217" d="M433 144c-9 -15 -29 -19 -43 -9l-128 94l17 -158c2 -17 -11 -32 -29 -32s-31 15 -29 32l17 158l-128 -94c-14 -10 -34 -6 -43 9c-9 16 -3 35 14 42l145 64l-145 64c-17 7 -23 26 -14 42c9 15 29 19 43 9l128 -94l-17 158c-2 17 11 33 29 33s31 -16 29 -33l-17 -158 l128 94c14 10 34 6 43 -9c9 -16 3 -35 -14 -42l-145 -64l145 -64c17 -7 23 -26 14 -42Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2217" x="807" y="513"></use>
</g>
</svg>, whose only role is to
evaluate the original BSDF with swapped arguments:
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="27.02ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 11633.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">f Superscript asterisk Baseline left-parenthesis normal p comma omega Subscript normal o Baseline comma omega Subscript normal i Baseline right-parenthesis equals f left-parenthesis normal p comma omega Subscript normal i Baseline comma omega Subscript normal o Baseline right-parenthesis period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2217" d="M433 144c-9 -15 -29 -19 -43 -9l-128 94l17 -158c2 -17 -11 -32 -29 -32s-31 15 -29 32l17 158l-128 -94c-14 -10 -34 -6 -43 9c-9 16 -3 35 14 42l145 64l-145 64c-17 7 -23 26 -14 42c9 15 29 19 43 9l128 -94l-17 158c-2 17 11 33 29 33s31 -16 29 -33l-17 -158 l128 94c14 10 34 6 43 -9c9 -16 3 -35 -14 -42l-145 -64l145 -64c17 -7 23 -26 14 -42Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D714" d="M604 372c0 -40 -12 -90 -23 -133c-30 -121 -93 -250 -197 -250c-67 0 -102 44 -113 106c-38 -62 -90 -106 -153 -106c-76 0 -105 62 -105 143c0 35 5 74 15 112c16 63 41 127 82 184c5 6 12 9 18 9c3 0 6 0 9 -2c5 -3 9 -8 9 -14c0 -4 -2 -9 -5 -13 c-38 -53 -74 -109 -89 -169c-5 -22 -8 -45 -8 -65c0 -63 26 -113 87 -113c55 0 103 39 136 93c1 29 5 59 13 90c5 22 15 47 34 47c14 0 19 -11 19 -26c0 -8 -2 -17 -4 -26c-7 -30 -17 -60 -30 -88c9 -52 42 -90 98 -90c79 0 137 92 160 183c3 12 4 25 4 37 c0 35 -13 66 -38 88c-7 7 -11 15 -11 25c0 11 5 22 14 32c10 10 23 16 35 16c9 0 17 -3 23 -9c15 -13 20 -35 20 -61Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-69" d="M247 0c-34 1 -69 3 -104 3l-110 -3v31c67 0 78 0 78 45v269c0 49 -9 55 -74 55v31l140 11v-367c0 -39 4 -44 70 -44v-31zM192 604c0 -25 -20 -53 -54 -53c-30 0 -53 26 -53 53c0 25 20 53 54 53c30 0 53 -26 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2217" x="807" y="583"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1025" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="1414" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1971" y="0"></use>
<g transform="translate(2416,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="880" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="3492" y="0"></use>
<g transform="translate(3937,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="880" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="4857" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="5524" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="6580" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="7133" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="7522" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="8079" y="0"></use>
<g transform="translate(8524,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="880" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="9443" y="0"></use>
<g transform="translate(9889,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="880" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="10965" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="11354" y="0"></use>
</g>
</svg>
</div>
<p>


</p>
<p>All sampling steps based on importance transport use the adjoint form of
the BSDF rather than its original version. Most BSDFs in <tt>pbrt</tt> are
symmetric so that there is no actual difference between <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.283ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 552.5 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">f</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
</g>
</svg> and
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.381ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1025.1 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">f Superscript asterisk</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2217" d="M433 144c-9 -15 -29 -19 -43 -9l-128 94l17 -158c2 -17 -11 -32 -29 -32s-31 15 -29 32l17 158l-128 -94c-14 -10 -34 -6 -43 9c-9 16 -3 35 14 42l145 64l-145 64c-17 7 -23 26 -14 42c9 15 29 19 43 9l128 -94l-17 158c-2 17 11 33 29 33s31 -16 29 -33l-17 -158 l128 94c14 10 34 6 43 -9c9 -16 3 -35 -14 -42l-145 -64l145 -64c17 -7 23 -26 14 -42Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2217" x="807" y="513"></use>
</g>
</svg>. However, non-symmetric cases require additional attention.

</p>
<p>The <a href="#TransportMode"><tt>TransportMode</tt></a> enumeration is used to inform such non-symmetric
BSDFs about the transported quantity so that they can correctly switch
between the adjoint and non-adjoint forms.

</p>
<p></p>
<span class="anchor" id="fragment-TransportModeDefinition-0"></span><div class="fragmentname">&lt;&lt;TransportMode Definition&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">enum class <span class="anchor" id="TransportMode"></span>TransportMode { <span class="anchor" id="TransportMode::Radiance"></span>Radiance, <span class="anchor" id="TransportMode::Importance"></span>Importance };</div><p>


</p>
<p>The adjoint BTDF is then
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="45.708ex" height="6.676ex" style="vertical-align: -2.671ex;" viewBox="0 -1724.2 19679.9 2874.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">f Subscript normal t Superscript asterisk Baseline left-parenthesis normal p Subscript Baseline comma omega Subscript normal o Baseline comma omega Subscript normal i Baseline right-parenthesis equals f Subscript normal t Baseline left-parenthesis normal p Subscript Baseline comma omega Subscript normal i Baseline comma omega Subscript normal o Baseline right-parenthesis equals StartFraction eta Subscript normal i Superscript 2 Baseline Over eta Subscript normal o Superscript 2 Baseline EndFraction f Subscript normal t Baseline left-parenthesis normal p Subscript Baseline comma omega Subscript normal o Baseline comma omega Subscript normal i Baseline right-parenthesis comma</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2217" d="M433 144c-9 -15 -29 -19 -43 -9l-128 94l17 -158c2 -17 -11 -32 -29 -32s-31 15 -29 32l17 158l-128 -94c-14 -10 -34 -6 -43 9c-9 16 -3 35 14 42l145 64l-145 64c-17 7 -23 26 -14 42c9 15 29 19 43 9l128 -94l-17 158c-2 17 11 33 29 33s31 -16 29 -33l-17 -158 l128 94c14 10 34 6 43 -9c9 -16 3 -35 -14 -42l-145 -64l145 -64c17 -7 23 -26 14 -42Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-74" d="M332 124c0 -64 -28 -135 -99 -135c-36 0 -129 12 -129 135v276h-85v22c98 4 128 111 129 193h25v-184h143v-31h-143v-278c0 -17 0 -108 67 -108c37 0 67 38 67 112v55h25v-57Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D714" d="M604 372c0 -40 -12 -90 -23 -133c-30 -121 -93 -250 -197 -250c-67 0 -102 44 -113 106c-38 -62 -90 -106 -153 -106c-76 0 -105 62 -105 143c0 35 5 74 15 112c16 63 41 127 82 184c5 6 12 9 18 9c3 0 6 0 9 -2c5 -3 9 -8 9 -14c0 -4 -2 -9 -5 -13 c-38 -53 -74 -109 -89 -169c-5 -22 -8 -45 -8 -65c0 -63 26 -113 87 -113c55 0 103 39 136 93c1 29 5 59 13 90c5 22 15 47 34 47c14 0 19 -11 19 -26c0 -8 -2 -17 -4 -26c-7 -30 -17 -60 -30 -88c9 -52 42 -90 98 -90c79 0 137 92 160 183c3 12 4 25 4 37 c0 35 -13 66 -38 88c-7 7 -11 15 -11 25c0 11 5 22 14 32c10 10 23 16 35 16c9 0 17 -3 23 -9c15 -13 20 -35 20 -61Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-69" d="M247 0c-34 1 -69 3 -104 3l-110 -3v31c67 0 78 0 78 45v269c0 49 -9 55 -74 55v31l140 11v-367c0 -39 4 -44 70 -44v-31zM192 604c0 -25 -20 -53 -54 -53c-30 0 -53 26 -53 53c0 25 20 53 54 53c30 0 53 -26 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D702" d="M496 335c0 -27 -3 -40 -8 -58l-114 -453c-3 -11 -10 -40 -41 -40c-17 0 -28 12 -28 27c0 0 0 4 3 16l114 460c10 40 10 58 10 63c0 36 -11 70 -54 70s-74 -19 -96 -35c-34 -27 -65 -83 -68 -92c-1 -6 -9 -39 -11 -45c-5 -23 -11 -45 -17 -67l-22 -90 c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43l58 231c13 52 16 63 16 84c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c45 0 87 -30 92 -87 c24 35 76 87 155 87c75 0 115 -42 115 -107Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2217" x="807" y="449"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-74" x="693" y="-384"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1025" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="1414" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1971" y="0"></use>
<g transform="translate(2416,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="880" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="3492" y="0"></use>
<g transform="translate(3937,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="880" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="4857" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="5524" y="0"></use>
<g transform="translate(6580,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-74" x="693" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="7446" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="7836" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="8392" y="0"></use>
<g transform="translate(8837,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="880" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="9757" y="0"></use>
<g transform="translate(10202,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="880" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="11278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="11946" y="0"></use>
<g transform="translate(12724,0)">
<g transform="translate(397,0)">
<rect stroke="none" width="1071" height="60" x="0" y="220"></rect>
<g transform="translate(60,820)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D702" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="703" y="488"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="703" y="-426"></use>
</g>
<g transform="translate(60,-837)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D702" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="703" y="488"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="703" y="-217"></use>
</g>
</g>
</g>
<g transform="translate(14313,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-74" x="693" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="15179" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="15569" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="16125" y="0"></use>
<g transform="translate(16570,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="880" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="17647" y="0"></use>
<g transform="translate(18092,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="880" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="19011" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="19401" y="0"></use>
</g>
</svg>
</div>
<p>

which effectively cancels out the scale factor in
Equation&nbsp;(<a href="#eq:transmitted-radiance-change">9.12</a>).

</p>
<p>With these equations, we can now define the remaining missing piece in the
implementation of the <a href="#DielectricBxDF"><tt>DielectricBxDF</tt></a> evaluation and sampling
methods. Whenever radiance is transported over a refractive boundary, we
apply the scale factor from
Equation&nbsp;(<a href="#eq:transmitted-radiance-change">9.12</a>). For importance transport,
we use the adjoint BTDF, which lacks the scaling factor due to the
combination of Equations&nbsp;(<a href="#eq:transmitted-radiance-change">9.12</a>)
and&nbsp;(<a href="#eq:btdf-symmetry">9.13</a>).

</p>
<p></p>
<span class="anchor" id="fragment-Accountfornon-symmetrywithtransmissiontodifferentmedium-0"></span><div class="fragmentname">&lt;&lt;Account for non-symmetry with transmission to different medium&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">if (mode == <a href="#TransportMode::Radiance" class="code">TransportMode</a>::Radiance)
    ft /= <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(etap);</div><p>


</p>
<p>

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

</div>  <!-- container-fluid -->
</div>  <!-- maincontainer -->

<nav class="navbar navbar-expand-md bg-light navbar-light">
<div class="container-fluid">
  <span class="navbar-text"><i>Physically Based Rendering: From Theory To Implementation</i>,<br>
<a href="https://creativecommons.org/licenses/by-nc-nd/4.0/">&copy; 2004-2023</a> Matt Pharr, Wenzel Jakob, and Greg Humphreys.
<a href="https://github.com/mmp/pbr-book-website/"><span class="fab fa-github"></span></a><br>
Purchase a printed copy: <a href="https://www.amazon.com/Physically-Based-Rendering-fourth-Implementation/dp/0262048027?keywords=physically+based+rendering+4th+edition&qid=1671730412&sprefix=physically+based%!C(MISSING)aps%!C(MISSING)145&sr=8-1&linkCode=ll1&tag=pharr-20&linkId=81a816d90f0c7e872617f1f930a51fd6&language=en_US&ref_=as_li_ss_tl"><span class="fab fa-amazon"></span></a>
<a href="https://mitpress.mit.edu/9780262048026/physically-based-rendering/"><img src="/mitpress.png" width=10 height=16></a>
</span>
</div>
  <div class="container">
    <ul class="nav navbar-nav ml-auto">
      <li class="nav-item">Next: <a href="../Reflection_Models/Roughness_Using_Microfacet_Theory.html">Reflection Models / Roughness Using Microfacet Theory</a></li>
    </ul>
  </div>

</nav>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script>
  $(function () {
    $('[data-toggle="popover"]').popover()
    $('[data-toggle="tooltip"]').tooltip()
   })
</script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

<script>
// https://stackoverflow.com/a/17535094
// The function actually applying the offset
function offsetAnchor() {
  if (location.hash.length !== 0) {
    window.scrollTo(window.scrollX, window.scrollY - window.innerHeight / 8);
  }
}

// Captures click events of all <a> elements with href starting with #
$(document).on('click', 'a[href^="#"]', function(event) {
  // Click events are captured before hashchanges. Timeout
  // causes offsetAnchor to be called after the page jump.
  window.setTimeout(function() {
    offsetAnchor();
  }, 500);
});

// Set the offset when entering page with hash present in the url
window.setTimeout(offsetAnchor, 1500);
</script>

</body>
</html>
